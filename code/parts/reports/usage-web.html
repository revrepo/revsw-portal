<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <h2>Usage Report</h2>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <div class="panel panel-default usage-report">
        <div class="panel-heading">
          <div class="row">
            <div class="col-md-12">
              <div class="pull-left">

                <form class="form-inline">
                  <div class="form-group">

                    <ui-select ng-model="selected.val"
                               theme="select2"
                               ng-disabled="_loading"
                               on-select="onAccountSelect($model)"
                               style="min-width: 300px;" >
                      <ui-select-match placeholder="Select Account">{{$select.selected.acc_name}}</ui-select-match>
                      <ui-select-choices repeat="item in accounts | filter: {acc_name: $select.search}">
                        <div ng-bind-html="item.acc_name|highlight: $select.search"></div>
                      </ui-select-choices>
                    </ui-select>

                  </div>

                  <div class="form-group">
                    <div class="dropdown">
                      <a class="dropdown-toggle" id="month-dd" role="button" data-toggle="dropdown" ng-disabled="_loading">
                        <div class="input-group">
                          <input type="text" class="form-control" data-ng-model="month_year_symbol" ng-disabled="_loading">
                          <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                        </div>
                      </a>
                      <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                        <datetimepicker
                          data-ng-model="month_year"
                          data-datetimepicker-config="{ dropdownSelector: '#month-dd', startView: 'month', minView: 'month', modelType: 'milliseconds' }"
                          data-on-set-time="onTimeSet(newDate)"
                          />
                      </ul>
                    </div>
                  </div>

                  <div class="form-group">
                    <button class="btn btn-info" ng-click="onUpdate()" ng-disabled="_loading">
                      <i class="glyphicon glyphicon-refresh"></i>&nbsp;
                      Update Report
                    </button>
                  </div>

                </form>

              </div>

            </div>
          </div>
        </div>

        <div class="panel-body">

          <div class="row">

            <div class="col-md-4">

              <h4>Domains</h4>

              <form class="form-horizontal">

                <div class="form-group">
                  <label class="col-sm-6 control-label" >Active</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.domains.active }}</div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-sm-6 control-label" >Deleted</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.domains.deleted }}</div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-sm-6 control-label" >SSL Enabled</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.domains.ssl_enabled }}</div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-sm-6 control-label">Total</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.domains.total }}</div>
                  </div>
                </div>

              </form>

            </div>

            <div class="col-md-4">

              <h4>Mobile Apps</h4>

              <form class="form-horizontal">

                <div class="form-group">
                  <label class="col-sm-6 control-label" >Active</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.applications.active }}</div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-sm-6 control-label" >Deleted</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.applications.deleted }}</div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-sm-6 control-label">Total</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.applications.total }}</div>
                  </div>
                </div>

              </form>

            </div>

            <div class="col-md-4">

              <h4>API Keys</h4>

              <form class="form-horizontal">

                <div class="form-group">
                  <label class="col-sm-6 control-label" >Active</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.api_keys.active }}</div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-sm-6 control-label" >Inactive</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.api_keys.inactive }}</div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-sm-6 control-label">Total</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.api_keys.total }}</div>
                  </div>
                </div>

              </form>

            </div>

          </div>
          <hr>

          <div class="row">

            <div class="col-md-4">

              <h4>Traffic Total</h4>

              <form class="form-horizontal">

                <div class="form-group">
                  <label class="col-sm-6 control-label" >Hits</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.traffic.count }}</div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-sm-6 control-label" >Sent</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.traffic.sent_bytes }}</div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-sm-6 control-label">Received</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.traffic.received_bytes }}</div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-sm-6 control-label">BW Sent</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.traffic.billable_sent_bps }}</div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-sm-6 control-label">BW Received</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.traffic.billable_received_bps }}</div>
                  </div>
                </div>

              </form>

            </div>

            <div class="col-md-4">

              <h4>Edge Cache Usage</h4>

              <form class="form-horizontal">

                <div class="form-group">
                  <label class="col-sm-6 control-label" >HIT</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.cache_hits.HIT }}</div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-sm-6 control-label" >MISS</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ report.cache_hits.MISS }}</div>
                  </div>
                </div>

              </form>

            </div>

            <div class="col-md-4">

              <h4>HTTP/HTTPS Requests</h4>

              <form class="form-horizontal">

                <div class="form-group" ng-repeat="( port, hits ) in report.port_hits">
                  <label class="col-sm-6 control-label" >{{ port === '80' ? 'HTTP' : 'HTTPS' }}</label>
                  <div class="col-sm-6">
                    <div class="form-control text-right">{{ hits }}</div>
                  </div>
                </div>

              </form>

            </div>
          </div>

          <div ng-if="showTraffic()">

            <div ng-if="showDomainsUsage()">

              <hr>
              <h4>Traffic Total Per Billing Zone</h4>
              <table class="table table-stripped table-condensed">
                <thead>
                  <tr>
                    <th>Zone</th>
                    <th class="text-right">Hits</th>
                    <th class="text-right">Traffic sent</th>
                    <th class="text-right">Traffic received</th>
                    <th class="text-right">BW sent</th>
                    <th class="text-right">BW received</th>
                  </tr>
                </thead>
                <tbody ng-repeat="( zone, traffic ) in report.traffic_per_billing_zone">
                  <tr>
                    <td>{{zone}}</td>
                    <td class="text-right">{{traffic.count}}</td>
                    <td class="text-right">{{traffic.sent_bytes}}</td>
                    <td class="text-right">{{traffic.received_bytes}}</td>
                    <td class="text-right">{{traffic.billable_sent_bps}}</td>
                    <td class="text-right">{{traffic.billable_received_bps}}</td>
                  </tr>
                </tbody>
              </table>

              <hr>
              <h4>Domains Usage</h4>
              <div ng-repeat="( domain, usage ) in report.domains_usage">

                <div class="panel panel-default" style="margin-bottom: 6px;">
                  <div class="panel-heading" role="tab" id="heading-{{$index}}">
                    <h4 class="panel-title">
                      <a role="button" data-toggle="collapse" data-target="#domain-{{$index}}" >{{domain}}</a>
                    </h4>
                  </div>
                  <div id="domain-{{$index}}" class="panel-collapse collapse" role="tabpanel" >
                    <div class="panel-body">

                      <div class="row">

                        <div class="col-md-4">

                          <h4>Traffic Total</h4>

                          <form class="form-horizontal">

                            <div class="form-group">
                              <label class="col-sm-6 control-label" >Hits</label>
                              <div class="col-sm-6">
                                <div class="form-control text-right">{{ usage.count }}</div>
                              </div>
                            </div>

                            <div class="form-group">
                              <label class="col-sm-6 control-label" >Sent</label>
                              <div class="col-sm-6">
                                <div class="form-control text-right">{{ usage.sent_bytes }}</div>
                              </div>
                            </div>

                            <div class="form-group">
                              <label class="col-sm-6 control-label">Received</label>
                              <div class="col-sm-6">
                                <div class="form-control text-right">{{ usage.received_bytes }}</div>
                              </div>
                            </div>

                            <div class="form-group">
                              <label class="col-sm-6 control-label">BW Sent</label>
                              <div class="col-sm-6">
                                <div class="form-control text-right">{{ usage.billable_sent_bps }}</div>
                              </div>
                            </div>

                            <div class="form-group">
                              <label class="col-sm-6 control-label">BW Received</label>
                              <div class="col-sm-6">
                                <div class="form-control text-right">{{ usage.billable_received_bps }}</div>
                              </div>
                            </div>

                          </form>

                        </div>

                        <div class="col-md-4">

                          <h4>Edge Cache Usage</h4>

                          <form class="form-horizontal">

                            <div class="form-group">
                              <label class="col-sm-6 control-label" >HIT</label>
                              <div class="col-sm-6">
                                <div class="form-control text-right">{{ usage.cache_hits.HIT }}</div>
                              </div>
                            </div>

                            <div class="form-group">
                              <label class="col-sm-6 control-label" >MISS</label>
                              <div class="col-sm-6">
                                <div class="form-control text-right">{{ usage.cache_hits.MISS }}</div>
                              </div>
                            </div>

                          </form>

                        </div>

                        <div class="col-md-4">

                          <h4>HTTP/HTTPS Requests</h4>

                          <form class="form-horizontal">

                            <div class="form-group" ng-repeat="( port, hits ) in usage.port_hits">
                              <label class="col-sm-6 control-label" >{{ port === '80' ? 'HTTP' : 'HTTPS' }}</label>
                              <div class="col-sm-6">
                                <div class="form-control text-right">{{ hits }}</div>
                              </div>
                            </div>

                          </form>

                        </div>
                      </div>

                        <hr>
                        <h4>Traffic Per Billing Zone</h4>
                        <table class="table table-stripped table-condensed">
                          <thead>
                            <tr>
                              <th>Zone</th>
                              <th class="text-right">Hits</th>
                              <th class="text-right">Traffic sent</th>
                              <th class="text-right">Traffic received</th>
                              <th class="text-right">BW sent</th>
                              <th class="text-right">BW received</th>
                            </tr>
                          </thead>
                          <tbody ng-repeat="( zone, traffic ) in usage.traffic_per_billing_zone">
                            <tr>
                              <td>{{zone}}</td>
                              <td class="text-right">{{traffic.count}}</td>
                              <td class="text-right">{{traffic.sent_bytes}}</td>
                              <td class="text-right">{{traffic.received_bytes}}</td>
                              <td class="text-right">{{traffic.billable_sent_bps}}</td>
                              <td class="text-right">{{traffic.billable_received_bps}}</td>
                            </tr>
                          </tbody>
                        </table>

                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div ng-if="showAccounts()">
              <hr>
              <h4>Accounts Usage</h4>

              <table class="table table-stripped table-condensed">
                <thead>
                  <tr>
                    <th style="width: 40%">Account</th>
                    <th class="text-right">Hits</th>
                    <th class="text-right">Traffic sent</th>
                    <th class="text-right">Traffic received</th>
                    <th class="text-right">BW sent</th>
                    <th class="text-right">BW received</th>
                  </tr>
                </thead>
                <tbody ng-repeat="account in report.accounts">
                  <tr>
                    <td><a ng-click="onAccountClick('{{account.acc_id}}')">{{account.acc_name}}</a></td>
                    <td class="text-right">{{account.count}}</td>
                    <td class="text-right">{{account.sent_bytes}}</td>
                    <td class="text-right">{{account.received_bytes}}</td>
                    <td class="text-right">{{account.billable_sent_bps}}</td>
                    <td class="text-right">{{account.billable_received_bps}}</td>
                  </tr>
                </tbody>
              </table>

            </div>

          </div>

        </div>

      </div>
    </div>
  </div>

</div>
