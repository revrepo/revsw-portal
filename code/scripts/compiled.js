!function(){"use strict";angular.module("revapm.Portal.Config",[])}(),function(){"use strict";angular.module("revapm.Portal.Config").constant("$config",{SERVER_URL:"",API_URL:window.API_URL||"https://testsjc20-api01.revsw.net/v1",STATUS:{OK:200,BAD_REQUEST:400,UNAUTHORIZED:401,TWO_FACTOR_AUTH_REQUIRED:403},ROLE:{USER:"user",RESELLER:"reseller",ADMIN:"admin",REVADMIN:"revadmin"},EVENTS:{DOMAIN_CHANGED:"domain_changed"},DOMAIN_STAGING_STATUS_ICONS:{InProgress:"glyphicon-refresh spin",Published:"glyphicon-ok-sign text-success",Modified:"glyphicon-ok-sign text-primary"},DOMAIN_PRODUCTION_STATUS_ICONS:{InProgress:"glyphicon-refresh spin",Published:"glyphicon-ok-circle text-success",Modified:"glyphicon-ok-circle text-primary"},DOMAIN_STATUS_REFRESH_INTERVAL:5e3})}(),function(){"use strict";angular.module("revapm.Portal.Config").constant("ActivityPhrase",{ACTIVITY_TYPE:{add:"Added",modify:"Modified","delete":"Deleted",publish:"Published",login:"Logged In",purge:"Purged"},ACTIVITY_TARGET:{user:"User",account:"Company",domain:"Domain",purge:"Cache",apikey:"API Key",team:"Team",app:"App",object:"Object"}})}(),function(){"use strict";angular.module("revapm.Portal.Shared",["ngTouch","ui.bootstrap.tpls","ui.bootstrap.modal"])}(),function(){"use strict";function revAPIHttpInterceptor($q,$config,$rootScope){function endsWith(str,suffix){return-1!==str.indexOf(suffix,str.length-suffix.length)}return{responseError:function(rejection){return"POST"==rejection.config.method&&endsWith(rejection.config.url,"/2fa/enable")?$q.reject(rejection):(rejection.status==$config.STATUS.UNAUTHORIZED&&$rootScope.$emit("unauthorized"),rejection.status||$rootScope.$emit("not.connected"),$q.reject(rejection))}}}revAPIHttpInterceptor.$inject=["$q","$config","$rootScope"],angular.module("revapm.Portal.Shared").factory("revAPIHttpInterceptor",revAPIHttpInterceptor)}(),function(){"use strict";function AlertService($interval){function add(alert,timeout){var exists=!1;angular.forEach(alerts,function(record){record.message===alert.message&&record.type===alert.type&&(exists=!0)}),exists||(alerts.push(alert),timeout&&$interval(remove.bind(this,alert),timeout,1))}function success(msg,timeout){angular.isUndefined(timeout)&&(timeout=5e3),add({type:"success",message:msg||""},timeout)}function danger(msg,timeout){angular.isUndefined(timeout)&&(timeout=5e3),angular.isObject(msg)&&(msg=403===msg.status?"Access denied. Do you have a read-only user account?":msg&&msg.data&&msg.data.message?msg.data.message:"Something wrong..."),add({type:"danger",message:msg||""},timeout)}function remove(alert){var idx=alerts.indexOf(alert);~idx&&alerts.splice(idx,1)}function clear(){alerts.splice(0,alerts.length)}var alerts=[];return{alerts:alerts,success:success,danger:danger,add:add,remove:remove,clear:clear}}AlertService.$inject=["$interval"],angular.module("revapm.Portal.Shared").factory("AlertService",AlertService)}(),function(){"use strict";function alertListDirective(AlertService){return{transclude:!0,template:'<alert type="{{i.type}}" ng-repeat="i in as.alerts">{{i.message}}</alert>',controller:["$scope",function($scope){$scope.as=AlertService}]}}alertListDirective.$inject=["AlertService"],angular.module("revapm.Portal.Shared").directive("alertList",alertListDirective)}(),function(){"use strict";function alertDirective(){return{transclude:!0,template:'<div ng-class="class" ng-transclude></div>',scope:{type:"@"},controller:["$scope",function($scope){$scope["class"]="alert",$scope.type&&($scope["class"]="alert alert-"+$scope.type)}]}}angular.module("revapm.Portal.Shared").directive("alert",alertDirective)}(),function(){"use strict";function ConfirmModalInstanceCtrl($scope,$modalInstance,model){$scope.model=model,$scope.ok=function(){$modalInstance.close(!0)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}ConfirmModalInstanceCtrl.$inject=["$scope","$modalInstance","model"],angular.module("revapm.Portal.Shared").controller("ConfirmModalInstanceCtrl",ConfirmModalInstanceCtrl)}(),function(angular,empty){"use strict";function CRUDController($config,AlertService,$q,User,$anchorScroll,$modal,$filter,$timeout){function CRUDControllerImpl($scope,$stateParams){function saveAnchorScrollIndex($index){$scope.elementIndexForAnchorScroll=$index}$scope.auth=User,$scope.alertService=AlertService,$scope._loading=!1,$scope.state="",$scope.params=$stateParams,$scope.resourse=null,$scope.records=[],$scope.filteredRecords=[],$scope.model=null,$scope.quickFilter="",$scope.deniedFields=[],$scope._baseFilter=!1,$scope.page={hasPrevPage:!1,hasNextPage:!0,current:1,pages:[1]},$scope.filter={filter:"",limit:25,skip:0,predicate:"",reverse:!1},$scope.filterKeys=[],$scope._delayTimeout=null,$scope._applyFilter=function(){var filtered,i,res,compareValue;filtered=_.isString($scope.filter.filter)&&$scope.filter.filter.length>0&&$scope.filterKeys.length>0?_.filter($scope.records,function(record){for(i=0;i<$scope.filterKeys.length;i++)if(compareValue=record[$scope.filterKeys[i]],moment(compareValue,moment.ISO_8601).isValid()&&(compareValue=new Date(compareValue)),res=-1!==compareValue.toString().toLowerCase().indexOf($scope.filter.filter.toLowerCase()))return res}):$filter("filter")($scope.records,$scope.filter.filter),$scope.filteredRecords=$filter("orderBy")(filtered,$scope.filter.predicate,$scope.filter.reverse),$scope._checkPagination()},$scope.filterList=function(){$scope._delayTimeout&&($timeout.cancel($scope._delayTimeout),$scope._delayTimeout=null),$scope._delayTimeout=$timeout($scope._applyFilter,300)},$scope.$watch("filter",function(){$scope.filterList()},!0),$scope.confirm=function(template,resolve){angular.isObject(template)&&(resolve=template,template=""),angular.isObject(resolve)&&(resolve={model:resolve});var modalInstance=$modal.open({animation:!0,templateUrl:template||"parts/modal/confirmDelete.html",controller:"ConfirmModalInstanceCtrl",size:"md",resolve:resolve||{}});return modalInstance.result},$scope.loading=function(loading){return angular.isUndefined(loading)?$scope._loading:void($scope._loading=Boolean(loading))},$scope.setState=function(state){if(!state)throw new Error("Wrong state provided.");$scope.state=state},$scope.clearQuickFilter=function(filter){filter?filter="":$scope.quickFilter=""},$scope.clearModel=function(model){model||(model=$scope.model),angular.forEach(model,function(val,key){model[key]=""}),model=null},$scope.clearList=function(){$scope.records.splice(0,$scope.records.length),$scope.filteredRecords.splice(0,$scope.filteredRecords.length)},$scope.setResource=function(resource){$scope.resource=resource},$scope.setDeniedFields=function(fields){angular.isArray(fields)&&($scope.deniedFields=fields)},$scope.scrollTop=function(){$anchorScroll("top")},$scope.order=function(predicate){$scope.filter.reverse=$scope.filter.predicate===predicate?!$scope.filter.reverse:!1,$scope.filter.predicate=predicate},$scope.checkFilterPage=function(){$scope.filter.skip>0&&$scope.goToPage(1)},$scope._checkPagination=function(){$scope.filteredRecords.length<$scope.filter.limit+$scope.filter.skip?$scope.page.hasNextPage=!1:$scope.page.hasNextPage=!0,$scope.filter.skip>0?$scope.page.hasPrevPage=!0:$scope.page.hasPrevPage=!1;var pages=Math.ceil($scope.filteredRecords.length/$scope.filter.limit);$scope.page.pages.splice(0,$scope.page.pages.length);for(var i=1;pages>=i;i++)$scope.page.pages.push(i);$scope.page.current=Math.ceil($scope.filter.skip/$scope.filter.limit)+1},$scope.nextPage=function(){$scope.page.hasNextPage&&$scope.page.current!==$scope.page.pages.length&&($scope.filter.skip+=$scope.filter.limit,$scope._checkPagination(),$scope.scrollTop())},$scope.prevPage=function(){$scope.page.hasPrevPage&&($scope.filter.skip-=$scope.filter.limit,$scope.filter.skip<0&&($scope.filter.skip=0),$scope._checkPagination(),$scope.scrollTop())},$scope.goToPage=function(page){$scope.page.current!=page&&($scope.page.current=page,$scope.filter.skip=page*$scope.filter.limit-$scope.filter.limit,$scope._checkPagination(),$scope.scrollTop())},$scope.list=function(){if(!$scope.resource)throw new Error("No resource provided.");return $scope.loading(!0),$scope.resource.query(function(data){return $scope._baseFilter?$scope.records=$filter("filter")(data,$scope._baseFilter,!0):$scope.records=data,$scope.filterList(),$scope._checkPagination(),data}).$promise["finally"](function(){$scope.loading(!1)})},$scope["delete"]=function(model){if(model){if(!angular.isFunction(model.$remove))throw new Error("Wrong model provided.");return model.loading=!0,model.$remove().then(function(data){var idx=$scope.records.indexOf(model);return data.statusCode==$config.STATUS.OK&&$scope.records.splice(idx,1),idx=$scope.filteredRecords.indexOf(model),data.statusCode==$config.STATUS.OK&&$scope.filteredRecords.splice(idx,1),data})["finally"](function(){model.loading=!1})}},$scope.create=function(model){if(!$scope.resource)throw new Error("No resource provided.");$scope.alertService.clear(),$scope.loading(!0);var record=new $scope.resource(model);return record.$save().then(function(data){return $scope.list(),$scope.clearModel(model),data})["catch"](function(data){return data.status==$config.STATUS.BAD_REQUEST&&data.data&&data.data.message&&$scope.alertService.danger(data.data.message,5e3),$q.reject(data)})["finally"](function(){$scope.loading(!1)})},$scope.get=function(id){if(!$scope.resource)throw new Error("No resource provided.");return $scope.clearModel(),$scope.alertService.clear(),$scope.loading(!0),$scope.resource.get({id:id}).$promise.then(function(record){return $scope.model=record,record})["finally"](function(){$scope.loading(!1)})},$scope.update=function(params,model){angular.isObject(params)&&!model&&(model=params,params=void 0);var id=model.id;return params||(params={id:id}),angular.forEach($scope.deniedFields,function(val){model[val]&&delete model[val]}),$scope.alertService.clear(),$scope.loading(!0),$scope.resource.update(params,model).$promise.then(function(data){return $scope.list(),$scope.$emit("list"),data})["finally"](function(){$scope.loading(!1)})},$scope.$on("list",function(){$scope.list()}),$scope.saveAnchorScrollIndex=saveAnchorScrollIndex,$scope.elementIndexForAnchorScroll=empty}return CRUDControllerImpl}CRUDController.$inject=["$config","AlertService","$q","User","$anchorScroll","$modal","$filter","$timeout"],angular.module("revapm.Portal.Shared").factory("CRUDController",CRUDController)}(angular),function(){"use strict";function crudPaginationDirective(){return{restrict:"AE",templateUrl:"parts/shared/crud/pagination.html"}}angular.module("revapm.Portal.Shared").directive("crudPagination",crudPaginationDirective)}(),function(){"use strict";function listFilterDirective(){return{restrict:"AE",template:'<form class="form-inline"><div class="form-group"><label for="search">Search:&nbsp;</label><input type="text" class="form-control" id="search" placeholder="" ng-model="filter.filter" ng-change="checkFilterPage()">&nbsp;&nbsp;<i class="glyphicon glyphicon-remove" ng-show="filter.filter != \'\'" ng-click="filter.filter = \'\'"></i></div></form>'}}angular.module("revapm.Portal.Shared").directive("listFilter",listFilterDirective)}(),function(){"use strict";function UtilFactory(){function toBps(bytes,delay){return delay=delay||1800,angular.isNumber(delay)||(delay=1800),bytes/delay*8}function convertTraffic(bps){if(!bps)return"0 Bps";if(1>bps)return bps.toFixed(2)+" Bps";var sizes=["Bps","Kbps","Mbps","Gbps","Tbps"],i=Math.floor(Math.log(bps)/Math.log(1024)),result=Math.round(100*bps/Math.pow(1024,i))/100+" "+(sizes[i]||"");return result||""}function toRPS(bytes,delay,isNumber){angular.isNumber(delay)||(delay=1800);var result=(bytes/delay).toFixed(1);return isNumber?(result=parseFloat(result),result||0):result||""}function formatNumber(num,fixed){return(void 0!==fixed?num.toFixed(fixed):num.toString()).replace(/\B(?=(\d{3})+(?!\d))/g,"'")}function humanFileSize(size,pr){if(!size)return"0 B";var i=Math.floor(Math.log(size)/Math.log(1024));return 1*(size/Math.pow(1024,i)).toFixed(pr||2)+" "+["B","kB","MB","GB","TB"][i]}function humanFileSizeInGB(size,pr){return size?1*(size/1073741824).toFixed(pr||2)+" GB":"0 GB"}return{convertTraffic:convertTraffic,toBps:toBps,toRPS:toRPS,formatNumber:formatNumber,humanFileSize:humanFileSize,humanFileSizeInGB:humanFileSizeInGB}}angular.module("revapm.Portal.Shared").factory("Util",UtilFactory)}(),function(){"use strict";angular.module("revapm.Portal.Resources",["ngResource","revapm.Portal.Shared","revapm.Portal.Config"])}(),function(){"use strict";function ResourceConfig($httpProvider){$httpProvider.interceptors.push("revAPIHttpInterceptor")}ResourceConfig.$inject=["$httpProvider"],angular.module("revapm.Portal.Resources").config(ResourceConfig)}(),function(){"use strict";function ResourceFactory($resource){return function(url,params,methods){var defaults={update:{method:"PUT",isArray:!1},create:{method:"POST"}};methods=angular.extend(defaults,methods);var resource=$resource(url,params,methods);return resource.prototype.$save=function(){return this.id?this.$update():this.$create()},resource}}ResourceFactory.$inject=["$resource"],angular.module("revapm.Portal.Resources").factory("Resource",ResourceFactory)}(),function(){"use strict";function CompaniesResource(Resource,$config){return Resource($config.API_URL+"/accounts/:id",{id:"@id"})}CompaniesResource.$inject=["Resource","$config"],angular.module("revapm.Portal.Resources").factory("Companies",CompaniesResource)}(),function(){"use strict";function DomainsResource(Resource,$config){return Resource($config.API_URL+"/domain_configs/:id",{id:"@id"},{status:{url:$config.API_URL+"/domain_configs/:id/config_status",method:"GET",isArray:!1},versions:{url:$config.API_URL+"/domain_configs/:id/versions",method:"GET",isArray:!0}})}DomainsResource.$inject=["Resource","$config"],angular.module("revapm.Portal.Resources").factory("DomainsConfig",DomainsResource)}(),function(){"use strict";function UsersResource(Resource,$config){return Resource($config.API_URL+"/users/:id",{id:"@user_id",token:"@token",email:"@email"},{myself:{url:$config.API_URL+"/users/myself",method:"GET"},signup:{url:$config.API_URL+"/signup",method:"POST"},verify:{url:$config.API_URL+"/signup/verify/:token",method:"GET"},resend:{url:$config.API_URL+"/signup/resend/:email",method:"GET"}})}UsersResource.$inject=["Resource","$config"],angular.module("revapm.Portal.Resources").factory("Users",UsersResource)}(),function(){"use strict";function CacheResource(Resource,$config){return Resource($config.API_URL+"/purge/:requestId",{requestId:""},{purge:{method:"POST",isArray:!1},status:{method:"GET",isArray:!1}})}CacheResource.$inject=["Resource","$config"],angular.module("revapm.Portal.Resources").factory("Cache",CacheResource)}(),function(){"use strict";function StatsResource(Resource,$config){return Resource($config.API_URL+"/stats/:domainId",{},{os:{method:"GET",url:$config.API_URL+"/stats/top/:domainId",params:{report_type:"os",count:10}},device:{method:"GET",url:$config.API_URL+"/stats/top/:domainId",params:{report_type:"device",count:10}},country:{method:"GET",url:$config.API_URL+"/stats/top/:domainId",params:{report_type:"country",count:10}},protocol:{method:"GET",url:$config.API_URL+"/stats/top/:domainId",params:{report_type:"protocol"}},httpProtocol:{method:"GET",url:$config.API_URL+"/stats/top/:domainId",params:{report_type:"http_protocol"}},httpMethod:{method:"GET",url:$config.API_URL+"/stats/top/:domainId",params:{report_type:"http_method"}},statusCode:{method:"GET",url:$config.API_URL+"/stats/top/:domainId",params:{report_type:"status_code"}},contentType:{method:"GET",url:$config.API_URL+"/stats/top/:domainId",params:{report_type:"content_type"}},cacheStatus:{method:"GET",url:$config.API_URL+"/stats/top/:domainId",params:{report_type:"cache_status"}},requestStatus:{method:"GET",url:$config.API_URL+"/stats/top/:domainId",params:{report_type:"request_status"}},quic:{method:"GET",url:$config.API_URL+"/stats/top/:domainId",params:{report_type:"QUIC"}},http2:{method:"GET",url:$config.API_URL+"/stats/top/:domainId",params:{report_type:"http2"}},top5xx:{method:"GET",url:$config.API_URL+"/stats/top/:domainId",params:{report_type:"top5xx"}},traffic:{method:"GET"},referer:{url:$config.API_URL+"/stats/top/:domainId",params:{report_type:"referer"}},topObjects:{method:"GET",url:$config.API_URL+"/stats/top_objects/:domainId",params:{}},lm_rtt_country:{method:"GET",url:$config.API_URL+"/stats/lastmile_rtt/:domainId",params:{report_type:"country",count:10}},gbt_country:{method:"GET",url:$config.API_URL+"/stats/gbt/:domainId",params:{report_type:"country",count:10}},fbt_average:{method:"GET",url:$config.API_URL+"/stats/fbt/average/:domainId",params:{}},fbt_distribution:{method:"GET",url:$config.API_URL+"/stats/fbt/distribution/:domainId",params:{}},fbt_heatmap:{method:"GET",url:$config.API_URL+"/stats/fbt/heatmap/:domainId",params:{}},sdk_dirs:{method:"GET",url:$config.API_URL+"/stats/sdk/dirs",params:{}},sdk_flow:{method:"GET",url:$config.API_URL+"/stats/sdk/flow",params:{}},sdk_agg_flow:{method:"GET",url:$config.API_URL+"/stats/sdk/agg_flow",params:{}},sdk_top_hits:{method:"GET",url:$config.API_URL+"/stats/sdk/top_requests",params:{}},sdk_top_users:{method:"GET",url:$config.API_URL+"/stats/sdk/top_users",params:{}},sdk_top_gbt:{method:"GET",url:$config.API_URL+"/stats/sdk/top_gbt",params:{}},sdk_distributions:{method:"GET",url:$config.API_URL+"/stats/sdk/distributions",params:{}},sdk_top_objects:{method:"GET",url:$config.API_URL+"/stats/sdk/top_objects",params:{}},sdk_top_objects_time:{method:"GET",url:$config.API_URL+"/stats/sdk/top_objects/slowest",params:{}},sdk_top_objects_5xx:{method:"GET",url:$config.API_URL+"/stats/sdk/top_objects/5xx",params:{}},sdk_ab_fbt:{method:"GET",url:$config.API_URL+"/stats/sdk/ab/fbt",params:{}},sdk_ab_fbt_distribution:{method:"GET",url:$config.API_URL+"/stats/sdk/ab/fbt_distribution",params:{}},sdk_ab_errors:{method:"GET",url:$config.API_URL+"/stats/sdk/ab/errors",params:{}},sdk_ab_speed:{method:"GET",url:$config.API_URL+"/stats/sdk/ab/speed",params:{}},usage_web:{method:"GET",url:$config.API_URL+"/usage_reports/web",params:{}}})}StatsResource.$inject=["Resource","$config"],angular.module("revapm.Portal.Resources").factory("Stats",StatsResource)}(),function(){"use strict";function CountriesResource(Resource,$config){return Resource($config.API_URL+"/countries/list",{},{query:{isArray:!1}})}CountriesResource.$inject=["Resource","$config"],angular.module("revapm.Portal.Resources").factory("Countries",CountriesResource)}(),function(){"use strict";function ActivityResource(Resource,$config){return Resource($config.API_URL+"/activity/:action",{action:""},{query:{method:"GET",isArray:!1},summary:{method:"GET",isArray:!1}})}ActivityResource.$inject=["Resource","$config"],angular.module("revapm.Portal.Resources").factory("Activity",ActivityResource)}(),function(){"use strict";function TwoFactorAuthResource(Resource,$config){return Resource($config.API_URL+"/2fa/:action/:userId",{action:"",userId:""},{init:{method:"GET",isArray:!1,params:{action:"init"}},enable:{method:"POST",isArray:!1,params:{action:"enable"}},disable:{method:"POST",isArray:!1,params:{action:"disable"}}})}TwoFactorAuthResource.$inject=["Resource","$config"],angular.module("revapm.Portal.Resources").factory("TwoFactorAuth",TwoFactorAuthResource)}(),function(){"use strict";function KeysResource(Resource,$config){return Resource($config.API_URL+"/api_keys/:id",{id:"@id"},{})}KeysResource.$inject=["Resource","$config"],angular.module("revapm.Portal.Resources").factory("ApiKeys",KeysResource)}(),function(){"use strict";function AppsResource(Resource,$config){return Resource($config.API_URL+"/apps/:id",{id:"@id"},{status:{url:$config.API_URL+"/apps/:id/config_status",method:"GET",isArray:!1},sdkReleases:{url:$config.API_URL+"/apps/sdk_releases",method:"GET"},versions:{url:$config.API_URL+"/apps/:id/versions",method:"GET",isArray:!0}})}AppsResource.$inject=["Resource","$config"],angular.module("revapm.Portal.Resources").factory("Apps",AppsResource)}(),function(){"use strict";function authRun($http,$localStorage){$localStorage.Authorization&&($http.defaults.headers.common.Authorization=$localStorage.Authorization)}authRun.$inject=["$http","$localStorage"],angular.module("revapm.Portal.Auth",["ngStorage","revapm.Portal.Shared","revapm.Portal.Config","revapm.Portal.Resources","base64","ui.router"]).run(authRun)}(),function(){"use strict";function configure($httpProvider){}configure.$inject=["$httpProvider"],angular.module("revapm.Portal.Auth").config(configure)}(),function(){"use strict";function routesConfig($stateProvider){$stateProvider.state("login",{url:"/login",views:{layout:{controller:"LoginController",templateUrl:"parts/auth/login.html"}}}).state("index.restore",{url:"/password/reset/:token",views:{page:{controller:"PasswordRestoreController",templateUrl:"parts/auth/reset-password.html"}}})}routesConfig.$inject=["$stateProvider"],angular.module("revapm.Portal.Auth").config(routesConfig)}(),function(){"use strict";function AuthRun($rootScope,$state){$rootScope.$on("unauthorized",function(){console.log("No logged in"),$state.go("login")}),$rootScope.$on("not.connected",function(){"login"!==$state.current.name&&$state.go("login")})}AuthRun.$inject=["$rootScope","$state"],angular.module("revapm.Portal.Auth").run(AuthRun)}(),function(){"use strict";function User($localStorage,$http,$config,$q,DomainsConfig){function clearAll(){localStorage&&localStorage.clear()}function getToken(){return $localStorage.Authorization||!1}function setToken(token){token&&($localStorage.Authorization=token)}function isAuthed(){var token=getToken();return!!token}function addAuthHeaderForAPI(token){$localStorage.Authorization="Bearer "+token,$http.defaults.headers.common.Authorization="Bearer "+token,$http.defaults.headers.common["Content-Type"]="application/json"}function clearAuthHeaderForAPI(){$localStorage.Authorization=void 0,delete $http.defaults.headers.common.Authorization}function login(email,password,oneTimePassword){if(!email||!password)throw new Error("Please fill email and password");var authData={email:email,password:password};return oneTimePassword&&(authData.oneTimePassword=oneTimePassword),$http.post($config.API_URL+"/authenticate",authData).then(function(data){return data.status===$config.STATUS.OK?(setToken(data.data.token),addAuthHeaderForAPI(data.data.token),$http.get($config.API_URL+"/users/myself").then(function(data){if(!data||data.status!==$config.STATUS.OK)throw new Error(data.response);var res=data.data;if(res.role!==$config.ROLE.USER&&res.role!==$config.ROLE.ADMIN&&res.role!==$config.ROLE.RESELLER&&res.role!==$config.ROLE.REVADMIN)throw new Error("You do not have permission");return $localStorage.isLoggedIn=!0,$localStorage.isCAdmin=!0,$localStorage.user=res,domains=[],$localStorage.last_user_id!==res.user_id&&(apps=[],selectApplication(null),accounts=[],selectAccount(null),$localStorage.last_user_id=res.user_id),data})):data})["catch"](function(err){return clearAuthHeaderForAPI(),$q.reject(err)})}function logout(){setToken(),$localStorage.user=void 0,clearAuthHeaderForAPI(),clearAll()}function getUser(){return $localStorage.user||null}function isAdmin(){var user=getUser();return Boolean(isAuthed()&&user&&user.role===$config.ROLE.ADMIN)}function isReseller(){var user=getUser();return Boolean(isAuthed()&&user&&user.role===$config.ROLE.RESELLER)}function isRevadmin(){var user=getUser();return Boolean(isAuthed()&&user&&user.role===$config.ROLE.REVADMIN)}function isUser(){var user=getUser();return Boolean(isAuthed()&&user&&user.role===$config.ROLE.USER)}function reloadUser(){return $http.get($config.API_URL+"/users/myself").then(function(data){if(!data||data.status!==$config.STATUS.OK)throw new Error(data.response);return $localStorage.user=data.data,data})}function forgotPassword(email){return $http.post($config.API_URL+"/forgot",{email:email}).then(function(data){if(data&&data.status!==$config.STATUS.OK)throw new Error(data.response);return data})}function resetPassword(token,password){return $http.post($config.API_URL+"/reset/"+token,{password:password}).then(function(data){if(data&&data.status!==$config.STATUS.OK)throw new Error(data.response);return data})}function updatePassword(currentPassword,newPassword){var user=getUser();if(!isAuthed()||!user.user_id)throw new Error("User not authentificated");return $http.put($config.API_URL+"/users/password/"+user.user_id,{current_password:currentPassword,new_password:newPassword}).then(function(data){if(data&&data.status!==$config.STATUS.OK)throw new Error(data.response);return login(user.email,newPassword),data})}function getUserDomains(reload){return $q(function(resolve,reject){return domains&&domains.length>0&&!reload?resolve(domains):void DomainsConfig.query().$promise.then(function(data){domains=data,resolve(domains)})["catch"](function(err){domains=[],resolve(domains)})}.bind(this))}function selectDomain(domain){domainSelected=domain}function getSelectedDomain(){return domainSelected}function getUserApps(reload){return $q(function(resolve,reject){return apps.length>0&&!reload?resolve(apps):void $http.get($config.API_URL+"/apps").then(function(data){if(data&&data.status===$config.STATUS.OK){apps=data.data.map(function(item){return{app_name:item.app_name,app_id:item.id,id:item.id,sdk_key:item.sdk_key}}).sort(function(lhs,rhs){return lhs.app_name.localeCompare(rhs.app_name)});var user=getUser();apps.length&&user&&user.companyId[0]&&apps.unshift({app_id:"",app_name:"All Applications"}),resolve(apps)}else reject(new Error(data.response))})})}function selectApplication(app){$localStorage.selectedApplication=app,appSelected=app}function getSelectedApplication(){return $localStorage.selectedApplication||appSelected}function getUserAccounts(reload){return $q(function(resolve,reject){return accounts.length>0&&!reload?resolve(accounts):void $http.get($config.API_URL+"/accounts").then(function(data){if(data&&data.status===$config.STATUS.OK){accounts=data.data.map(function(item){return{acc_name:item.companyName,acc_id:item.id}}).sort(function(lhs,rhs){return lhs.acc_name.localeCompare(rhs.acc_name)});var user=getUser();accounts.length>1&&user&&accounts.unshift({acc_id:"",acc_name:"All Accounts"}),resolve(accounts)}else reject(new Error(data.response))})["catch"](function(err){console.log(err)})})}function selectAccount(acc){$localStorage.selectedAccount=acc,accSelected=acc}function getSelectedAccount(){return accSelected||$localStorage.selectedAccount}var domains=[],domainSelected=null,apps=[],appSelected=null,accounts=[],accSelected=null;return{getToken:getToken,setToken:setToken,isAuthed:isAuthed,login:login,logout:logout,getUser:getUser,isAdmin:isAdmin,isReseller:isReseller,isRevadmin:isRevadmin,isUser:isUser,reloadUser:reloadUser,forgotPassword:forgotPassword,resetPassword:resetPassword,updatePassword:updatePassword,getUserDomains:getUserDomains,selectDomain:selectDomain,getSelectedDomain:getSelectedDomain,getUserApps:getUserApps,selectApplication:selectApplication,getSelectedApplication:getSelectedApplication,getUserAccounts:getUserAccounts,selectAccount:selectAccount,getSelectedAccount:getSelectedAccount}}User.$inject=["$localStorage","$http","$config","$q","DomainsConfig"],angular.module("revapm.Portal.Auth").factory("User",User)}(),function(){"use strict";function selectAccountDomain(User,$rootScope,$config){return{restrict:"AE",templateUrl:"parts/auth/menu/select-account-domain.html",controller:["$scope",function($scope){$scope.domain=User.getSelectedDomain(),$scope._loading=!0,$scope.onDomainChange=function(){User.selectDomain($scope.domain),$rootScope.$broadcast($config.EVENTS.DOMAIN_CHANGED,{domain:$scope.domain})},User.getUserDomains().then(function(domains){$scope.domains=domains,$scope._loading=!1})}]}}selectAccountDomain.$inject=["User","$rootScope","$config"],angular.module("revapm.Portal.Auth").directive("selectAccountDomain",selectAccountDomain)}(),function(){"use strict";function disableTwoFactorAuthDirective(User,Users,TwoFactorAuth,AlertService,$modal){return{restrict:"AE",replace:!0,templateUrl:"parts/auth/2fa/disable-two-factor-auth.html",scope:{ngUserId:"="},controller:["$scope",function($scope){$scope._loading=!1,$scope.currentUser=User.getUser(),$scope.twoFactorAuthEnabled=!1,$scope.isMyUser=!1,$scope.loadUserDetails=function(){return $scope.isMyUser=!1,$scope.ngUserId?($scope.twoFactorAuthEnabled=!1,$scope._loading=!0,void Users.get({id:$scope.ngUserId}).$promise.then(function(data){$scope.twoFactorAuthEnabled=Boolean(data.two_factor_auth_enabled),$scope.isMyUser=Boolean($scope.ngUserId==data.user_id)})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1})):void console.log("You did not provide userId. User ng-user-id for directive !")},$scope._disable=function(oneTimePassword){if($scope.twoFactorAuthEnabled){if(!$scope.ngUserId)return void console.log("You did not provide userId. User ng-user-id for directive !");$scope._loading=!0;var data={};TwoFactorAuth.disable({userId:$scope.ngUserId},data).$promise.then(function(data){$scope.currentUser.user_id==$scope.ngUserId&&User.reloadUser(),AlertService.success(data.message),$scope.twoFactorAuthEnabled=!1})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1})}},$scope.disable=function(){$scope.confirm().then($scope._disable)},$scope.confirm=function(){var modalInstance=$modal.open({animation:!0,templateUrl:"confirm2FaDisable.html",controller:"ConfirmModalInstanceCtrl",size:"md",resolve:{model:{isMyUser:$scope.isMyUser,user:$scope.currentUser}}});return modalInstance.result},$scope.$watch("ngUserId",function(){$scope.ngUserId&&$scope.loadUserDetails()})}]}}disableTwoFactorAuthDirective.$inject=["User","Users","TwoFactorAuth","AlertService","$modal"],angular.module("revapm.Portal.Auth").directive("disableTwoFactorAuth",disableTwoFactorAuthDirective)}(),function(){"use strict";function PasswordRestoreController($scope,User,$stateParams,AlertService,$timeout,$state){$scope.alerts=AlertService,$scope.token=$stateParams.token,$scope.password="",$scope.passwordRepeat="",$scope.loading=!1,$scope.reset=function(){return AlertService.clear(),$scope.password&&$scope.passwordRepeat&&$scope.password==$scope.passwordRepeat?($scope.loading=!0,void User.resetPassword($scope.token,$scope.password).then(function(data){data.data&&data.data.message&&(AlertService.success(data.data.message,5e3),$timeout(function(){$state.go("login")},3e3))})["catch"](function(err){err.data&&err.data.message&&AlertService.danger(err.data.message,5e3)})["finally"](function(){$scope.loading=!1})):void AlertService.danger("Passwords did not match",5e3)}}PasswordRestoreController.$inject=["$scope","User","$stateParams","AlertService","$timeout","$state"],angular.module("revapm.Portal.Auth").controller("PasswordRestoreController",PasswordRestoreController)}(),function(){"use strict";function ForgotPasswordController($scope,$modalInstance,User,AlertService){$scope.data={email:"",loading:!1},$scope.close=function(){$scope.data.loading=!1,$modalInstance.dismiss()},$scope.forgot=function(){$scope.data.email?($scope.data.loading=!0,User.forgotPassword($scope.data.email).then(function(data){data&&data.data&&data.data.message&&$modalInstance.close(data.data.message)})["catch"](function(err){AlertService.danger(err.data.message)})["finally"](function(){$scope.data.loading=!1})):AlertService.danger("Wrong email address")}}ForgotPasswordController.$inject=["$scope","$modalInstance","User","AlertService"],angular.module("revapm.Portal.Auth").controller("ForgotPasswordController",ForgotPasswordController)}(),function(){"use strict";function TwoFactorAuthCodeModalController($scope,$modalInstance,auth,User,AlertService,$config){$scope.data={code:"",loading:!1},$scope.close=function(){$scope.data.loading=!1,$modalInstance.dismiss()},$scope.login=function(){if(!$scope.data.code)return void AlertService.danger("Please enter One Time Password",3e3);
AlertService.clear(),$scope.data.loading=!0;try{User.login(auth.email,auth.password,$scope.data.code).then(function(data){$modalInstance.close(data)})["catch"](function(err){err.status==$config.STATUS.UNAUTHORIZED&&AlertService.danger("Wrong one Time Password",5e3),err.data.message&&AlertService.danger(err.data.message,5e3)})["finally"](function(){$scope.data.loading=!1})}catch(e){AlertService.danger(e.message),$scope.data.loading=!1}}}TwoFactorAuthCodeModalController.$inject=["$scope","$modalInstance","auth","User","AlertService","$config"],angular.module("revapm.Portal.Auth").controller("TwoFactorAuthCodeModalController",TwoFactorAuthCodeModalController)}(),function(){"use strict";function LoginController($scope,User,$state,AlertService,$config,$modal){document.querySelector("body").style.paddingTop="0",$scope._loading=!1,$scope.style={height:document.documentElement.clientHeight+"px"};var images=["images/bg/bay_bridge.jpg","images/bg/burney_falls.jpg","images/bg/golden_gate.jpg","images/bg/mirror_lake.jpg","images/bg/painted_ladies.jpg","images/bg/tunnel_view.jpg","images/bg/twin_peaks.jpg","images/bg/yosemite_hill.jpg","images/bg/yosemite_valley.jpg"];$scope.randomImage=images[Math.floor(Math.random()*images.length)],$scope.randomImageStyle={"background-image":"url("+$scope.randomImage+")"},$scope.login=function(email,pass){AlertService.clear(),$scope._loading=!0;try{User.login(email,pass).then(function(data){$state.go("index")})["catch"](function(err){err.status||AlertService.danger("Something get wrong",5e3),err.status==$config.STATUS.TWO_FACTOR_AUTH_REQUIRED&&$scope.enter2faCode(email,pass),err.status==$config.STATUS.UNAUTHORIZED&&AlertService.danger("Wrong username or password",5e3),err.data.message&&AlertService.danger(err.data.message,5e3)})["finally"](function(){$scope._loading=!1})}catch(e){AlertService.danger(e.message),$scope._loading=!1}},localStorage&&localStorage.email&&localStorage.password&&$scope.login(localStorage.email,localStorage.password),$scope.enter2faCode=function(email,password){var modalInstance=$modal.open({templateUrl:"parts/auth/two-factor-auth-code.html",controller:"TwoFactorAuthCodeModalController",size:"md",resolve:{auth:function(){return{email:email,password:password}}}});modalInstance.result.then(function(data){$state.go("index")})},$scope.forgotPassword=function(){var modalInstance=$modal.open({templateUrl:"parts/auth/forgot-password.html",controller:"ForgotPasswordController",size:"md"});modalInstance.result.then(function(message){AlertService.success(message,5e3)})}}LoginController.$inject=["$scope","User","$state","AlertService","$config","$modal"],angular.module("revapm.Portal.Auth").controller("LoginController",LoginController)}(),function(){"use strict";function userLoginLogoutDirective(User,$state){return{restrict:"AE",replace:!0,templateUrl:"parts/auth/block/user-login-logout.html",scope:{},link:function($scope){$scope.isAuthorized=User.isAuthed(),$scope.user=User.getUser(),$scope.logout=function(){User.logout(),$state.go("login")}}}}userLoginLogoutDirective.$inject=["User","$state"],angular.module("revapm.Portal.Auth").directive("userLoginLogout",userLoginLogoutDirective)}(),function(){"use strict";angular.module("revapm.Portal.Signup",["ngStorage","revapm.Portal.Auth","revapm.Portal.Shared","revapm.Portal.Config","revapm.Portal.Resources","base64","ui.router"])}(),function(){"use strict";function SignupController($scope,Users,$localStorage,User,Companies,BillingPlans,CRUDController,Countries,$state,AlertService,$injector){$injector.invoke(CRUDController,this,{$scope:$scope}),$scope.$on("$stateChangeSuccess",function(state){$state.is("signup")&&($scope.model=_.clone(User.getUser()),$scope.model.country="US",$scope.model.billing_plan||$state.go("billing_plans"))}),$scope.chooseBillingPlan=function(id,name){$localStorage.user={billing_plan:id},$state.transitionTo("signup")},$scope.initBillingPlans=function(){$scope.newUser={},$scope.setResource(BillingPlans),$scope.list()},$scope.initLoginRedirect=function(){setTimeout(function(){$state.go("login")},1e4)},$scope.countries=Countries.query(),$scope.getQueryString=function(model){var q="?first_name="+encodeURIComponent(model.firstname?model.firstname:"")+"&last_name="+encodeURIComponent(model.lastname?model.lastname:"")+"&email="+encodeURIComponent(model.email?model.email:"")+"&phone="+encodeURIComponent(model.phone_number?model.phone_number:"")+"&reference="+encodeURIComponent(model.user_id?model.user_id:"")+"&organization="+encodeURIComponent(model.companyName?model.companyName:"")+"&billing_address="+encodeURIComponent(model.address1?model.address1:"")+"&billing_address_2="+encodeURIComponent(model.address2?model.address2:"")+"&billing_city="+encodeURIComponent(model.city?model.city:"")+"&billing_zip="+encodeURIComponent(model.zipcode?model.zipcode:"")+"&billing_country="+encodeURIComponent(model.country?model.country:"");$scope.query=q},$scope.zipRegex="[0-9]{1,10}",$scope.phoneRegex="[0-9, \\s, \\+, \\-, \\(, \\)]{1,20}",$scope.createUser=function(model){if(model){if(model.passwordConfirm!==model.password)return void $scope.alertService.danger("Passwords did not match",5e3);$scope.userData=_.clone(model),$scope.alertService.clear(),delete model.passwordConfirm,model.collection_method=["Automatic"],model.billing_schedule="monthly",Users.signup(model).$promise.then(function(data){$localStorage.user.email=model.email,$state.go("email_sent")})["catch"](function(err){AlertService.danger(err,5e3)})}},$scope._loading=!1}SignupController.$inject=["$scope","Users","$localStorage","User","Companies","BillingPlans","CRUDController","Countries","$state","AlertService","$injector"],angular.module("revapm.Portal.Signup").controller("SignupController",SignupController)}(),function(){"use strict";function VerifyController($scope,Users,User,$stateParams,$state,AlertService,$localStorage,$window){$scope.user=User.getUser(),$scope.resendToken=function(model){Users.resend({email:model.email}).$promise.then(function(){AlertService.success("Verification link is sent to "+model.email,5e3)})["catch"](AlertService.danger)},$scope.getQueryString=function(model){var q="?first_name="+encodeURIComponent(model.firstname?model.firstname:"")+"&last_name="+encodeURIComponent(model.lastname?model.lastname:"")+"&email="+encodeURIComponent(model.email?model.email:"")+"&phone="+encodeURIComponent(model.phone_number?model.phone_number:"")+"&reference="+encodeURIComponent(model.user_id?model.user_id:"")+"&organization="+encodeURIComponent(model.companyName?model.companyName:"")+"&billing_address="+encodeURIComponent(model.address1?model.address1:"")+"&billing_address_2="+encodeURIComponent(model.address2?model.address2:"")+"&billing_city="+encodeURIComponent(model.city?model.city:"")+"&billing_state="+encodeURIComponent(model.state&&"US"===model.country?model.state:"")+"&billing_zip="+encodeURIComponent(model.zipcode?model.zipcode:"")+"&billing_country="+encodeURIComponent(model.country?model.country:"");return q},$stateParams.token&&Users.verify({token:$stateParams.token}).$promise.then(function(res){$localStorage.user={email:res.email};var q=$scope.getQueryString(res);$window.location.href=res.hosted_page+q})["catch"](function(){$state.go("resend_token")})}VerifyController.$inject=["$scope","Users","User","$stateParams","$state","AlertService","$localStorage","$window"],angular.module("revapm.Portal.Signup").controller("VerifyController",VerifyController)}(),function(){"use strict";function routesConfig($stateProvider){$stateProvider.state("signup",{url:"/signup/contact_info",views:{layout:{controller:"SignupController",templateUrl:"parts/signup/signup.html"},params:{billing_plan:null}}}).state("billing_plans",{url:"/signup/billing_plans",views:{layout:{controller:"SignupController",templateUrl:"parts/signup/billing_plans.html"}}}).state("success",{url:"/signup/success",views:{layout:{controller:"SignupController",templateUrl:"parts/signup/end.html"}}}).state("email_sent",{url:"/signup/email",views:{layout:{controller:"VerifyController",templateUrl:"parts/signup/email_sent.html"}}}).state("verify",{url:"/profile/verify/:token",views:{layout:{controller:"VerifyController",templateUrl:"parts/signup/verify.html"}}}).state("resend_token",{url:"/profile/verify/resend_token",views:{layout:{controller:"VerifyController",templateUrl:"parts/signup/resend.html"}}})}routesConfig.$inject=["$stateProvider"],angular.module("revapm.Portal.Signup").config(routesConfig)}(),function(){"use strict";function BillingPlansResource(Resource,$config){return Resource($config.API_URL+"/billing_plans/:id",{id:"@id"},{hosted_page:{url:$config.API_URL+"/billing_plans/:id/hosted_page",method:"GET"}})}BillingPlansResource.$inject=["Resource","$config"],angular.module("revapm.Portal.Resources").factory("BillingPlans",BillingPlansResource)}(),function(){"use strict";angular.module("revapm.Portal.Profile",["ui.router","revapm.Portal.Shared","revapm.Portal.Config","revapm.Portal.Resources"])}(),function(){"use strict";function routesConfig($stateProvider){$stateProvider.state("index.accountSettings.profile",{url:"/profile",views:{main:{controller:"ProfileEditController",templateUrl:"parts/profile/edit.html"}}}).state("index.accountSettings.activitylog",{url:"/activitylog",views:{main:{controller:"ActivityLogController",templateUrl:"parts/profile/activity-log.html"}}}).state("index.accountSettings.2fa",{url:"/2fa",views:{main:{controller:"TwoFactorAuthController",templateUrl:"parts/profile/two-factor-auth.html"}}})}routesConfig.$inject=["$stateProvider"],angular.module("revapm.Portal.Profile").config(routesConfig)}(),function(){"use strict";function ProfileEditController($scope,User,AlertService){$scope.user=User.getUser(),$scope.pass={current_password:"",new_password:"",confirm_password:""},$scope.clearPassword=function(){$scope.pass={current_password:"",new_password:"",confirm_password:""}},$scope.updatePassword=function(){return _.trim($scope.pass.current_password)&&_.trim($scope.pass.new_password)?$scope.pass.new_password!=$scope.pass.confirm_password?void AlertService.danger("Passwords did not match",5e3):User.updatePassword($scope.pass.current_password,$scope.pass.new_password).then(function(data){return $scope.clearPassword(),AlertService.success("Your password updated",5e3),data})["catch"](function(err){err.data&&err.data.message?AlertService.danger(err.data.message):AlertService.danger("Something goes wrong")}):void AlertService.danger("Please fill all fields. (New password should be at least 8 charecters length)",5e3)},$scope.updateProfile=function(user){$scope.updatePassword()}}ProfileEditController.$inject=["$scope","User","AlertService"],angular.module("revapm.Portal.Profile").controller("ProfileEditController",ProfileEditController)}(),function(){"use strict";function ActivityLogController($scope,CRUDController,Activity,$injector,$stateParams,ActivityPhrase,$modal){$injector.invoke(CRUDController,this,{$scope:$scope,$stateParams:$stateParams}),$scope.setResource(Activity),$scope.setState("index.accountSettings.companies"),$scope.list=function(){if(!$scope.resource)throw new Error("No resource provided.");return $scope.loading(!0),$scope.resource.query(function(data){return $scope.records=data.data,$scope.filterList(),$scope._checkPagination(),data}).$promise["finally"](function(){$scope.loading(!1)})},$scope.list(),$scope.getActivityType=function(val){return ActivityPhrase.ACTIVITY_TYPE&&ActivityPhrase.ACTIVITY_TYPE[val]?ActivityPhrase.ACTIVITY_TYPE[val]:"Unknown activity type: "+val},$scope.getActivityTarget=function(log){if(!ActivityPhrase.ACTIVITY_TARGET||!ActivityPhrase.ACTIVITY_TARGET[log.activity_target])return"Unknown activity target: "+log.activity_target;var target="";return log.target_name&&(target=" ("+log.target_name+")"),ActivityPhrase.ACTIVITY_TARGET[log.activity_target]+target},$scope.showDetails=function(log){var log=angular.copy(log);log.target_object=JSON.stringify(log.target_object,null,"    "),log.activity=$scope.getActivityType(log.activity_type),log.activity+=" "+$scope.getActivityTarget(log);var modalInstance=$modal.open({animation:!0,templateUrl:"activityDetails.html",controller:"ConfirmModalInstanceCtrl",size:"md",resolve:{model:log}});return modalInstance.result},$scope.getRelativeDate=function(datetime){return moment.utc(datetime).fromNow()}}ActivityLogController.$inject=["$scope","CRUDController","Activity","$injector","$stateParams","ActivityPhrase","$modal"],angular.module("revapm.Portal.Profile").controller("ActivityLogController",ActivityLogController)}(),function(){"use strict";function TwoFactorAuthController($scope,User,TwoFactorAuth,AlertService,$modal){$scope._loading=!1,$scope.user=User.getUser(),$scope.twoFAEnabled=$scope.user&&$scope.user.two_factor_auth_enabled,$scope.qrImg="",$scope.asciiCode="",$scope.showDisable=!1,$scope.clearCodes=function(){$scope.qrImg="",$scope.asciiCode="",$scope.oneTimePassword="",$scope.hideDisablePart()},$scope.updateUserProfile=function(enabled){$scope.twoFAEnabled=enabled,$scope.clearCodes(),User.reloadUser()},$scope.init=function(){$scope._loading=!0,TwoFactorAuth.init().$promise.then(function(data){data.google_auth_qr&&($scope.qrImg=data.google_auth_qr),data.ascii&&($scope.asciiCode=data.ascii)})["catch"](function(err){AlertService.danger(err,5e3)})["finally"](function(){$scope._loading=!1})},$scope.enable=function(oneTimePassword){return oneTimePassword?($scope._loading=!0,void TwoFactorAuth.enable({oneTimePassword:oneTimePassword}).$promise.then(function(data){AlertService.success(data.message),$scope.updateUserProfile(!0)})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1})):(AlertService.danger("Please enter your One Time Password"),void angular.element("#one-time-password").focus())},$scope.showDisablePart=function(){$scope.showDisable=!0},$scope.hideDisablePart=function(){$scope.showDisable=!1},$scope._disable=function(){$scope._loading=!0,TwoFactorAuth.disable({userId:$scope.user.user_id},{}).$promise.then(function(data){AlertService.success(data.message),$scope.updateUserProfile(!1)})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1})},$scope.confirm=function(){var modalInstance=$modal.open({animation:!0,templateUrl:"confirm2FaDisable.html",controller:"ConfirmModalInstanceCtrl",size:"md",resolve:{model:{isMyUser:$scope.isMyUser,user:$scope.currentUser}}});return modalInstance.result},$scope.disable=function(){$scope.confirm().then($scope._disable)}}TwoFactorAuthController.$inject=["$scope","User","TwoFactorAuth","AlertService","$modal"],angular.module("revapm.Portal.Profile").controller("TwoFactorAuthController",TwoFactorAuthController)}(),function(){"use strict";angular.module("revapm.Portal.Users",["revapm.Portal.Shared","revapm.Portal.Config","revapm.Portal.Resources","ui.router"])}(),function(){"use strict";function routesConfig($stateProvider){$stateProvider.state("index.accountSettings.users",{url:"/users",views:{main:{controller:"UsersCrudController",templateUrl:"parts/users/list.html"}}}).state("index.accountSettings.users.new",{url:"/new",views:{page:{templateUrl:"parts/users/new.html"}}}).state("index.accountSettings.users.edit",{url:"/edit/:id",views:{page:{controller:"UsersCrudController",templateUrl:"parts/users/edit.html"}}})}routesConfig.$inject=["$stateProvider"],angular.module("revapm.Portal.Users").config(routesConfig)}(),function(){"use strict";function UsersCrudController($scope,CRUDController,Users,$injector,$stateParams,Companies,DomainsConfig,$state,$anchorScroll){return $injector.invoke(CRUDController,this,{$scope:$scope,$stateParams:$stateParams}),$scope.auth.isUser()?void $state.go("index.accountSettings.profile"):($scope.setState("index.accountSettings.users"),$scope.setResource(Users),$scope.roles=["user","admin"],$scope.auth.isRevadmin()&&($scope.roles.push("reseller"),$scope.roles.push("revadmin")),$scope.companies=Companies.query(),$scope.domains=DomainsConfig.query(),$scope.model||($scope.model={theme:"light",access_control_list:{dashBoard:!0,reports:!1,configure:!1,test:!1,readOnly:!1}}),$scope.getUser=function(id){$scope.get(id)["catch"](function(err){$scope.alertService.danger("Could not load domain details")})},$scope.deleteUser=function(model){$scope.confirm("confirmModal.html",model).then(function(){$scope["delete"](model)["catch"]($scope.alertService.danger)})},$scope.updateUser=function(model){model&&($scope.alertService.clear(),model.id=model.user_id,$scope.update(model).then(function(data){$scope.alertService.success("User updated",5e3)})["catch"]($scope.alertService.danger))},$scope.getRelativeDate=function(datetime){return moment.utc(datetime).fromNow()},$scope.createUser=function(model){if(model){if(model.passwordConfirm!==model.password)return void $scope.alertService.danger("Passwords did not match",5e3);$scope.alertService.clear(),delete model.passwordConfirm,model.access_control_list.dashBoard=!0,$scope.create(model).then(function(data){$scope.alertService.success("User created",5e3)})["catch"]($scope.alertService.danger)}},void $scope.$on("$stateChangeSuccess",function(state){$scope.list().then(function(){$scope.elementIndexForAnchorScroll&&setTimeout(function(){$anchorScroll("anchor"+$scope.elementIndexForAnchorScroll),$scope.$digest()},500)})}))}UsersCrudController.$inject=["$scope","CRUDController","Users","$injector","$stateParams","Companies","DomainsConfig","$state","$anchorScroll"],angular.module("revapm.Portal.Users").controller("UsersCrudController",UsersCrudController)}(),function(){"use strict";angular.module("revapm.Portal.Apps",["ngStorage","revapm.Portal.Shared","revapm.Portal.Config","revapm.Portal.Resources","ui.router","ui.select","ng.jsoneditor","ngSanitize"])}(),function(){"use strict";function routesConfig($stateProvider){$stateProvider.state("index.apps.android",{url:"/android",data:{platform:"Android",list:!0},views:{main:{controller:"AppsController",templateUrl:"parts/apps/list.html"}}}).state("index.apps.ios",{url:"/ios",data:{platform:"iOS",list:!0},views:{main:{controller:"AppsController",templateUrl:"parts/apps/list.html"}}}).state("index.apps.wm",{url:"/wm",data:{platform:"Windows Mobile",list:!0},views:{main:{templateUrl:"parts/apps/list.html",controller:"AppsController"}}}).state("index.apps.ios.new",{url:"/new",views:{page:{templateUrl:"parts/apps/new.html",controller:"AppsController"}}}).state("index.apps.ios.configure",{url:"/configure/:id",views:{page:{templateUrl:"parts/apps/configure.html",controller:"AppsController"}}}).state("index.apps.ios.edit",{url:"/edit/:id",views:{page:{templateUrl:"parts/apps/edit.html",controller:"AppEditController"}}}).state("index.apps.ios.versions",{url:"/versions/:id/",views:{page:{templateUrl:"parts/apps/versions.html",controller:"AppVersionsController"}}}).state("index.apps.android.new",{url:"/new",views:{page:{templateUrl:"parts/apps/new.html",controller:"AppsController"}}}).state("index.apps.android.configure",{url:"/configure/:id",views:{page:{templateUrl:"parts/apps/configure.html",controller:"AppsController"}}}).state("index.apps.android.edit",{url:"/edit/:id",views:{page:{templateUrl:"parts/apps/edit.html",controller:"AppEditController"}}}).state("index.apps.android.versions",{url:"/versions/:id/",views:{page:{templateUrl:"parts/apps/versions.html",controller:"AppVersionsController"}}}).state("index.apps.wm.new",{url:"/new",views:{page:{templateUrl:"parts/apps/new.html",controller:"AppsController"}}}).state("index.apps.wm.configure",{url:"/configure/:id",views:{page:{templateUrl:"parts/apps/configure.html",controller:"AppsController"}}}).state("index.apps.wm.edit",{url:"/edit/:id",views:{page:{templateUrl:"parts/apps/edit.html",controller:"AppEditController"}}}).state("index.apps.wm.versions",{url:"/versions/:id/",views:{page:{templateUrl:"parts/apps/versions.html",controller:"AppVersionsController"}}})}routesConfig.$inject=["$stateProvider"],angular.module("revapm.Portal.Apps").config(routesConfig)}(),function(){"use strict";function AppsController($scope,$anchorScroll,User,Companies,Apps,CRUDController,$injector,$state,$stateParams,AlertService,$localStorage){$injector.invoke(CRUDController,this,{$scope:$scope,$stateParams:$stateParams}),$scope.setResource(Apps),$scope.$state=$state,$scope._baseFilter={app_platform:$state.current.data.platform},$scope.$on("$stateChangeSuccess",function(state){$scope.list().then(function(){$scope.elementIndexForAnchorScroll&&setTimeout(function(){$anchorScroll("anchor"+$scope.elementIndexForAnchorScroll),$scope.$digest()},500)})}),$scope.companies=[],$scope.model={configs:[{}]},$scope.copyForEditor={},$scope.obj={data:{},options:{mode:"code",modes:["code","view"],error:function(err){alert(err.toString())}}},$scope.filterKeys=["app_name","app_platform","last_app_published_version","updated_at"],$scope.getRelativeDate=function(datetime){return moment.utc(datetime).fromNow()},$scope.model.account_id=$scope.auth.getUser().companyId[0],User.getUserDomains(!0).then(function(domains){$scope.domainList=domains.map(function(d){return d.domain_name})}),$scope.fetchCompanies=function(companyIds){var promises=[];companyIds.forEach(function(id){promises.push(Companies.get({id:id}).$promise)}),$q.all(promises).then(function(data){$scope.companies=data})},$scope["switch"]=function(item){item.show===!0?item.show=!1:item.show=!0},$scope.initEdit=function(id){$scope.get(id).then(function(){$scope.copyForEditor=_.clone($scope.model),delete $scope.copyForEditor.$promise,delete $scope.copyForEditor.$resolved,delete $scope.copyForEditor.id,delete $scope.copyForEditor.account_id,delete $scope.copyForEditor.app_platform,delete $scope.copyForEditor.sdk_key,delete $scope.copyForEditor.created_at,delete $scope.copyForEditor.updated_at,delete $scope.copyForEditor.updated_by,delete $scope.copyForEditor.created_by})["catch"](function(err){$scope.alertService.danger("Could not load app details")})},$scope.initNew=function(){$scope.platforms=[{name:"iOS",disabled:!1},{name:"Android",disabled:!1},{name:"Windows Mobile",disabled:!0}];var idx=_.findIndex($scope.platforms,{name:$state.current.data.platform});$scope.model.app_platform=$scope.platforms[idx]},$scope.auth.isReseller()||$scope.auth.isRevadmin()?Companies.query(function(list){$scope.companies=list,1===$scope.companies.length&&($scope.model.account_id=$scope.companies[0].id)}):angular.isArray($scope.auth.getUser().companyId)?1===$scope.auth.getUser().companyId.length?$scope.model.account_id=$scope.auth.getUser().companyId[0]:$scope.fetchCompanies($scope.auth.getUser().companyId):$scope.model.account_id=$scope.auth.getUser().companyId,$scope.getApp=function(id){$scope.get(id)["catch"](function(err){$scope.alertService.danger("Could not load domain details")})},$scope.createApp=function(model){var modelCopy=_.clone(model);delete modelCopy.configs,modelCopy.app_platform=model.app_platform.name,$scope.create(modelCopy).then(function(){model.app_name="",$scope.alertService.success("App registered",5e3)})},$scope.cleanModel=function(model){var modelCopy=_.clone(model);({id:model.id});return delete modelCopy.$promise,delete modelCopy.$resolved,delete modelCopy.id,delete modelCopy.account_id,delete modelCopy.app_platform,delete modelCopy.sdk_key,delete modelCopy.created_at,delete modelCopy.updated_at,delete modelCopy.updated_by,delete modelCopy.created_by,modelCopy},$scope.updateApp=function(model){$scope.confirm("confirmUpdateModal.html",model).then(function(){$scope._loading=!0;var params={id:$scope.model.id};$scope.update(params,$scope.cleanModel(model)).then(function(){$scope.alertService.success("App updated",5e3)})["catch"](function(err){$scope.alertService.danger(err.data.message||"Oops something went wrong",5e3)})["finally"](function(){delete model.$promise,delete model.$resolved,delete model.$rejected,_.assign($scope.model,model),$scope._loading=!1})})},$scope.verify=function(model){return $scope.model.id?($scope._loading=!0,void Apps.update({id:$scope.model.id,options:"verify_only"},$scope.cleanModel(model)).$promise.then(function(data){$scope.alertService.success("App configuration is correct",5e3)})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1})):void AlertService.danger("Please select app first")},$scope.publish=function(model){return $scope.model.id?void $scope.confirm("confirmPublishModal.html",model).then(function(){$scope._loading=!0,Apps.update({id:$scope.model.id,options:"publish"},$scope.cleanModel(model)).$promise.then(function(data){$scope.alertService.success("App configuration is published",5e3)})["catch"](function(err){AlertService.danger(err)})["finally"](function(){_.assign($scope.model,model),$scope._loading=!1})}):void AlertService.danger("Please select app first")},$scope.deleteApp=function(model){$scope.confirm("confirmModal.html",model).then(function(){var appName=model.app_name;$scope["delete"](model).then(function(data){$scope.alertService.success("App "+appName+" deleted.")})["catch"](function(err){$scope.alertService.danger(err)})["finally"](function(){$scope.page.current>$scope.page.pages.length&&$scope.prevPage()})})},$scope.storeToStorage=function(app){var newApp={app_id:app.id,id:app.id,app_name:app.app_name,sdk_key:app.sdk_key};$localStorage.selectedApplication=newApp}}AppsController.$inject=["$scope","$anchorScroll","User","Companies","Apps","CRUDController","$injector","$state","$stateParams","AlertService","$localStorage"],angular.module("revapm.Portal.Apps").controller("AppsController",AppsController)}(),function(){"use strict";function AppVersionsController($scope,Apps,$stateParams,AlertService,$timeout,$window,$filter){$scope._loading=!0,$scope.id=$stateParams.id,$scope.app=Apps.get({id:$stateParams.id}),$scope.versions=[],$scope.currentVersion={},$scope.initVersions=function(){$scope.obj={data:"Configuration will appear here",options:{mode:"code",modes:["code","view"],error:function(err){$window.alert(err.toString())}}}},$scope.format=function(item){item.updated_by?" Updated by "+item.updated_by:" Updated ";return"Version "+item.app_published_version+" Last updated at "+$filter("date")(new Date(item.updated_at),"MMM dd, yyyy H:mm:ss a")},$scope.onChangeVersion=function(){if(!$scope.currentVersion)return void($scope.obj.data="{}");var idx=_.findIndex($scope.versions,{updated_at:$scope.currentVersion});$scope._loading=!0,Apps.get({id:$stateParams.id,version:idx+1}).$promise.then(function(data){$scope.obj.data=JSON.stringify(data,null,2)})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1})},Apps.versions({id:$stateParams.id}).$promise.then(function(data){angular.isArray(data)&&($scope.versions=data)})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1}),$timeout(function(){$scope.obj.options.mode="code"},10)}AppVersionsController.$inject=["$scope","Apps","$stateParams","AlertService","$timeout","$window","$filter"],angular.module("revapm.Portal.Apps").controller("AppVersionsController",AppVersionsController)}(),function(){"use strict";function AppEditController($scope,Apps,User,CRUDController,$injector,$state,$stateParams,AlertService){$injector.invoke(CRUDController,this,{$scope:$scope,$stateParams:$stateParams}),$scope.setResource(Apps),$scope.$state=$state,$scope.model={configs:[{}]},$scope.SDKVersionsInConfigs=[],$scope.configuration={},$scope.domainsListPlaceholder="Add domains...",$scope.fieldsToShow=[],$scope.model.configs.domains_white_list=[],$scope.model.configs.domains_black_list=[],$scope.protocols=["standard","quic","rmp"],$scope.initEdit=function(id){$scope._loading=!0,$scope.get(id).then(function(){$scope.configuration=$scope.model.configs[0],$scope.SDKVersionsInConfigs=$scope.model.configs.map(function(config){return config.sdk_release_version})}).then(function(){Apps.sdkReleases().$promise.then(function(data){$scope.availableSDKVersions=_.xor(data[$state.current.data.platform],$scope.SDKVersionsInConfigs)}),$scope.selectedSDKVersion=$scope.SDKVersionsInConfigs[0],$scope.fieldsToShow=_.keys($scope.model.configs[0]),$scope.auth.isReseller()||$scope.auth.isRevadmin()?User.getUserDomains(!0).then(function(domains){var domainList=_.filter(domains,{account_id:$scope.model.account_id}).map(function(d){return d.domain_name});$scope.domainList=_.uniq(domainList)}):User.getUserDomains(!0).then(function(domains){$scope.domainList=domains.map(function(d){return d.domain_name})})})["catch"](function(err){$scope.alertService.danger("Could not load app details")})["finally"](function(){$scope.$watch("selectedSDKVersion",function(){onSelectedSDKVersionChange()}),$scope._loading=!1})};var onSelectedSDKVersionChange=function(){var idx=_.findIndex($scope.model.configs,{sdk_release_version:$scope.selectedSDKVersion});$scope.configuration=$scope.model.configs[idx],$scope.configuration.allowed_transport_protocols||($scope.configuration.allowed_transport_protocols=[]),$scope.configuration.domains_white_list||($scope.configuration.domains_white_list=[]),$scope.configuration.domains_black_list||($scope.configuration.domains_black_list=[]),$scope.fieldsToShow=_.keys($scope.model.configs[idx])};$scope.toggleProtocolSelection=function(protocol,model){var idx=model.allowed_transport_protocols.indexOf(protocol);idx>-1?model.allowed_transport_protocols.splice(idx,1):model.allowed_transport_protocols.push(protocol)},$scope.isVersion=function(version){return version===$scope.selectedSDKVersion},$scope.isShown=function(name){return $scope.fieldsToShow.findIndex(name)>-1},$scope.addNewSDKConfig=function(version,model){$scope.availableSDKVersions=_.without($scope.availableSDKVersions,version),model.configs.push({sdk_release_version:version}),$scope.SDKVersionsInConfigs.push(version),$scope.selectedSDKVersion=version,$scope.configuration={sdk_release_version:version,allowed_transport_protocols:[],domains_white_list:[],domains_black_list:[]}},$scope.updateConfig=function(model,config){$scope.confirm("confirmUpdateModal.html",model).then(function(){var idx=_.findIndex(model.configs,{sdk_release_version:config.sdk_release_version});model.configs[idx]=config,$scope.update({id:model.id},$scope.cleanModel(model)).then(function(){$scope.alertService.success("App updated",5e3)})["catch"](function(err){$scope.alertService.danger(err.data.message||"Oops something went wrong",5e3)})})},$scope.verify=function(model,config){var idx=_.findIndex(model.configs,{sdk_release_version:config.sdk_release_version});model.configs[idx]=config,$scope._loading=!0,$scope.update({id:model.id,options:"verify_only"},$scope.cleanModel(model)).then(function(data){$scope.alertService.success("App configuration is correct",5e3)})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1})},$scope.publish=function(model,config){return model.id?void $scope.confirm("confirmPublishModal.html",model).then(function(){var idx=_.findIndex(model.configs,{sdk_release_version:config.sdk_release_version});model.configs[idx]=config,$scope._loading=!0,Apps.update({id:model.id,options:"publish"},$scope.cleanModel(model)).$promise.then(function(data){$scope.alertService.success("App configuration is published",5e3)})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1})}):void AlertService.danger("Please select app first")},$scope.cleanModel=function(model){var modelCopy=_.clone(model);({id:model.id});return delete modelCopy.$promise,delete modelCopy.$resolved,delete modelCopy.id,delete modelCopy.account_id,delete modelCopy.app_platform,delete modelCopy.sdk_key,delete modelCopy.created_at,delete modelCopy.updated_at,delete modelCopy.updated_by,delete modelCopy.created_by,modelCopy}}AppEditController.$inject=["$scope","Apps","User","CRUDController","$injector","$state","$stateParams","AlertService"],angular.module("revapm.Portal.Apps").controller("AppEditController",AppEditController)}(),function(){"use strict";function appStagingStatus(Apps,$config,$interval,$rootScope,$state){
return{template:'<i class="glyphicon" ng-class="iconStaging" tooltip="{{tooltipStaging}}"></i>&nbsp;&nbsp;&nbsp;<i class="glyphicon" ng-class="iconGlobal" tooltip="{{tooltipGlobal}}"></i>',scope:{ngId:"="},controller:["$scope",function($scope){var intervalPromise,appId;$scope.iconStaging="glyphicon-refresh spin",$scope.tooltipStaging="Staging Status",$scope.iconGlobal="glyphicon-refresh spin",$scope.tooltipGlobal="Global Status",$scope.shouldRefresh=!0,$scope.startRefresh=function(){!appId||!$scope.shouldRefresh||$state.includes("index.apps.*.new")||$state.includes("index.apps.*.edit")||$state.includes("index.apps.*.configure")||$state.includes("index.apps.*.versions")||(intervalPromise=$interval($scope.fetchStatus,$config.DOMAIN_STATUS_REFRESH_INTERVAL,1))},$scope.stopRefresh=function(){angular.isDefined(intervalPromise)&&($interval.cancel(intervalPromise),intervalPromise=void 0,$scope.shouldRefresh=!1)},$scope.fetchStatus=function(id){(id||appId)&&(!id&&appId&&(id=appId),Apps.status({id:id}).$promise.then(function(data){$config.DOMAIN_STAGING_STATUS_ICONS[data.staging_status]&&($scope.iconStaging=$config.DOMAIN_STAGING_STATUS_ICONS[data.staging_status]),$scope.tooltipStaging="Staging Status: "+data.staging_status,$config.DOMAIN_PRODUCTION_STATUS_ICONS[data.global_status]&&($scope.iconGlobal=$config.DOMAIN_PRODUCTION_STATUS_ICONS[data.global_status]),$scope.tooltipGlobal="Global Status: "+data.global_status,$scope.startRefresh()})["catch"](function(err){$scope.iconStaging="glyphicon-remove text-danger",$scope.tooltipStaging="Staging Status: Error",$scope.iconGlobal="glyphicon-remove text-danger",$scope.tooltipGlobal="Global Status: Error",$scope.stopRefresh()}))},$scope.$on("$destroy",function(){$scope.stopRefresh()}),$rootScope.$on("$stateChangeStart",function(event){$scope.stopRefresh()}),$scope.$watch("ngId",function(newValue){newValue&&(appId=newValue,$scope.shouldRefresh=!0,$scope.fetchStatus(newValue))})}]}}appStagingStatus.$inject=["Apps","$config","$interval","$rootScope","$state"],angular.module("revapm.Portal.Apps").directive("appStagingStatus",appStagingStatus)}(),function(){"use strict";function appSelectDirective(User,AlertService){return{restrict:"AE",templateUrl:"parts/apps/app-select.html",scope:{ngModel:"=",onSelect:"&"},controller:["$scope",function($scope){$scope.apps=[],$scope._loading=!0,$scope.onAppSelect=function(app){$scope.ngModel=app,User.selectApplication(app)},!$scope.ngModel&&User.getSelectedApplication()&&($scope.ngModel=User.getSelectedApplication()),User.getUserApps().then(function(apps){$scope.apps=apps})["catch"](function(){AlertService.danger("Oops! Something went wrong")})["finally"](function(){$scope._loading=!1}),$scope.$watch("ngModel",function(){$scope.onSelect&&$scope.onSelect()})}]}}appSelectDirective.$inject=["User","AlertService"],angular.module("revapm.Portal.Apps").directive("appSelect",appSelectDirective)}(),function(){"use strict";angular.module("revapm.Portal.Domains",["ngStorage","revapm.Portal.Shared","revapm.Portal.Config","revapm.Portal.Resources","ui.router","ui.select","ng.jsoneditor","ngSanitize"])}(),function(){"use strict";function routesConfig($stateProvider){$stateProvider.state("index.webApp.domains",{url:"/domains",views:{main:{controller:"DomainsCrudController",templateUrl:"parts/domains/list.html"}}}).state("index.webApp.domains.advanced",{url:"/configure/:id",views:{page:{controller:"DomainsConfigureAdvancedController",templateUrl:"parts/domains/configure_advanced.html"}}}).state("index.webApp.domains.new",{url:"/new",views:{page:{templateUrl:"parts/domains/new.html"}}}).state("index.webApp.domains.edit",{url:"/edit/:id",views:{page:{templateUrl:"parts/domains/edit.html",controller:"DomainsCrudController"}}}).state("index.webApp.domains.versions",{url:"/versions/:id",views:{page:{controller:"DomainVersionsController",templateUrl:"parts/domains/versions.html"}}})}routesConfig.$inject=["$stateProvider"],angular.module("revapm.Portal.Domains").config(routesConfig)}(),function(){"use strict";function domainSelectDirective(User,$localStorage,AlertService){return{restrict:"AE",templateUrl:"parts/domains/domain-select/domain-select.html",scope:{selectOne:"=",ngModel:"=",onSelect:"&"},controller:["$scope",function($scope){$scope.domains=[],$scope._loading=!0,$scope.data={model:""},$scope.onModelSelect=function($model){$scope.ngModel=$model,$localStorage.selectedDomain=$model},User.getUserDomains(!0).then(function(domains){if($scope.domains=domains,1===domains.length&&$scope.selectOne&&($scope.onModelSelect($scope.domains[0]),$scope.ngDomain=$scope.domains[0]),$localStorage.selectedDomain&&$localStorage.selectedDomain.id){var ind=_.findIndex(domains,function(d){return d.id===$localStorage.selectedDomain.id});$scope.onModelSelect($scope.domains[ind]),$scope.ngDomain=$scope.domains[ind]}})["catch"](function(){AlertService.danger("Oops something wrong")})["finally"](function(){$scope._loading=!1}),$scope.$watch("ngModel",function(){$scope.onSelect()})}]}}domainSelectDirective.$inject=["User","$localStorage","AlertService"],angular.module("revapm.Portal.Domains").directive("domainSelect",domainSelectDirective)}(),function(){"use strict";function domainStagingStatus(DomainsConfig,$config,$interval,$rootScope,$state){return{template:'<i class="glyphicon" ng-class="iconStaging" tooltip="{{tooltipStaging}}"></i>&nbsp;&nbsp;&nbsp;<i class="glyphicon" ng-class="iconGlobal" tooltip="{{tooltipGlobal}}"></i>',scope:{ngId:"="},controller:["$scope",function($scope){var intervalPromise,domainId;$scope.iconStaging="glyphicon-refresh spin",$scope.tooltipStaging="Staging Status",$scope.iconGlobal="glyphicon-refresh spin",$scope.tooltipGlobal="Global Status",$scope.shouldRefresh=!0,$scope.startRefresh=function(){!domainId||!$scope.shouldRefresh||$state.includes("index.webApp.domains.new")||$state.includes("index.webApp.domains.edit")||$state.includes("index.webApp.domains.advanced")||$state.includes("index.webApp.domains.versions")||(intervalPromise=$interval($scope.fetchStatus,$config.DOMAIN_STATUS_REFRESH_INTERVAL,1))},$scope.stopRefresh=function(){angular.isDefined(intervalPromise)&&($interval.cancel(intervalPromise),intervalPromise=void 0,$scope.shouldRefresh=!1)},$scope.fetchStatus=function(id){(id||domainId)&&(!id&&domainId&&(id=domainId),DomainsConfig.status({id:id}).$promise.then(function(data){$config.DOMAIN_STAGING_STATUS_ICONS[data.staging_status]&&($scope.iconStaging=$config.DOMAIN_STAGING_STATUS_ICONS[data.staging_status]),$scope.tooltipStaging="Staging Status: "+data.staging_status,$config.DOMAIN_PRODUCTION_STATUS_ICONS[data.global_status]&&($scope.iconGlobal=$config.DOMAIN_PRODUCTION_STATUS_ICONS[data.global_status]),$scope.tooltipGlobal="Global Status: "+data.global_status,$scope.startRefresh()})["catch"](function(err){console.log(err),$scope.iconStaging="glyphicon-remove text-danger",$scope.tooltipStaging="Staging Status: Error",$scope.iconGlobal="glyphicon-remove text-danger",$scope.tooltipGlobal="Global Status: Error",$scope.stopRefresh()}))},$scope.$on("$destroy",function(){$scope.stopRefresh()}),$rootScope.$on("$stateChangeStart",function(event){$scope.stopRefresh()}),$scope.$watch("ngId",function(newValue){newValue&&(domainId=newValue,$scope.shouldRefresh=!0,$scope.fetchStatus(newValue))})}]}}domainStagingStatus.$inject=["DomainsConfig","$config","$interval","$rootScope","$state"],angular.module("revapm.Portal.Domains").directive("domainStagingStatus",domainStagingStatus)}(),function(){"use strict";function DomainsCrudController($scope,$localStorage,CRUDController,DomainsConfig,$injector,$stateParams,$config,Companies,$http,$q,$state,$anchorScroll){$injector.invoke(CRUDController,this,{$scope:$scope,$stateParams:$stateParams}),$scope.setState("index.webApp.domains"),$scope.setResource(DomainsConfig),$scope.$on("$stateChangeSuccess",function(state){$state.is($scope.state)&&$scope.list().then(function(){$scope.elementIndexForAnchorScroll&&setTimeout(function(){$anchorScroll("anchor"+$scope.elementIndexForAnchorScroll),$scope.$digest()},500)})}),$scope.locations=[],$scope.companies=[],$scope.model={},$scope.fetchLocations=function(){$http.get($config.API_URL+"/locations/firstmile").then(function(data){data.status==$config.STATUS.OK&&($scope.locations=data.data)})},$scope.fetchCompanies=function(companyIds){var promises=[];companyIds.forEach(function(id){promises.push(Companies.get({id:id}).$promise)}),$q.all(promises).then(function(data){$scope.companies=data})},$scope.prepareSimpleDomainUpdate=function(model){return model=_.clone(model.toJSON()),model.rev_component_bp&&(delete model.rev_component_bp.cache_opt_choice,delete model.rev_component_bp.certificate_urls,delete model.rev_component_bp.ssl_certificates),model.domain_name&&delete model.domain_name,delete model.cname,delete model.origin_protocol,delete model.id,model},$scope.setAccountId=function(){$scope.auth.isReseller()||$scope.auth.isRevadmin()?Companies.query(function(list){$scope.companies=list,1===$scope.companies.length&&($scope.model.account_id=$scope.companies[0].id)}):angular.isArray($scope.auth.getUser().companyId)?1===$scope.auth.getUser().companyId.length?$scope.model.account_id=$scope.auth.getUser().companyId[0]:$scope.fetchCompanies($scope.auth.getUser().companyId):$scope.model.account_id=$scope.auth.getUser().companyId},$scope.setAccountId(),$scope.fetchLocations(),$scope.getDomain=function(id){$scope.get(id)["catch"](function(err){$scope.alertService.danger("Could not load domain details")})},$scope.deleteDomain=function(model){$scope.confirm("confirmModal.html",model).then(function(){var domainName=model.domain_name;$scope["delete"](model).then(function(data){$scope.alertService.success("Domain "+domainName+" deleted."),$scope.list()})["catch"](function(err){$scope.alertService.danger(err)})})},$scope.createDomain=function(model){$scope.create(model).then(function(){$scope.alertService.success("Domain created",5e3),$scope.setAccountId()})["catch"]($scope.alertService.danger)},$scope.publishDomain=function(model){if(model){model.id||(model.id=$stateParams.id);var modelId=model.id;$scope.confirm("confirmPublishModal.html",model).then(function(){model=$scope.prepareSimpleDomainUpdate(model),$scope.update({id:modelId,options:"publish"},model).then(function(data){$scope.alertService.success("Domain configuration published",5e3)})["catch"](function(err){$scope.alertService.danger(err)})})}},$scope.validateDomain=function(model){if(model){model.id||(model.id=$stateParams.id);var modelId=model.id;model=$scope.prepareSimpleDomainUpdate(model),$scope.update({id:modelId,options:"verify_only"},model).then(function(data){$scope.alertService.success("The domain configuration is correct",5e3)})["catch"](function(err){$scope.alertService.danger(err.data.message||"Oops something ment wrong",5e3)})}},$scope.updateDomain=function(model){if(model){model.id||(model.id=$stateParams.id);var modelId=model.id;$scope.confirm("confirmUpdateModal.html",model).then(function(){model=$scope.prepareSimpleDomainUpdate(model),$scope.update({id:modelId},model).then(function(){$scope.alertService.success("Domain updated",5e3)})["catch"](function(err){$scope.alertService.danger(err.data.message||"Oops something ment wrong",5e3)})})}},$scope.storeToStorage=function(model){$localStorage.selectedDomain=model},$scope.getRelativeDate=function(datetime){return moment.utc(datetime).fromNow()}}DomainsCrudController.$inject=["$scope","$localStorage","CRUDController","DomainsConfig","$injector","$stateParams","$config","Companies","$http","$q","$state","$anchorScroll"],angular.module("revapm.Portal.Domains").controller("DomainsCrudController",DomainsCrudController)}(),function(){"use strict";function DomainsConfigureAdvancedController($scope,DomainsConfig,$timeout,AlertService,$stateParams){$scope.id=$stateParams.id,$scope.clearDomain=function(model){return delete model.domain_name,delete model.cname,delete model.id,model},$scope._loading=!1,$scope.$watch(function(){return $scope.obj.data},function(newValue,oldValue){$scope.domain&&!newValue.origin_host_header&&($scope.obj.data=oldValue)}),$scope.obj={data:{},options:{mode:"code",modes:["code","view"],error:function(err){alert(err.toString())}}},$scope.loadDomainDetails=function(){DomainsConfig.get({id:$scope.id}).$promise.then(function(data){$scope.domain=data,$scope.obj.data=$scope.clearDomain(data.toJSON())})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1})},$scope.$on("$stateChangeSuccess",function(state){$scope.loadDomainDetails()}),$scope.verify=function(){return $scope.id?($scope._loading=!0,void DomainsConfig.update({id:$scope.id,options:"verify_only"},$scope.obj.data).$promise.then(function(data){$scope.alertService.success("The domain configuration is correct",5e3)})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1})):void AlertService.danger("Please select domain first")},$scope.publish=function(){return $scope.id?void $scope.confirm("confirmPublishModal.html",$scope.domain).then(function(){$scope._loading=!0,DomainsConfig.update({id:$scope.id,options:"publish"},$scope.obj.data).$promise.then(function(data){$scope.alertService.success("Domain configuration is published",5e3)})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1})}):void AlertService.danger("Please select domain first")},$scope.update=function(){return $scope.id?void $scope.confirm("confirmUpdateModal.html",$scope.domain).then(function(){$scope._loading=!0,DomainsConfig.update({id:$scope.id},$scope.obj.data).$promise.then(function(data){data.message&&AlertService.success(data.message,5e3)})["catch"](function(err){err.data&&err.data.message?AlertService.danger(err.data.message):AlertService.danger("Something wrong")})["finally"](function(){$scope._loading=!1})}):void AlertService.danger("Please select domain first")}}DomainsConfigureAdvancedController.$inject=["$scope","DomainsConfig","$timeout","AlertService","$stateParams"],angular.module("revapm.Portal.Domains").controller("DomainsConfigureAdvancedController",DomainsConfigureAdvancedController)}(),function(){"use strict";function DomainVersionsController($scope,DomainsConfig,$stateParams,AlertService,$timeout,$window,$filter){$scope._loading=!0,$scope.id=$stateParams.id,$scope.domain=DomainsConfig.get({id:$stateParams.id}),$scope.versions=[],$scope.currentVersion={},$scope.obj={data:"Configuration will appear here",options:{mode:"code",modes:["code","view"],error:function(err){$window.alert(err.toString())}}},$scope.format=function(item){return"Version "+item.last_published_domain_version+" Last updated at "+$filter("date")(new Date(item.updated_at),"MMM dd, yyyy H:mm:ss a")},$scope.onChangeVersion=function(){return $scope.currentVersion?($scope._loading=!0,void DomainsConfig.get({id:$stateParams.id,version:$scope.currentVersion}).$promise.then(function(data){$scope.obj.data=JSON.stringify(data,null,2)})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1})):void($scope.obj.data="")},DomainsConfig.versions({id:$stateParams.id}).$promise.then(function(data){angular.isArray(data)&&($scope.versions=data)})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1}),$timeout(function(){$scope.obj.options.mode="code"},10)}DomainVersionsController.$inject=["$scope","DomainsConfig","$stateParams","AlertService","$timeout","$window","$filter"],angular.module("revapm.Portal.Domains").controller("DomainVersionsController",DomainVersionsController)}(),function(){"use strict";angular.module("revapm.Portal.Companies",["ui.router","revapm.Portal.Shared","revapm.Portal.Config","revapm.Portal.Resources"])}(),function(){"use strict";function routesConfig($stateProvider){$stateProvider.state("index.accountSettings.companies",{url:"/companies",views:{main:{controller:"CompaniesCrudController",templateUrl:"parts/companies/list.html"}}}).state("index.accountSettings.companies.new",{url:"/new",views:{page:{templateUrl:"parts/companies/new.html"}}}).state("index.accountSettings.companies.edit",{url:"/edit/:id",views:{page:{templateUrl:"parts/companies/edit.html",controller:"CompaniesCrudController"}}})}routesConfig.$inject=["$stateProvider"],angular.module("revapm.Portal.Companies").config(routesConfig)}(),function(){"use strict";function CompaniesCrudController($scope,CRUDController,Companies,$injector,$stateParams,$config){$injector.invoke(CRUDController,this,{$scope:$scope,$stateParams:$stateParams}),$scope.setResource(Companies),$scope.setState("index.accountSettings.companies"),$scope.list(),$scope.getCompany=function(id){$scope.get(id)["catch"](function(err){$scope.alertService.danger("Could not load company details")})},$scope.getRelativeDate=function(datetime){return moment.utc(datetime).fromNow()},$scope.deleteCompany=function(model){$scope.confirm("confirmModal.html",model).then(function(){return $scope["delete"](model)})["catch"]($scope.alertService.danger)},$scope.createCompany=function(model){model&&$scope.create(model).then(function(){$scope.alertService.success("Company created",5e3),$scope.auth.reloadUser()})["catch"]($scope.alertService.danger)},$scope.updateCompany=function(model){$scope.update(model).then(function(){$scope.alertService.success("Company updated",5e3)})["catch"]($scope.alertService.danger)}}CompaniesCrudController.$inject=["$scope","CRUDController","Companies","$injector","$stateParams","$config"],angular.module("revapm.Portal.Companies").controller("CompaniesCrudController",CompaniesCrudController)}(),function(){"use strict";angular.module("revapm.Portal.Cache",["revapm.Portal.Shared","revapm.Portal.Config","revapm.Portal.Resources","ui.router","ng.jsoneditor"])}(),function(){"use strict";function CacheRoutingConfig($stateProvider){$stateProvider.state("index.webApp.cache",{url:"/cache/purge",views:{main:{controller:"CachePurgeController",templateUrl:"parts/cache/purge.html"}}}).state("index.webApp.advanced",{url:"/cache/advanced",views:{main:{controller:"CachePurgeController",templateUrl:"parts/cache/purge_advanced.html"}}})}CacheRoutingConfig.$inject=["$stateProvider"],angular.module("revapm.Portal.Cache").config(CacheRoutingConfig)}(),function(){"use strict";function CachePurgeController($scope,Cache,DomainsConfig,AlertService,$timeout){$scope._loading=!1,$scope.domain,$scope.json={purges:[{url:{is_wildcard:!0,expression:"/images/*.png"}}]},$scope.text="",$scope.options={mode:"code",modes:["code","view"],error:function(err){alert(err.toString())}},$scope.purge=function(){if($scope.domain){var json=angular.copy($scope.json);json.domainName=$scope.domain.domain_name,$scope._loading=!0,Cache.purge({},json).$promise.then(function(data){AlertService.success("The request has been successfully submitted",5e3)})["catch"](function(err){var message="Oops something went wrong";err&&err.data&&err.data.message&&(message=err.data.message),AlertService.danger(message,5e3)})["finally"](function(){$scope._loading=!1})}},$scope.purgeText=function(){if($scope.text&&$scope.domain){var json={domainName:$scope.domain.domain_name,purges:[]},list=$scope.text.split("\n");list.forEach(function(val){json.purges.push({url:{is_wildcard:!0,expression:val}})}),$scope._loading=!0,Cache.purge({},json).$promise.then(function(data){console.log(data),AlertService.success("The request has been successfully submitted",5e3)})["catch"](function(err){var message="Oops something went wrong";err&&err.data&&err.data.message&&(message=err.data.message),AlertService.danger(message,5e3)})["finally"](function(){$scope._loading=!1})}},$scope.jsonEditorEvent=function(instance){$scope.jsonEditorInstance=instance},$scope.$watch("jsonEditorInstance.getText()",function(val){if(val)try{var json=JSON.parse(val);$scope.jsonIsInvalid=!json||!Object.keys(json).length}catch(err){$scope.jsonIsInvalid=!0}})}CachePurgeController.$inject=["$scope","Cache","DomainsConfig","AlertService","$timeout"],angular.module("revapm.Portal.Cache").controller("CachePurgeController",CachePurgeController)}(),function(){"use strict";angular.module("revapm.Portal.Reports",["revapm.Portal.Shared","revapm.Portal.Config","revapm.Portal.Resources","ui.router","chart.js"])}(),function(){"use strict";function ReportsRoutes($stateProvider){$stateProvider.state("index.reports.proxy",{url:"/reports/proxy",views:{main:{controller:"ReportsProxyTrafficController",templateUrl:"parts/reports/proxy.html"}}}).state("index.reports.topreports",{url:"/reports/topreports",views:{main:{controller:"TopReportsTrafficController",templateUrl:"parts/reports/top-reports.html"}}}).state("index.reports.top",{url:"/reports/top",views:{main:{controller:"TopObjectsController",templateUrl:"parts/reports/top.html"}}}).state("index.reports.fbt",{url:"/reports/fbt",views:{main:{controller:"FBTReportsController",templateUrl:"parts/reports/fbt.html"}}}).state("index.reports.mob",{url:"/reports/mobile",views:{main:{controller:"MobileReportsController",templateUrl:"parts/reports/mobile.html"}}}).state("index.reports.heatmaps",{url:"/reports/heatmaps",views:{main:{controller:"TrafficHeatmapsController",templateUrl:"parts/reports/heatmaps.html"}}}).state("index.reports.lm_rtt_heatmaps",{url:"/reports/lm_rtt_heatmaps",views:{main:{controller:"LMRTTHeatmapsController",templateUrl:"parts/reports/lm-rtt-heatmaps.html"}}})}ReportsRoutes.$inject=["$stateProvider"],angular.module("revapm.Portal.Domains").config(ReportsRoutes)}(),function(){"use strict";function D3ChartHelper(){function createSvgElement(element){return element=element||"body",d3.select(element).append("svg")}return{createSvgElement:createSvgElement}}angular.module("revapm.Portal.Reports").factory("D3ChartHelper",D3ChartHelper)}(),function(){"use strict";function ChartColorService(){function getRandomRgbPart(){return Math.floor(256*Math.random())}function randomColors(amount){if(!amount)return[];for(var result=[];amount--;){var rgb=d3.rgb(getRandomRgbPart(),getRandomRgbPart(),getRandomRgbPart());result.push(rgb.toString())}return result}function randomScaleOrdinalRange(amount){return d3.scale.ordinal().range(randomColors(amount))}return{randomColors:randomColors,randomScaleOrdinalRange:randomScaleOrdinalRange}}angular.module("revapm.Portal.Reports").factory("ChartColorService",ChartColorService)}(),function(){"use strict";function PieChartHelper(ChartColorService,D3ChartHelper){function drawPieChart(element,data,config){function change(data){function midAngle(d){return d.startAngle+(d.endAngle-d.startAngle)/2}var slice=svg.select(".slices").selectAll("path.slice").data(pie(data),key);slice.enter().insert("path").style("fill",function(d){return color(d.data.label)}).attr("class","slice"),slice.transition().duration(1e3).attrTween("d",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);return this._current=interpolate(0),function(t){return arc(interpolate(t))}}),slice.exit().remove();var text=svg.select(".labels").selectAll("text").data(pie(data),key);text.enter().append("text").attr("dy",".35em").text(function(d){return d.data.label}),text.transition().duration(1e3).attrTween("transform",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);return this._current=interpolate(0),function(t){var d2=interpolate(t),pos=outerArc.centroid(d2);return pos[0]=radius*(midAngle(d2)<Math.PI?1:-1),"translate("+pos+")"}}).styleTween("text-anchor",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);return this._current=interpolate(0),function(t){var d2=interpolate(t);return midAngle(d2)<Math.PI?"start":"end"}}),text.exit().remove();var polyline=svg.select(".lines").selectAll("polyline").data(pie(data),key);polyline.enter().append("polyline"),polyline.transition().duration(1e3).attrTween("points",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);return this._current=interpolate(0),function(t){var d2=interpolate(t),pos=outerArc.centroid(d2);return pos[0]=.95*radius*(midAngle(d2)<Math.PI?1:-1),[arc.centroid(d2),outerArc.centroid(d2),pos]}}),polyline.exit().remove()}angular.isArray(element)&&(data=element,element="body"),data=data||[];var width=$(element).width()||400,height=$(element).height()||200,radius=Math.min(width,height)/2,svg=D3ChartHelper.createSvgElement(element).attr("width",width).attr("height",height).append("g"),pie=d3.layout.pie().sort(null).value(function(d){return d.value}),key=function(d){return d.data.label};svg.append("g").attr("class","slices"),svg.append("g").attr("class","labels"),svg.append("g").attr("class","lines");var arc=d3.svg.arc().outerRadius(.8*radius).innerRadius(.05*radius),outerArc=d3.svg.arc().innerRadius(.9*radius).outerRadius(.9*radius);svg.attr("transform","translate("+width/2+","+height/2+")");var color=d3.scale.category20();return change(data),change}return{drawPieChart:drawPieChart}}PieChartHelper.$inject=["ChartColorService","D3ChartHelper"],angular.module("revapm.Portal.Reports").factory("PieChartHelper",PieChartHelper)}(),function(){"use strict";function filterTimePeriods(){return{restrict:"AE",templateUrl:"parts/reports/filters/time-period.html",scope:{ngFilters:"=",onFilter:"&",flCountry:"=",flOs:"=",flDevice:"="},controller:["$scope",function($scope){$scope.delay="1",$scope.updateFilters=function(){$scope.ngFilters||($scope.ngFilters={}),$scope.ngFilters.from_timestamp=moment(Date.now()).subtract(parseInt($scope.delay),"days").valueOf(),$scope.ngFilters.to_timestamp=Date.now(),$scope.onFilter()}}]}}angular.module("revapm.Portal.Reports").directive("filterTimePeriods",filterTimePeriods)}(),function(){"use strict";function filterTopObjects(){return{restrict:"AE",templateUrl:"parts/reports/filters/top-objects-filter.html",scope:{ngFilters:"=",onFilter:"&",flCountry:"=",flOs:"=",flDevice:"="},controller:["$scope",function($scope){$scope.delay="24",$scope.ngFilters||($scope.ngFilters={}),$scope.ngFilters.count="20",$scope.updateFilters=function(){$scope.ngFilters.from_timestamp=moment(Date.now()).subtract(parseInt($scope.delay),"hours").valueOf(),$scope.ngFilters.to_timestamp=Date.now(),$scope.onFilter()}}]}}angular.module("revapm.Portal.Reports").directive("filterTopObjects",filterTopObjects)}(),function(){"use strict";function mobileTrafficFilters(){return{restrict:"AE",templateUrl:"parts/reports/filters/mobile-traffic-filters.html",scope:{ngFilters:"=",onFilter:"&",flOses:"=",flDevices:"=",flCountries:"=",flOperators:"=",flNetworks:"="},controller:["$scope",function($scope){$scope.span="1",$scope.update=function(){$scope.ngFilters||($scope.ngFilters={}),$scope.ngFilters.from_timestamp=moment().subtract($scope.span,"days").valueOf(),$scope.ngFilters.to_timestamp=Date.now(),$scope.onFilter()}}]}}angular.module("revapm.Portal.Reports").directive("mobileTrafficFilters",mobileTrafficFilters)}(),function(){"use strict";function mobileTopObjectsFilters(){return{restrict:"AE",templateUrl:"parts/reports/filters/mobile-top-objects-filters.html",scope:{ngFilters:"=",onFilter:"&",flOses:"=",flDevices:"=",flCountries:"=",flOperators:"=",flNetworks:"="},controller:["$scope",function($scope){$scope.span="24",$scope.count="10",$scope.update=function(){$scope.ngFilters||($scope.ngFilters={}),$scope.ngFilters.count=parseInt($scope.count),$scope.ngFilters.from_timestamp=moment().subtract($scope.span,"hours").valueOf(),$scope.ngFilters.to_timestamp=Date.now(),$scope.onFilter()}}]}}angular.module("revapm.Portal.Reports").directive("mobileTopObjectsFilters",mobileTopObjectsFilters)}(),function(){"use strict";function pieChartDirective(){function link($scope,element,attrs){var el=element[0],chartOpts={chart:{renderTo:el,type:"pie"},title:!1,tooltip:{formatter:function(){return"<b>"+this.point.name+": </b>"+Highcharts.numberFormat(this.point.percentage,0)+"% ("+Highcharts.numberFormat(this.y,0,".",",")+" requests)"}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}},innerSize:100,depth:45}},credits:{enabled:!1},series:[{data:[]}]},chart=new Highcharts.Chart(angular.merge(chartOpts,$scope.ngChartOptions||{}));$scope.$watch("ngData",function(value){value&&_.isArray(value)&&chart.series[0].setData(value)})}return{scope:{ngChartOptions:"=",ngData:"="},link:link}}angular.module("revapm.Portal.Reports").directive("pieChart",pieChartDirective)}(),function(){"use strict";function barChartDirective(){function link($scope,element,attrs){var el=element[0],chartOpts={chart:{renderTo:el,type:"bar"},title:!1,tooltip:{formatter:function(){return"<b>"+this.point.name+": </b>"+Highcharts.numberFormat(this.point.percentage,0)+"% ("+Highcharts.numberFormat(this.y,0,".",",")+" requests)"}},plotOptions:{bar:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}},innerSize:100,depth:45}},credits:{enabled:!1},series:[{data:[]}]},chart=new Highcharts.Chart(angular.merge(chartOpts,$scope.ngChartOptions||{}));$scope.$watch("ngData",function(value){value&&_.isArray(value)&&chart.series[0].setData(value)})}return{scope:{ngChartOptions:"=",ngData:"="},link:link}}angular.module("revapm.Portal.Reports").directive("barChart",barChartDirective)}(),function(){"use strict";function lineChartDirective(){function link($scope,element,attrs){var el=element[0],chartOptions={chart:{renderTo:el,type:"areaspline"},title:{text:""},xAxis:{categories:[],tickInterval:4,crosshair:{width:1,color:"#000000"}},yAxis:{title:{text:"RPS"},plotLines:[{value:0,width:1,color:"#808080"}]},legend:{borderWidth:0},plotOptions:{areaspline:{marker:{enabled:!1}}},credits:{enabled:!1},series:[]},chart=new Highcharts.Chart(angular.merge(chartOptions,$scope.ngChartOptions||{}));$scope.reload=function(){chart.redraw()},$scope.clearChart=function(){chart.series.forEach(function(series){series.remove()}),$scope.reload()},$scope.$watch("ngData",function(value){if(value&&_.isObject(value)){if($scope.clearChart(),_.isArray(value.labels)){if(0==value.labels.length)return;chart.xAxis[0].setCategories(value.labels)}if(_.isArray(value.series)){if(0==value.series.length)return;value.series.forEach(function(val){chart.addSeries(val)})}$scope.reload()}}),$scope.$watch("xAxis",function(value){return value&&_.isArray(value)?0==value.length?void $scope.clearChart():void chart.xAxis[0].update(value):void 0})}return{scope:{ngChartOptions:"=",ngData:"="},link:link}}angular.module("revapm.Portal.Reports").directive("lineChart",lineChartDirective)}(),function(){"use strict";function d3PieChart(PieChartHelper){return{restrict:"AE",template:"<div></div>",scope:{ngData:"="},link:function(scope,element,attrs){scope.ngData||(scope.ngData=[]);var redraw=PieChartHelper.drawPieChart(element[0],[]);scope.$watch("ngData",function(){return scope.ngData&&0!=scope.ngData.length?void redraw(scope.ngData):void redraw([])})}}}d3PieChart.$inject=["PieChartHelper"],angular.module("revapm.Portal.Reports").directive("d3PieChart",d3PieChart)}(),function(){"use strict";function requestsChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/requests.html",scope:{ngDomain:"=",flCountry:"=",flOs:"=",flDevice:"="},controller:["$scope","Stats","Util",function($scope,Stats,Util){$scope.delay=1800,$scope._loading=!1,$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now()},$scope.chartOptions={yAxis:{title:{text:"Bandwidth"},labels:{formatter:function(){return Util.convertTraffic(this.value)}}},tooltip:{formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+Util.convertTraffic(this.y)}}},$scope.traffic={labels:[],series:[{name:"Incoming bandwidth",data:[]},{name:"Outgoing bandwidth",data:[]}]},$scope.reloadTrafficStats=function(){$scope.ngDomain&&$scope.ngDomain.id&&($scope._loading=!0,
$scope.traffic={labels:[],series:[{name:"Incoming bandwidth",data:[]},{name:"Outgoing bandwidth",data:[]}]},Stats.traffic(angular.merge({domainId:$scope.ngDomain.id},$scope.filters)).$promise.then(function(data){if(data.data&&data.data.length>0){var series=[{name:"Incoming bandwidth",data:[]},{name:"Outgoing bandwidth",data:[]}];$scope.delay=data.metadata.interval_sec||1800;var labels=[],offset=1e3*$scope.delay;angular.forEach(data.data,function(data){labels.push(moment(data.time+offset).format("MMM Do YY h:mm")),series[0].data.push(Util.toBps(data.received_bytes,$scope.delay,!0)),series[1].data.push(Util.toBps(data.sent_bytes,$scope.delay,!0))}),$scope.traffic={labels:labels,series:series}}})["finally"](function(){$scope._loading=!1}))},$scope.$watch("ngDomain",function(){$scope.ngDomain&&$scope.reloadTrafficStats()})}]}}angular.module("revapm.Portal.Reports").directive("requestsChart",requestsChartDirective)}(),function(){"use strict";function histCacheChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/hits-cache.html",scope:{ngDomain:"=",flCountry:"=",flOs:"=",flDevice:"="},controller:["$scope","Stats","$q","Util",function($scope,Stats,$q,Util){$scope._loading=!1,$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now()},$scope.delay=1800,$scope.traffic={labels:[],series:[{name:"Cache Hit",data:[]},{name:"Cache Miss",data:[]}]},$scope.loadHit=function(){return Stats.traffic(angular.merge({domainId:$scope.ngDomain.id},$scope.filters,{cache_code:"HIT"})).$promise},$scope.loadMiss=function(){return Stats.traffic(angular.merge({domainId:$scope.ngDomain.id},$scope.filters,{cache_code:"MISS"})).$promise},$scope.reload=function(){$scope.ngDomain&&$scope.ngDomain.id&&($scope._loading=!0,$scope.traffic={labels:[],series:[{name:"Cache Hit",data:[]},{name:"Cache Miss",data:[]}]},$q.all([$scope.loadHit(),$scope.loadMiss()]).then(function(data){$scope.delay=data[0].metadata.interval_sec||1800;var offset=1e3*$scope.delay,labels=[],series=[{name:"Cache Hit",data:[]},{name:"Cache Miss",data:[]}];data[0].data&&data[0].data.length>0&&angular.forEach(data[0].data,function(data){labels.push(moment(data.time+offset).format("MMM Do YY h:mm")),series[0].data.push(Util.toRPS(data.requests,$scope.delay,!0))}),data[1].data&&data[1].data.length>0&&angular.forEach(data[1].data,function(data){series[1].data.push(Util.toRPS(data.requests,$scope.delay,!0))}),$scope.traffic={labels:labels,series:series}})["finally"](function(){$scope._loading=!1}))},$scope.$watch("ngDomain",function(){$scope.ngDomain&&$scope.reload()})}]}}angular.module("revapm.Portal.Reports").directive("hitsCacheChart",histCacheChartDirective)}(),function(){"use strict";function httpStatusCodeChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/http-status-code.html",scope:{ngDomain:"=",statusCodes:"=",flCountry:"=",flOs:"=",flDevice:"="},controller:["$scope","Stats","$q","Util",function($scope,Stats,$q,Util){$scope._loading=!1,$scope.delay=1800,$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now()},$scope.traffic={labels:[],series:[]},$scope.reload=function(){if($scope.ngDomain&&$scope.ngDomain.id&&$scope.statusCodes&&$scope.statusCodes.length){$scope.traffic={labels:[],series:[]};var promises={},series=[],labels=[];$scope.statusCodes.forEach(function(code){code&&(promises[code]=Stats.traffic(angular.merge({domainId:$scope.ngDomain.id},$scope.filters,{status_code:code})).$promise)}),$scope._loading=!0;var timeSet=!1;$q.all(promises).then(function(data){labels=[],$scope.delay=1800,angular.forEach(data,function(val,idx){data[idx].metadata.interval_sec&&($scope.delay=data[idx].metadata.interval_sec);var offset=1e3*$scope.delay,results=[];data[idx].data&&data[idx].data.length>0&&(angular.forEach(data[idx].data,function(res){timeSet||labels.push(moment(res.time+offset).format("MMM Do YY h:mm")),results.push(Util.toRPS(res.requests,$scope.delay,!0))}),timeSet=!0),series.push({name:idx,data:results})}),$scope.traffic={labels:labels,series:series}})["finally"](function(){$scope._loading=!1})}},$scope.$watch("ngDomain",function(){$scope.reload()}),$scope.$watch("statusCodes",function(){$scope.reload()})}]}}angular.module("revapm.Portal.Reports").directive("httpStatusCodeChart",httpStatusCodeChartDirective)}(),function(){"use strict";function httpHttpsChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/http-https.html",scope:{ngDomain:"=",flCountry:"=",flOs:"=",flDevice:"="},controller:["$scope","Stats","$q","Util",function($scope,Stats,$q,Util){$scope._loading=!1,$scope.delay=1800,$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now()},$scope.traffic={labels:[],series:[{name:"HTTP",data:[]},{name:"HTTPS",data:[]}]},$scope.loadHttp=function(){return Stats.traffic(angular.merge({domainId:$scope.ngDomain.id},$scope.filters,{protocol:"HTTP"})).$promise},$scope.loadHttps=function(){return Stats.traffic(angular.merge({domainId:$scope.ngDomain.id},$scope.filters,{protocol:"HTTPS"})).$promise},$scope.reload=function(){$scope.ngDomain&&$scope.ngDomain.id&&($scope._loading=!0,$scope.traffic={labels:[],series:[{name:"HTTP",data:[]},{name:"HTTPS",data:[]}]},$q.all([$scope.loadHttp(),$scope.loadHttps()]).then(function(data){$scope.delay=data[0].metadata.interval_sec||1800;var offset=1e3*$scope.delay,labels=[],series=[{name:"HTTP",data:[]},{name:"HTTPS",data:[]}];data[0].data&&data[0].data.length>0&&angular.forEach(data[0].data,function(data){labels.push(moment(data.time+offset).format("MMM Do YY h:mm")),series[0].data.push(Util.toRPS(data.requests,$scope.delay,!0))}),data[1].data&&data[1].data.length>0&&angular.forEach(data[1].data,function(data){series[1].data.push(Util.toRPS(data.requests,$scope.delay,!0))}),$scope.traffic={labels:labels,series:series}})["finally"](function(){$scope._loading=!1}))},$scope.$watch("ngDomain",function(){$scope.ngDomain&&$scope.reload()})}]}}angular.module("revapm.Portal.Reports").directive("httpHttpsChart",httpHttpsChartDirective)}(),function(){"use strict";function requestStatusChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/request-status.html",scope:{ngDomain:"=",flCountry:"=",flOs:"=",flDevice:"="},controller:["$scope","Stats","$q","Util",function($scope,Stats,$q,Util){$scope._loading=!1,$scope.delay=1800,$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now()},$scope.traffic={labels:[],series:[{name:"Successful",data:[]},{name:"Failed",data:[]}]},$scope.loadOk=function(){return Stats.traffic(angular.merge({domainId:$scope.ngDomain.id},$scope.filters,{request_status:"OK"})).$promise},$scope.loadError=function(){return Stats.traffic(angular.merge({domainId:$scope.ngDomain.id},$scope.filters,{request_status:"ERROR"})).$promise},$scope.reload=function(){$scope.ngDomain&&$scope.ngDomain.id&&($scope._loading=!0,$scope.traffic={labels:[],series:[{name:"Successful",data:[]},{name:"Failed",data:[]}]},$q.all([$scope.loadOk(),$scope.loadError()]).then(function(data){$scope.delay=data[0].metadata.interval_sec||1800;var offset=1e3*$scope.delay,labels=[],series=[{name:"Successful",data:[]},{name:"Failed",data:[]}];data[0].data&&data[0].data.length>0&&angular.forEach(data[0].data,function(data){labels.push(moment(data.time+offset).format("MMM Do YY h:mm")),series[0].data.push(Util.toRPS(data.requests,$scope.delay,!0))}),data[1].data&&data[1].data.length>0&&angular.forEach(data[1].data,function(data){series[1].data.push(Util.toRPS(data.requests,$scope.delay,!0))}),$scope.traffic={labels:labels,series:series}})["finally"](function(){$scope._loading=!1}))},$scope.$watch("ngDomain",function(){$scope.ngDomain&&$scope.reload()})}]}}angular.module("revapm.Portal.Reports").directive("requestStatusChart",requestStatusChartDirective)}(),function(){"use strict";function proxyTrafficChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/proxy-traffic.html",scope:{ngDomain:"=",flCountry:"=",flOs:"=",flDevice:"="},controller:["$scope","Stats","Util",function($scope,Stats,Util){$scope.delay=1800,$scope._loading=!1,$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now()},$scope.traffic={labels:[],series:[{name:"Total",data:[]}]},$scope.reloadTrafficStats=function(){$scope.ngDomain&&$scope.ngDomain.id&&($scope._loading=!0,$scope.traffic={labels:[],series:[{name:"Total",data:[]}]},Stats.traffic(angular.merge({domainId:$scope.ngDomain.id},$scope.filters)).$promise.then(function(data){if(data.data&&data.data.length>0){$scope.delay=data.metadata.interval_sec||1800;var offset=1e3*$scope.delay,series=[{name:"Total",data:[]}],labels=[];angular.forEach(data.data,function(data){labels.push(moment(data.time+offset).format("MMM Do YY h:mm")),series[0].data.push(Util.toRPS(data.requests,$scope.delay,!0))}),$scope.traffic={labels:labels,series:series}}})["finally"](function(){$scope._loading=!1}))},$scope.$watch("ngDomain",function(){$scope.ngDomain&&$scope.reloadTrafficStats()})}]}}angular.module("revapm.Portal.Reports").directive("proxyTrafficChart",proxyTrafficChartDirective)}(),function(){"use strict";function fbtAverageChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/fbt-average.html",scope:{flCountry:"=",flOs:"=",flDevice:"=",ngDomain:"="},controller:["$scope","Stats","Util",function($scope,Stats,Util){$scope.delay="1",$scope.os="",$scope.country="",$scope.device="",$scope._loading=!1,$scope.chartOptions={yAxis:{title:{text:"First Byte Time, ms"},labels:{formatter:function(){return Util.formatNumber(Math.round(this.value/1e3))}}},tooltip:{formatter:function(){return"<strong>"+this.x+"</strong><br/>"+this.series.name+": <strong>"+Util.formatNumber(this.y/1e3,2)+"</strong> ms"}}},$scope.reloadTrafficStats=function(){if($scope.ngDomain&&$scope.ngDomain.id){$scope._loading=!0;var opts={domainId:$scope.ngDomain.id,from_timestamp:moment().subtract($scope.delay,"days").valueOf(),to_timestamp:Date.now()};""!==$scope.country&&(opts.country=$scope.country),""!==$scope.device&&(opts.device=$scope.device),""!==$scope.os&&(opts.os=$scope.os),Stats.fbt_average(opts).$promise.then(function(data){var series=[{name:"Average FBT",data:[]}];if(data.data&&data.data.length>0){var labels=[],offset=1e3*(data.metadata.interval_sec||1800);angular.forEach(data.data,function(data){labels.push(moment(data.time+offset).format("MMM Do YY h:mm")),series[0].data.push(data.avg_fbt)}),$scope.traffic={labels:labels,series:series}}else $scope.traffic={labels:[],series:series}})["finally"](function(){$scope._loading=!1})}},$scope.$watch("ngDomain",function(){$scope.ngDomain&&$scope.reloadTrafficStats()})}]}}angular.module("revapm.Portal.Reports").directive("fbtAverageChart",fbtAverageChartDirective)}(),function(){"use strict";function fbtDistributionChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/fbt-distribution.html",scope:{flCountry:"=",flOs:"=",flDevice:"=",ngDomain:"="},controller:["$scope","Stats","Util",function($scope,Stats,Util){$scope.delay="24",$scope.os="",$scope.country="",$scope.device="",$scope._ims=300,$scope._loading=!1,$scope.chartOptions={chart:{type:"column"},yAxis:{title:{text:"Requests"},labels:{formatter:function(){return Util.formatNumber(this.value)}}},tooltip:{formatter:function(){return"<strong>"+this.x+"÷"+(this.x+$scope._ims)+"</strong> ms<br/>Count: <strong>"+Util.formatNumber(this.y)+"</strong>"}},plotOptions:{column:{minPointLength:2,dataLabels:{enabled:!1}}}},$scope.reloadTrafficStats=function(){if($scope.ngDomain&&$scope.ngDomain.id){var opts={domainId:$scope.ngDomain.id,from_timestamp:moment().subtract($scope.delay,"hours").valueOf(),to_timestamp:Date.now(),interval_ms:50,limit_ms:1e4};""!==$scope.country&&(opts.country=$scope.country),""!==$scope.device&&(opts.device=$scope.device),""!==$scope.os&&(opts.os=$scope.os),$scope._loading=!0,Stats.fbt_distribution(opts).$promise.then(function(data){var series=[{name:"FBT Distribution",data:[]}];if(data.data&&data.data.length>0){var labels=[];$scope._ims=data.metadata.interval_ms||300,angular.forEach(data.data,function(data){labels.push(data.key/1e3),series[0].data.push(data.requests)}),$scope.traffic={labels:labels,series:series}}else $scope.traffic={labels:[],series:series}})["finally"](function(){$scope._loading=!1})}},$scope.$watch("ngDomain",function(){$scope.ngDomain&&$scope.reloadTrafficStats()})}]}}angular.module("revapm.Portal.Reports").directive("fbtDistributionChart",fbtDistributionChartDirective)}(),function(){"use strict";function fbtHeatmapChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/fbt-heatmap.html",scope:{flCountry:"=",ngDomain:"="},controller:["$scope","Stats","HeatmapsDrawer","Util",function($scope,Stats,HeatmapsDrawer,Util){$scope.delay="24",$scope._loading=!1,$scope.fbtCountryData={},$scope.reloadFBTStats=function(){if($scope.ngDomain&&$scope.ngDomain.id){HeatmapsDrawer.clearMap("#canvas-svg"),$scope._loading=!0;var opts={domainId:$scope.ngDomain.id,from_timestamp:moment().subtract($scope.delay,"hours").valueOf(),to_timestamp:Date.now()};Stats.fbt_heatmap(opts).$promise.then(function(data){var cdata={};data.data&&data.data.length>0&&angular.forEach(data.data,function(item){var name=$scope.flCountry[item.key.toUpperCase()]||item.key;cdata[name]={value:item.fbt_avg_ms,tooltip:"Avg: <strong>"+Util.formatNumber(item.fbt_avg_ms)+"</strong> Min: <strong>"+Util.formatNumber(item.fbt_min_ms)+"</strong> Max: <strong>"+Util.formatNumber(item.fbt_max_ms)+"</strong> ms"}}),$scope.fbtCountryData=cdata,HeatmapsDrawer.drawMap("#canvas-svg","#tooltip-container",$scope.fbtCountryData)})["finally"](function(){$scope._loading=!1})}},$scope.$watch("ngDomain",function(){$scope.ngDomain&&$scope.reloadFBTStats()}),HeatmapsDrawer.drawMap("#canvas-svg","#tooltip-container",{})}]}}angular.module("revapm.Portal.Reports").directive("fbtHeatmapChart",fbtHeatmapChartDirective)}(),function(){"use strict";function topRequestsDirective(){return{restrict:"AE",templateUrl:"parts/reports/top/top-requests.html",scope:{ngDomain:"=",flCountry:"=",flOs:"=",flDevice:"="},controller:["$scope","Stats",function($scope,Stats){$scope._loading=!1,$scope.filters={from_timestamp:moment().subtract(1,"hours").valueOf(),to_timestamp:Date.now()},$scope.items=[],$scope.data={labels:[],data:[[]]},$scope.loadDetails=function(){if($scope.ngDomain&&$scope.ngDomain.id){$scope._loading=!0,$scope.data={labels:[],data:[[]]};var params=angular.merge({domainId:$scope.ngDomain.id},$scope.filters);Stats.topObjects(params).$promise.then(function(res){$scope.items=res.data,res.data.map(function(val){$scope.data.labels.push(val.path),$scope.data.data[0].push(val.count)})})["finally"](function(){$scope._loading=!1})}},$scope.$watch("ngDomain",function(){$scope.loadDetails()})}]}}angular.module("revapm.Portal.Reports").directive("topRequests",topRequestsDirective)}(),function(){"use strict";function topCacheMissDirective(){return{restrict:"AE",templateUrl:"parts/reports/top/top-cache-miss.html",scope:{ngDomain:"=",flCountry:"=",flOs:"=",flDevice:"="},controller:["$scope","Stats",function($scope,Stats){$scope._loading=!1,$scope.filters={from_timestamp:moment().subtract(1,"hours").valueOf(),to_timestamp:Date.now(),cache_code:"MISS"},$scope.items=[],$scope.data={labels:[],data:[[]]},$scope.loadDetails=function(){if($scope.ngDomain&&$scope.ngDomain.id){$scope._loading=!0,$scope.data={labels:[],data:[[]]};var params=angular.merge({domainId:$scope.ngDomain.id},$scope.filters);Stats.topObjects(params).$promise.then(function(res){$scope.items=res.data,res.data.map(function(val){$scope.data.labels.push(val.path),$scope.data.data[0].push(val.count)})})["finally"](function(){$scope._loading=!1})}},$scope.$watch("ngDomain",function(){$scope.loadDetails()})}]}}angular.module("revapm.Portal.Reports").directive("topCacheMiss",topCacheMissDirective)}(),function(){"use strict";function top404Directive(){return{restrict:"AE",templateUrl:"parts/reports/top/top-404.html",scope:{ngDomain:"=",flCountry:"=",flOs:"=",flDevice:"="},controller:["$scope","Stats",function($scope,Stats){$scope._loading=!1,$scope.filters={from_timestamp:moment().subtract(1,"hours").valueOf(),to_timestamp:Date.now(),status_code:404},$scope.items=[],$scope.data={labels:[],data:[[]]},$scope.loadDetails=function(){if($scope.ngDomain&&$scope.ngDomain.id){$scope._loading=!0,$scope.data={labels:[],data:[[]]};var params=angular.merge({domainId:$scope.ngDomain.id},$scope.filters);Stats.topObjects(params).$promise.then(function(res){$scope.items=res.data,res.data.map(function(val){$scope.data.labels.push(val.path),$scope.data.data[0].push(val.count)})})["finally"](function(){$scope._loading=!1})}},$scope.$watch("ngDomain",function(){$scope.loadDetails()})}]}}angular.module("revapm.Portal.Reports").directive("top404",top404Directive)}(),function(){"use strict";function topRefererDirective(){return{restrict:"AE",templateUrl:"parts/reports/top/top-referer.html",scope:{ngDomain:"=",flCountry:"=",flOs:"=",flDevice:"="},controller:["$scope","Stats",function($scope,Stats){$scope._loading=!1,$scope.filters={from_timestamp:moment().subtract(1,"hours").valueOf(),to_timestamp:Date.now()},$scope.items=[],$scope.data={labels:[],data:[[]]},$scope.loadDetails=function(){if($scope.ngDomain&&$scope.ngDomain.id){$scope._loading=!0,$scope.data={labels:[],data:[[]]};var params=angular.merge({domainId:$scope.ngDomain.id},$scope.filters);Stats.referer(params).$promise.then(function(res){$scope.items=res.data,res.data.map(function(val){$scope.data.labels.push(val.key),$scope.data.data[0].push(val.count)})})["finally"](function(){$scope._loading=!1})}},$scope.$watch("ngDomain",function(){$scope.loadDetails()})}]}}angular.module("revapm.Portal.Reports").directive("topReferer",topRefererDirective)}(),function(){"use strict";function top5xxDirective(){return{restrict:"AE",templateUrl:"parts/reports/top/top-5xx.html",scope:{ngDomain:"=",flCountry:"=",flOs:"=",flDevice:"="},controller:["$scope","Stats",function($scope,Stats){$scope._loading=!1,$scope.filters={from_timestamp:moment().subtract(1,"hours").valueOf(),to_timestamp:Date.now()},$scope.loadDetails=function(){if($scope.ngDomain&&$scope.ngDomain.id){$scope._loading=!0;var params=angular.merge({domainId:$scope.ngDomain.id},$scope.filters),http_codes={500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"};$scope.codes=[],Stats.top5xx(params).$promise.then(function(res){for(var code in res.data)$scope.codes.push({name:code+(http_codes[code]?" ("+http_codes[code]+")":""),count:res.data[code].count,requests:res.data[code].requests})})["finally"](function(){$scope._loading=!1})}},$scope.$watch("ngDomain",function(){$scope.loadDetails()})}]}}angular.module("revapm.Portal.Reports").directive("top5xx",top5xxDirective)}(),function(){"use strict";function topFailedDirective(){return{restrict:"AE",templateUrl:"parts/reports/top/top-failed.html",scope:{ngDomain:"=",flCountry:"=",flOs:"=",flDevice:"="},controller:["$scope","Stats",function($scope,Stats){$scope._loading=!1,$scope.filters={from_timestamp:moment().subtract(1,"hours").valueOf(),to_timestamp:Date.now(),request_status:"ERROR"},$scope.items=[],$scope.data={labels:[],data:[[]]},$scope.loadDetails=function(){if($scope.ngDomain&&$scope.ngDomain.id){$scope._loading=!0,$scope.data={labels:[],data:[[]]};var params=angular.merge({domainId:$scope.ngDomain.id},$scope.filters);Stats.topObjects(params).$promise.then(function(res){$scope.items=res.data,res.data.map(function(val){$scope.data.labels.push(val.path),$scope.data.data[0].push(val.count)})})["finally"](function(){$scope._loading=!1})}},$scope.$watch("ngDomain",function(){$scope.loadDetails()})}]}}angular.module("revapm.Portal.Reports").directive("topFailed",topFailedDirective)}(),function(){"use strict";angular.module("revapm.Portal.Reports").constant("HeatmapsConfig",{COLOR_COUNTS:20,COLORS:{FIRST:"#99ccff",LAST:"#0050A1",ZERO:"#ccc"}})}(),function(){"use strict";function HeatmapsDrawer(HeatmapsConfig){function Interpolate(start,end,steps,count){var s=start,e=end,final=s+(e-s)/steps*count;return Math.floor(final)}function Color(_r,_g,_b){var r,g,b,setColors=function(_r,_g,_b){r=_r,g=_g,b=_b};setColors(_r,_g,_b),this.getColors=function(){var colors={r:r,g:g,b:b};return colors}}function hexToRgb(hex){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null}function valueFormat(d,force){return d>1e9||"G"===force?Math.round(d/1e7)/100+"G":d>1e6||"M"===force?Math.round(d/1e5)/10+"M":d>1e3||"K"===force?Math.round(d/100)/10+"K":d}function log10(val){return Math.log(val)}function drawMap(canvasSvgId,tooltipId,data){var width=$(canvasSvgId).width(),height=width/1.5,COLOR_COUNTS=this.conf.COLOR_COUNTS,COLOR_FIRST=this.conf.COLORS.FIRST,COLOR_LAST=this.conf.COLORS.LAST,COLOR_ZERO=this.conf.COLORS.ZERO,rgb=hexToRgb(COLOR_FIRST),COLOR_START=new Color(rgb.r,rgb.g,rgb.b);rgb=hexToRgb(COLOR_LAST);for(var COLOR_END=new Color(rgb.r,rgb.g,rgb.b),startColors=COLOR_START.getColors(),endColors=COLOR_END.getColors(),colors=[],i=0;COLOR_COUNTS>i;i++){var r=Interpolate(startColors.r,endColors.r,COLOR_COUNTS,i),g=Interpolate(startColors.g,endColors.g,COLOR_COUNTS,i),b=Interpolate(startColors.b,endColors.b,COLOR_COUNTS,i);colors.push(new Color(r,g,b))}var projection=d3.geo.mercator().scale((width+1)/2/Math.PI).translate([width/2,height/1.4]).precision(.1),path=d3.geo.path().projection(projection),graticule=d3.geo.graticule();clearMap(canvasSvgId);var svg=d3.select(canvasSvgId).append("svg").attr("width","100%").attr("height",height);svg.append("path").datum(graticule).attr("class","graticule").attr("d",path);var valueHash=_.mapValues(data,function(item){return item.value}),quantize=d3.scale.quantize().domain([0,1]).range(d3.range(COLOR_COUNTS).map(function(i){return i})),values=d3.values(valueHash);quantize.domain([d3.min(values,function(d){return+d}),d3.max(values,function(d){return+d})]),d3.json("js/heatmaps/world-topo-min.json",function(error,world){var countries=topojson.feature(world,world.objects.countries).features;svg.append("path").datum(graticule).attr("class","choropleth").attr("d",path);var g=svg.append("g");g.append("path").datum({type:"LineString",coordinates:[[-180,0],[-90,0],[0,0],[90,0],[180,0]]}).attr("class","equator").attr("d",path);var country=g.selectAll(".country").data(countries);country.enter().insert("path").attr("class","country").attr("d",path).attr("id",function(d,i){return d.id}).attr("title",function(d){return d.properties.name}).style("fill",function(d){if(valueHash[d.properties.name]){var c=quantize(valueHash[d.properties.name]);if(void 0!==c){var color=colors[c].getColors();return"rgb("+color.r+","+color.g+","+color.b+")"}return COLOR_LAST}return COLOR_ZERO}).on("mousemove",function(d){var html="";html+='<div class="tooltip_kv">',html+='<span class="tooltip_key">',html+=d.properties.name,html+="</span>",html+='<span class="tooltip_value">',html+=data[d.properties.name]&&data[d.properties.name].tooltip?data[d.properties.name].tooltip:"--",html+="</span>",html+="</div>",$(tooltipId).html(html),$(this).attr("fill-opacity","0.8"),$(tooltipId).show();var map_width=(d3.mouse(this),$(".choropleth")[0].getBoundingClientRect().width);if(d3.event.pageX<map_width/2)d3.select(tooltipId).style("top",d3.event.layerY+15+"px").style("left",d3.event.layerX+15+"px");else{var tooltip_width=$(tooltipId).width();d3.select(tooltipId).style("top",d3.event.layerY+15+"px").style("left",d3.event.layerX-tooltip_width-30+"px")}}).on("mouseout",function(){$(this).attr("fill-opacity","1.0"),$(tooltipId).hide()}),g.append("path").datum(topojson.mesh(world,world.objects.countries,function(a,b){return a!==b})).attr("class","boundary").attr("d",path)})}function clearMap(canvasSvgId){canvasSvgId=canvasSvgId?canvasSvgId+" svg":"svg",d3.select(canvasSvgId)&&d3.select(canvasSvgId).remove()}return{conf:HeatmapsConfig,clearMap:clearMap,drawMap:drawMap,Interpolate:Interpolate,Color:Color,hexToRgb:hexToRgb,valueFormat:valueFormat,log10:log10}}HeatmapsDrawer.$inject=["HeatmapsConfig"],angular.module("revapm.Portal.Domains").factory("HeatmapsDrawer",HeatmapsDrawer)}(),function(){"use strict";function ReportsProxyTrafficController($scope,$rootScope,User,AlertService,Stats,Countries){$scope.userService=User,$scope._loading=!0,$scope.domain=$rootScope.domain,$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now()},$scope.pieOpts={scaleOverride:!0},$scope.os={labels:[],data:[]},$scope.device={labels:[],data:[]},$scope.country={labels:[],data:[]},$scope.statusCode={labels:[],data:[]},$scope.countries=Countries.query(),$scope.reloadOS=function(domainId){$scope.os={labels:[],data:[]},Stats.os({domainId:domainId}).$promise.then(function(data){data.data&&data.data.length>0&&angular.forEach(data.data,function(os){$scope.os.labels.push(os.key),$scope.os.data.push(os.count)})})},$scope.reloadDevice=function(domainId){$scope.device={labels:[],data:[]},Stats.device({domainId:domainId}).$promise.then(function(data){data.data&&data.data.length>0&&angular.forEach(data.data,function(os){$scope.device.labels.push(os.key),$scope.device.data.push(os.count)})})},$scope.reloadProtocol=function(domainId){$scope.protocol={labels:[],data:[]},Stats.protocol({domainId:domainId}).$promise.then(function(data){data.data&&data.data.length>0&&angular.forEach(data.data,function(os){var protocol="Unknows";80==os.key&&(protocol="HTTP"),443==os.key&&(protocol="HTTPS"),$scope.protocol.labels.push(protocol),$scope.protocol.data.push(os.count)})})},$scope.reloadHttpMethod=function(domainId){$scope.httpMethod={labels:[],data:[]},Stats.httpMethod({domainId:domainId}).$promise.then(function(data){data.data&&data.data.length>0&&angular.forEach(data.data,function(os){$scope.httpMethod.labels.push(os.key),$scope.httpMethod.data.push(os.count)})})},$scope.reloadHttpProtocol=function(domainId){$scope.httpProtocol={labels:[],data:[]},Stats.httpProtocol({domainId:domainId}).$promise.then(function(data){data.data&&data.data.length>0&&angular.forEach(data.data,function(os){$scope.httpProtocol.labels.push(os.key),$scope.httpProtocol.data.push(os.count)})})},$scope.reloadStatusCode=function(domainId){$scope.statusCode={labels:[],data:[]},Stats.statusCode({domainId:domainId}).$promise.then(function(data){data.data&&data.data.length>0&&($scope.statusCode={labels:[],data:[]},angular.forEach(data.data,function(os){$scope.statusCode.labels.push(os.key),$scope.statusCode.data.push(os.count)}))})},$scope.reloadContentType=function(domainId){$scope.contentType={labels:[],data:[]},Stats.contentType({domainId:domainId}).$promise.then(function(data){data.data&&data.data.length>0&&angular.forEach(data.data,function(os){$scope.contentType.labels.push(os.key),$scope.contentType.data.push(os.count)})})},$scope.reloadCacheStatus=function(domainId){$scope.cacheStatus={labels:[],data:[]},Stats.cacheStatus({domainId:domainId}).$promise.then(function(data){data.data&&data.data.length>0&&angular.forEach(data.data,function(os){$scope.cacheStatus.labels.push(os.key),$scope.cacheStatus.data.push(os.count)})})},$scope.reloadCountry=function(domainId){$scope.country={labels:[],data:[]},Stats.country({domainId:domainId}).$promise.then(function(data){data.data&&data.data.length>0&&angular.forEach(data.data,function(os){$scope.country.labels.push(os.key),$scope.country.data.push(os.count)})})},$scope.reload=function(){$scope.reloadOS($scope.domain.id),$scope.reloadDevice($scope.domain.id),$scope.reloadCountry($scope.domain.id),$scope.reloadStatusCode($scope.domain.id)},$scope.onDomainSelected=function(){$scope.domain&&$scope.domain.id&&$scope.reload()}}ReportsProxyTrafficController.$inject=["$scope","$rootScope","User","AlertService","Stats","Countries"],angular.module("revapm.Portal.Reports").controller("ReportsProxyTrafficController",ReportsProxyTrafficController)}(),function(){"use strict";function TopReportsTrafficController($scope,User,AlertService,Stats,Countries){$scope.userService=User,$scope._loading=!0,$scope.domain=null,$scope.domains=[],$scope.pieOpts={scaleOverride:!0},$scope.os=[],$scope.device=[],$scope.country=[],$scope.statusCode=[],$scope.requestStatus=[],$scope.countries=Countries.query(),$scope.delay="24",$scope.country_filter="",$scope.reloadOS=function(filters){$scope.os=[],Stats.os(filters).$promise.then(function(data){if(data.data&&data.data.length>0){var newData=[];angular.forEach(data.data,function(val){newData.push({name:val.key,y:val.count})}),$scope.os=newData}})},$scope.reloadDevice=function(filters){$scope.device=[],Stats.device(filters).$promise.then(function(data){if(data.data&&data.data.length>0){var newData=[];angular.forEach(data.data,function(val){newData.push({name:val.key,y:val.count})}),$scope.device=newData}})},$scope.reloadProtocol=function(filters){$scope.protocol=[],Stats.protocol(filters).$promise.then(function(data){if(data.data&&data.data.length>0){var newData=[];angular.forEach(data.data,function(val){var protocol="Unknows";80==val.key&&(protocol="HTTP"),443==val.key&&(protocol="HTTPS"),newData.push({name:protocol,y:val.count})}),$scope.protocol=newData}})},$scope.reloadHttpMethod=function(filters){$scope.httpMethod=[],Stats.httpMethod(filters).$promise.then(function(data){if(data.data&&data.data.length>0){var newData=[];angular.forEach(data.data,function(val){newData.push({name:val.key,y:val.count})}),$scope.httpMethod=newData}})},$scope.reloadHttpProtocol=function(filters){$scope.httpProtocol=[],Stats.httpProtocol(filters).$promise.then(function(data){if(data.data&&data.data.length>0){var newData=[];angular.forEach(data.data,function(val){newData.push({name:val.key,y:val.count})}),$scope.httpProtocol=newData}})},$scope.reloadStatusCode=function(filters){$scope.statusCode=[],Stats.statusCode(filters).$promise.then(function(data){var newData=[];data.data&&data.data.length>0&&(angular.forEach(data.data,function(os){newData.push({name:os.key,y:os.count})}),$scope.statusCode=newData)})},$scope.reloadContentType=function(filters){$scope.contentType=[],Stats.contentType(filters).$promise.then(function(data){if(data.data&&data.data.length>0){var newData=[];angular.forEach(data.data,function(val){newData.push({name:val.key,y:val.count})}),$scope.contentType=newData}})},$scope.reloadCacheStatus=function(filters){$scope.cacheStatus=[],Stats.cacheStatus(filters).$promise.then(function(data){if(data.data&&data.data.length>0){var newData=[];angular.forEach(data.data,function(val){newData.push({name:val.key,y:val.count})}),$scope.cacheStatus=newData}})},$scope.reloadQUIC=function(filters){$scope.quic=[],Stats.quic(filters).$promise.then(function(data){if(data.data&&data.data.length>0){var newData=[];angular.forEach(data.data,function(val){newData.push({name:"-"===val.key?"Non-QUIC":val.key,y:val.count})}),$scope.quic=newData}})},$scope.reloadHTTP2=function(filters){$scope.http2=[],Stats.http2(filters).$promise.then(function(data){if(data.data&&data.data.length>0){var http2=[];angular.forEach(data.data,function(val){http2.push({name:""===val.key?"Non-HTTP2":val.key.toUpperCase(),y:val.count})}),$scope.http2=http2}})},$scope.reloadCountry=function(filters){$scope.country=[],Stats.country(filters).$promise.then(function(data){if(data.data&&data.data.length>0){var newData=[];angular.forEach(data.data,function(val){var name=$scope.countries[val.key.toUpperCase()]||val.key;newData.push({name:name,y:val.count})}),$scope.country=newData}})},$scope.reloadRequestStatus=function(filters){$scope.requestStatus=[],Stats.requestStatus(filters).$promise.then(function(data){if(data.data&&data.data.length>0){var st=[{name:"Successfull",y:0},{name:"Failed",y:0}];angular.forEach(data.data,function(item){
"OK"===item.key?st[0].y=item.count:st[1].y+=item.count}),$scope.requestStatus=st}})},$scope.reload=function(){var filters={domainId:$scope.domain.id,from_timestamp:moment().subtract($scope.delay,"hours").valueOf(),to_timestamp:Date.now()};$scope.country_filter&&(filters.country=$scope.country_filter),$scope.reloadOS(filters),$scope.reloadDevice(filters),$scope.reloadCountry(filters),$scope.reloadProtocol(filters),$scope.reloadHttpMethod(filters),$scope.reloadHttpProtocol(filters),$scope.reloadStatusCode(filters),$scope.reloadContentType(filters),$scope.reloadCacheStatus(filters),$scope.reloadQUIC(filters),$scope.reloadHTTP2(filters),$scope.reloadRequestStatus(filters)},User.getUserDomains(!0).then(function(domains){$scope.domains=domains})["catch"](function(){AlertService.danger("Oops something wrong")})["finally"](function(){$scope._loading=!1}),$scope.onDomainSelected=function(domain){$scope.domain&&$scope.domain.id&&$scope.reload()}}TopReportsTrafficController.$inject=["$scope","User","AlertService","Stats","Countries"],angular.module("revapm.Portal.Reports").controller("TopReportsTrafficController",TopReportsTrafficController)}(),function(){"use strict";function TopObjectsController($scope,User,AlertService,Stats,Countries,$q){$scope._loading=!0,$scope.domain=null,$scope.domains=[],$scope.countries=Countries.query(),$scope.os=[],$scope.devices=[],$scope.reload=function(){if($scope.domain&&$scope.domain.id){$scope.os=[],$scope.devices=[];var promises=[Stats.os({domainId:$scope.domain.id}).$promise,Stats.device({domainId:$scope.domain.id}).$promise];$q.all(promises).then(function(data){data&&data[0]&&data[1]&&data[0].data&&data[1].data&&(data[0].data.map(function(os){$scope.os.push(os.key)}),data[1].data.map(function(device){$scope.devices.push(device.key)}))})}},User.getUserDomains(!0).then(function(domains){$scope.domains=domains})["catch"](function(){AlertService.danger("Oops something wrong")})["finally"](function(){$scope._loading=!1}),$scope.onDomainSelected=function(){$scope.reload()}}TopObjectsController.$inject=["$scope","User","AlertService","Stats","Countries","$q"],angular.module("revapm.Portal.Reports").controller("TopObjectsController",TopObjectsController)}(),function(){"use strict";function FBTReportsController($scope,User,AlertService,Stats,Countries,$q){$scope._loading=!0,$scope.domain=null,$scope.domains=[],$scope.countries=Countries.query(),$scope.oses=[],$scope.devices=[],$scope.reload=function(){if($scope.domain&&$scope.domain.id){$scope.oses=[],$scope.devices=[];var promises=[Stats.os({domainId:$scope.domain.id}).$promise,Stats.device({domainId:$scope.domain.id}).$promise];$q.all(promises).then(function(data){if(data&&data[0]&&data[1]&&data[0].data&&data[1].data){var oses=[],devices=[];data[0].data.map(function(os){oses.push(os.key)}),data[1].data.map(function(device){devices.push(device.key)}),$scope.oses=oses,$scope.devices=devices}})}},User.getUserDomains(!0).then(function(domains){$scope.domains=domains})["catch"](function(){AlertService.danger("Oops something wrong")})["finally"](function(){$scope._loading=!1}),$scope.onDomainSelected=function(){$scope.reload()}}FBTReportsController.$inject=["$scope","User","AlertService","Stats","Countries","$q"],angular.module("revapm.Portal.Reports").controller("FBTReportsController",FBTReportsController)}(),function(){"use strict";function TrafficHeatmapsController($scope,HeatmapsDrawer,Countries,Stats,$q){$scope._loading=!1,$scope.domain=null,$scope.delay="24",$scope.countryHitsData={},$scope.countryGBTData={},$scope.countries=Countries.query(),$scope.reloadHitsCountry=function(domainId){return HeatmapsDrawer.clearMap("#canvas-svg-hits"),$scope._loading=!0,$scope.countryHitsData={},Stats.country({domainId:domainId,count:250,from_timestamp:moment().subtract($scope.delay||6,"hours").valueOf(),to_timestamp:Date.now()}).$promise.then(function(data){return data.data&&data.data.length>0&&angular.forEach(data.data,function(item){var name=$scope.countries[item.key.toUpperCase()]||item.key;$scope.countryHitsData[name]={value:item.count,tooltip:"<strong>"+HeatmapsDrawer.valueFormat(item.count)+"</strong> requests"}}),data})},$scope.reloadGBTCountry=function(domainId){return HeatmapsDrawer.clearMap("#canvas-svg-gbt"),$scope._loading=!0,$scope.countryGBTData={},Stats.gbt_country({domainId:domainId,count:250,from_timestamp:moment().subtract($scope.delay||6,"hours").valueOf(),to_timestamp:Date.now()}).$promise.then(function(data){return data.data&&data.data.length>0&&angular.forEach(data.data,function(item){var name=$scope.countries[item.key.toUpperCase()]||item.key;$scope.countryGBTData[name]={value:item.sent_bytes,tooltip:"Sent: <strong>"+HeatmapsDrawer.valueFormat(item.sent_bytes,"G")+"B</strong> Received: <strong>"+HeatmapsDrawer.valueFormat(item.received_bytes,"G")+"B</strong>"}}),data})},$scope.onDomainSelect=function(){$scope.domain&&$scope.domain.id&&$q.all([$scope.reloadHitsCountry($scope.domain.id),$scope.reloadGBTCountry($scope.domain.id)]).then(function(){HeatmapsDrawer.drawMap("#canvas-svg-hits","#tooltip-container-hits",$scope.countryHitsData),HeatmapsDrawer.drawMap("#canvas-svg-gbt","#tooltip-container-gbt",$scope.countryGBTData)})["finally"](function(){$scope._loading=!1})},HeatmapsDrawer.drawMap("#canvas-svg-hits","#tooltip-container-hits",{}),HeatmapsDrawer.drawMap("#canvas-svg-gbt","#tooltip-container-gbt",{})}TrafficHeatmapsController.$inject=["$scope","HeatmapsDrawer","Countries","Stats","$q"],angular.module("revapm.Portal.Reports").controller("TrafficHeatmapsController",TrafficHeatmapsController)}(),function(){"use strict";function LMRTTHeatmapsController($scope,HeatmapsDrawer,Countries,Stats){$scope._loading=!1,$scope.domain=null,$scope.delay="24",$scope.countryLMRTTData={},$scope.countries=Countries.query(),$scope.reloadCountry=function(domainId){return HeatmapsDrawer.clearMap(),$scope._loading=!0,$scope.countryLMRTTData={},Stats.lm_rtt_country({domainId:domainId,count:250,from_timestamp:moment().subtract($scope.delay||6,"hours").valueOf(),to_timestamp:Date.now()}).$promise.then(function(data){return data.data&&data.data.length>0&&angular.forEach(data.data,function(item){var name=$scope.countries[item.key.toUpperCase()]||item.key;$scope.countryLMRTTData[name]={value:item.lm_rtt_avg_ms,tooltip:"Avg: <strong>"+item.lm_rtt_avg_ms+"</strong> Min: <strong>"+item.lm_rtt_min_ms+"</strong> Max: <strong>"+item.lm_rtt_max_ms+"</strong> ms"}}),data})["finally"](function(){$scope._loading=!1})},$scope.onDomainSelect=function(){$scope.domain&&$scope.domain.id&&$scope.reloadCountry($scope.domain.id).then(function(){HeatmapsDrawer.drawMap("#canvas-svg","#tooltip-container",$scope.countryLMRTTData)})},HeatmapsDrawer.drawMap("#canvas-svg","#tooltip-container",{})}LMRTTHeatmapsController.$inject=["$scope","HeatmapsDrawer","Countries","Stats"],angular.module("revapm.Portal.Reports").controller("LMRTTHeatmapsController",LMRTTHeatmapsController)}(),function(){"use strict";angular.module("revapm.Portal.Mobile",["revapm.Portal.Shared","revapm.Portal.Config","revapm.Portal.Resources","ui.router","chart.js"])}(),function(){"use strict";function ReportsRoutes($stateProvider){$stateProvider.state("index.mobile.traffic",{url:"/mobile/traffic",views:{main:{controller:"MobileTrafficController",templateUrl:"parts/reports/mobile-traffic.html"}}}).state("index.mobile.tops",{url:"/mobile/tops",views:{main:{controller:"MobileTopsController",templateUrl:"parts/reports/mobile-tops.html"}}}).state("index.mobile.objects",{url:"/mobile/top_objects",views:{main:{controller:"MobileTopObjectsController",templateUrl:"parts/reports/mobile-top-objects.html"}}}).state("index.mobile.distributions",{url:"/mobile/distributions",views:{main:{controller:"MobileDistributionsController",templateUrl:"parts/reports/mobile-distributions.html"}}}).state("index.mobile.ab",{url:"/mobile/ab",views:{main:{controller:"MobileAbController",templateUrl:"parts/reports/mobile-ab.html"}}})}ReportsRoutes.$inject=["$stateProvider"],angular.module("revapm.Portal.Mobile").config(ReportsRoutes)}(),function(){"use strict";function MobileTrafficController($scope,User,AlertService,Stats){$scope._loading=!0,$scope.application=null;var u=User.getUser();$scope.account=u.companyId[0]||null,$scope.oses=[],$scope.devices=[],$scope.countries=[],$scope.operators=[],$scope.networks=["Cellular","WiFi"],$scope.reloadDirs=function(){$scope.oses=[],$scope.devices=[],$scope.countries=[],$scope.operators=[],($scope.account||$scope.application&&$scope.application.app_id)&&($scope._loading=!0,Stats.sdk_dirs({account_id:$scope.account,app_id:$scope.application&&$scope.application.app_id||null,from_timestamp:moment().subtract(7,"days").valueOf(),to_timestamp:Date.now()}).$promise.then(function(data){data.data&&($scope.oses=data.data.oses,$scope.devices=data.data.devices,$scope.countries=data.data.countries,$scope.operators=data.data.operators)})["catch"](function(err){AlertService.danger("Oops! Something went wrong"),console.log(err)})["finally"](function(){$scope._loading=!1}))}}MobileTrafficController.$inject=["$scope","User","AlertService","Stats"],angular.module("revapm.Portal.Mobile").controller("MobileTrafficController",MobileTrafficController)}(),function(){"use strict";function mobileRpsChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/mobile-base-traffic.html",scope:{ngAccount:"=",ngApp:"=",flOses:"=",flDevices:"=",flCountries:"=",flOperators:"=",flNetworks:"="},controller:["$scope","Stats","Util",function($scope,Stats,Util){$scope.heading="Requests Per Second Graph",$scope.span="1",$scope._loading=!1,$scope.hits={labels:[],series:[]},$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now(),os:null,device:null,country:null,operator:null,network:null},$scope.chartOptions={yAxis:{title:{text:"Requests Per Second"},labels:{formatter:function(){return Util.formatNumber(this.value)}}},tooltip:{formatter:function(){return"<strong>"+this.x+"</strong><br/>"+this.series.name+": <strong>"+Util.formatNumber(this.y,3)+"</strong>"}}},$scope.reload=function(){return $scope._loading=!0,$scope.hits={labels:[],series:[{name:"RPS",data:[]}]},$scope.filters.account_id=$scope.ngAccount,$scope.filters.app_id=$scope.ngApp||null,Stats.sdk_flow($scope.filters).$promise.then(function(data){var hits_series=[{name:"RPS",data:[]}];if(data.data&&data.data.length>0){var labels=[],hits_total=0,interval=data.metadata.interval_sec||1800,offset=1e3*interval;angular.forEach(data.data,function(item){labels.push(moment(item.time+offset).format("MMM Do YY h:mm")),hits_series[0].data.push(Math.round(1e3*item.hits/interval)/1e3),hits_total+=item.hits}),hits_total&&($scope.hits={labels:labels,series:hits_series})}})["finally"](function(){$scope._loading=!1})},$scope.$watch("ngApp",function(){($scope.ngAccount||$scope.ngApp)&&$scope.reload()})}]}}angular.module("revapm.Portal.Mobile").directive("mobileRpsChart",mobileRpsChartDirective)}(),function(){"use strict";function mobileBwChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/mobile-base-traffic.html",scope:{ngAccount:"=",ngApp:"=",flOses:"=",flDevices:"=",flCountries:"=",flOperators:"=",flNetworks:"="},controller:["$scope","Stats","Util",function($scope,Stats,Util){$scope.heading="Bandwidth Usage Graph",$scope.span="1",$scope._loading=!1,$scope.hits={labels:[],series:[]},$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now(),os:null,device:null,country:null,operator:null,network:null},$scope.chartOptions={yAxis:{title:{text:"Bandwidth"},labels:{formatter:function(){return Util.convertTraffic(this.value)}}},tooltip:{formatter:function(){return"<strong>"+this.x+"</strong><br/>"+this.series.name+": <strong>"+Util.convertTraffic(this.y)+"</strong>"}}},$scope.reload=function(){return $scope._loading=!0,$scope.hits={labels:[],series:[{name:"Incoming Bandwidth",data:[]},{name:"Outgoing Bandwidth",data:[]}]},$scope.filters.account_id=$scope.ngAccount,$scope.filters.app_id=$scope.ngApp||null,Stats.sdk_flow($scope.filters).$promise.then(function(data){var hits_series=[{name:"Incoming Bandwidth",data:[]},{name:"Outgoing Bandwidth",data:[]}];if(data.data&&data.data.length>0){var labels=[],hits_total=0,interval=data.metadata.interval_sec||1800,offset=1e3*interval;angular.forEach(data.data,function(item){labels.push(moment(item.time+offset).format("MMM Do YY h:mm")),hits_series[0].data.push(Math.round(1e3*item.received_bytes/interval)/1e3),hits_series[1].data.push(Math.round(1e3*item.sent_bytes/interval)/1e3),hits_total+=item.received_bytes+item.sent_bytes}),hits_total&&($scope.hits={labels:labels,series:hits_series})}})["finally"](function(){$scope._loading=!1})},$scope.$watch("ngApp",function(){($scope.ngAccount||$scope.ngApp)&&$scope.reload()})}]}}angular.module("revapm.Portal.Mobile").directive("mobileBwChart",mobileBwChartDirective)}(),function(){"use strict";function mobileHttpCodesChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/mobile-base-traffic.html",scope:{ngAccount:"=",ngApp:"=",flOses:"=",flDevices:"=",flCountries:"=",flOperators:"=",flNetworks:"="},controller:["$scope","Stats","Util",function($scope,Stats,Util){$scope.heading="HTTP Status Codes Graph",$scope.span="1",$scope._loading=!1,$scope.hits={labels:[],series:[]},$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now(),report_type:"status_code",os:null,device:null,country:null,operator:null,network:null},$scope.chartOptions={yAxis:{title:{text:"Requests Per Second"},labels:{formatter:function(){return Util.formatNumber(this.value)}}},tooltip:{formatter:function(){return"<strong>"+this.x+"</strong><br/>"+this.series.name+": <strong>"+Util.formatNumber(this.y,3)+"</strong>"}}},$scope.reload=function(){return $scope._loading=!0,$scope.hits={labels:[],series:[]},$scope.filters.account_id=$scope.ngAccount,$scope.filters.app_id=$scope.ngApp||null,Stats.sdk_agg_flow($scope.filters).$promise.then(function(data){if(data.data&&data.data.length>0){var hits_series=[],labels=[],interval=data.metadata.interval_sec||1800,offset=1e3*interval,labels_filled_up=!1;angular.forEach(data.data,function(code){for(var s={name:""+code.key,data:[],visible:!1},i=0,len=code.flow.length;len>i;++i){var item=code.flow[i];labels_filled_up||labels.push(moment(item.time+offset).format("MMM Do YY h:mm"));var rps=Math.round(1e3*item.hits/interval)/1e3;s.data.push(rps),rps>.01&&(s.visible=!0)}hits_series.push(s),labels_filled_up=!0}),hits_series[0].visible=!0,$scope.hits={labels:labels,series:hits_series}}})["finally"](function(){$scope._loading=!1})},$scope.$watch("ngApp",function(){($scope.ngAccount||$scope.ngApp)&&$scope.reload()})}]}}angular.module("revapm.Portal.Mobile").directive("mobileHttpCodesChart",mobileHttpCodesChartDirective)}(),function(){"use strict";function mobileTopObjectsDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/mobile-base-top-objects.html",scope:{ngAccount:"=",ngApp:"=",flOses:"=",flDevices:"=",flCountries:"=",flOperators:"=",flNetworks:"=",reportType:"@",heading:"@"},controller:["$scope","Stats",function($scope,Stats){$scope.span="24",$scope._loading=!1,$scope.items=[],$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now(),os:null,device:null,country:null,operator:null,network:null,count:10},$scope.reportType&&($scope.filters.report_type=$scope.reportType),$scope.reload=function(){return $scope._loading=!0,$scope.filters.account_id=$scope.ngAccount,$scope.filters.app_id=$scope.ngApp||null,$scope.items=[],Stats.sdk_top_objects($scope.filters).$promise.then(function(data){$scope.items=data.data})["finally"](function(){$scope._loading=!1})},$scope.$watch("ngApp",function(){($scope.ngAccount||$scope.ngApp)&&$scope.reload()})}]}}angular.module("revapm.Portal.Reports").directive("mobileTopObjects",mobileTopObjectsDirective)}(),function(){"use strict";function mobileTopObjectsTimeDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/mobile-top-objects-time.html",scope:{ngAccount:"=",ngApp:"=",flOses:"=",flDevices:"=",flCountries:"=",flOperators:"=",flNetworks:"=",reportType:"@",heading:"@"},controller:["$scope","Stats","Util",function($scope,Stats,Util){$scope.span="24",$scope._loading=!1,$scope.items=[],$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now(),os:null,device:null,country:null,operator:null,network:null,count:10},$scope.filters.report_type=$scope.reportType,$scope.reload=function(){return $scope._loading=!0,$scope.filters.account_id=$scope.ngAccount,$scope.filters.app_id=$scope.ngApp||null,$scope.items=[],Stats.sdk_top_objects_time($scope.filters).$promise.then(function(data){for(var i=0,len=data.data.length;len>i;++i)data.data[i].val=Util.formatNumber(data.data[i].val,0);$scope.items=data.data})["finally"](function(){$scope._loading=!1})},$scope.$watch("ngApp",function(){($scope.ngAccount||$scope.ngApp)&&$scope.reload()})}]}}angular.module("revapm.Portal.Reports").directive("mobileTopObjectsTime",mobileTopObjectsTimeDirective)}(),function(){"use strict";function mobileTopObjects5xxDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/mobile-top-objects-5xx.html",scope:{ngAccount:"=",ngApp:"=",flOses:"=",flDevices:"=",flCountries:"=",flOperators:"=",flNetworks:"=",heading:"@"},controller:["$scope","Stats",function($scope,Stats){$scope.span="24",$scope._loading=!1;var http_codes={500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"};$scope.items=[],$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now(),os:null,device:null,country:null,operator:null,network:null,count:10},$scope.reload=function(){return $scope._loading=!0,$scope.filters.account_id=$scope.ngAccount,$scope.filters.app_id=$scope.ngApp||null,$scope.items=[],Stats.sdk_top_objects_5xx($scope.filters).$promise.then(function(data){for(var items=[],i=0,len=data.data.length;len>i;++i){var item=data.data[i];items.push({key:item.key+(http_codes[item.key]?" ("+http_codes[item.key]+")":""),count:item.count,items:item.items})}$scope.items=items})["finally"](function(){$scope._loading=!1})},$scope.$watch("ngApp",function(){($scope.ngAccount||$scope.ngApp)&&$scope.reload()})}]}}angular.module("revapm.Portal.Reports").directive("mobileTopObjects5xx",mobileTopObjects5xxDirective)}(),function(){"use strict";function MobileTopsController($scope,$q,User,AlertService,Stats,Countries,Util){$scope._loading=!1,$scope.application=null;var u=User.getUser();$scope.account=u.companyId[0]||null,$scope.countries=Countries.query(),$scope.country_hits=[],$scope.country_users=[],$scope.country_gbt=[],$scope.os_hits=[],$scope.os_users=[],$scope.os_gbt=[],$scope.device_hits=[],$scope.device_users=[],$scope.device_gbt=[],$scope.operator_hits=[],$scope.operator_users=[],$scope.operator_gbt=[],$scope.network_hits=[],$scope.network_users=[],$scope.network_gbt=[],$scope.domain_hits=[],$scope.domain_gbt=[],$scope.status_code_hits=[],$scope.span="24",$scope.gbtChartOpts={tooltip:{formatter:function(){return"<b>"+this.point.name+": </b>"+Highcharts.numberFormat(this.point.percentage,1)+"% ("+Util.humanFileSize(this.y,2)+")"}}},$scope.hitsChartOpts={tooltip:{formatter:function(){return"<b>"+this.point.name+": </b>"+Highcharts.numberFormat(this.point.percentage,1)+"% ("+Highcharts.numberFormat(this.y,0,".","'")+" hits)"}}},$scope.usersChartOpts={tooltip:{formatter:function(){return"<b>"+this.point.name+": </b>"+Highcharts.numberFormat(this.point.percentage,1)+"% ("+Highcharts.numberFormat(this.y,0,".","'")+" users)"}}},$scope.reloadOne=function(type,name,count,filters){return $scope[name+"_"+type]=[],filters.report_type=name,filters.count=count,Stats["sdk_top_"+type](filters).$promise.then(function(data){if(data.data&&data.data.length>0){var newData=[];angular.forEach(data.data,function(item){"country"===name&&(item.key=$scope.countries[item.key.toUpperCase()]||item.key),newData.push({name:item.key,y:"gbt"===type?item.received_bytes:item.count})}),$scope[name+"_"+type]=newData}})},$scope.reloadOther=function(type,name,count,filters){return $scope[name+"_"+type]=[],filters.report_type=name,filters.count=count,Stats.sdk_distributions(filters).$promise.then(function(data){if(data.data&&data.data.length>0){var newData=[];angular.forEach(data.data,function(item){newData.push({name:item.key,y:"gbt"===type?item.received_bytes:item.count})}),$scope[name+"_"+type]=newData}})},$scope.reload=function(){if($scope.account||$scope.application&&$scope.application.app_id){var filters={account_id:$scope.account,app_id:$scope.application&&$scope.application.app_id||null,from_timestamp:moment().subtract($scope.span,"hours").valueOf(),to_timestamp:Date.now()};return $scope._loading=!0,$q.all([$scope.reloadOne("hits","country",20,filters),$scope.reloadOne("users","country",20,filters),$scope.reloadOne("gbt","country",20,filters),$scope.reloadOne("hits","os",10,filters),$scope.reloadOne("users","os",10,filters),$scope.reloadOne("gbt","os",10,filters),$scope.reloadOne("hits","device",20,filters),$scope.reloadOne("users","device",20,filters),$scope.reloadOne("gbt","device",20,filters),$scope.reloadOne("hits","operator",20,filters),$scope.reloadOne("users","operator",20,filters),$scope.reloadOne("gbt","operator",20,filters),$scope.reloadOne("hits","network",2,filters),$scope.reloadOne("users","network",2,filters),$scope.reloadOne("gbt","network",2,filters),$scope.reloadOther("gbt","domain",10,filters),$scope.reloadOther("hits","domain",10,filters),$scope.reloadOther("hits","status_code",10,filters)])["catch"](function(err){AlertService.danger("Oops! Something went wrong"),console.log(err)})["finally"](function(){$scope._loading=!1})}}}MobileTopsController.$inject=["$scope","$q","User","AlertService","Stats","Countries","Util"],angular.module("revapm.Portal.Mobile").controller("MobileTopsController",MobileTopsController)}(),function(){"use strict";function MobileDistributionsController($scope,$q,User,AlertService,Stats,Util){$scope._loading=!0,$scope.application=null;var u=User.getUser();$scope.account=u.companyId[0]||null,$scope.destination_hits=[],$scope.destination_gbt=[],$scope.transport_hits=[],$scope.transport_gbt=[],$scope.status_hits=[],$scope.status_gbt=[],$scope.cache_hits=[],$scope.cache_gbt=[],$scope.domain_hits=[],$scope.domain_gbt=[],$scope.status_code_hits=[],$scope.span="24",$scope.gbtChartOpts={tooltip:{formatter:function(){return"<b>"+this.point.name+": </b>"+Highcharts.numberFormat(this.point.percentage,1)+"% ("+Util.humanFileSize(this.y,2)+")"}}},$scope.hitsChartOpts={tooltip:{formatter:function(){return"<b>"+this.point.name+": </b>"+Highcharts.numberFormat(this.point.percentage,1)+"% ("+Highcharts.numberFormat(this.y,0,".","'")+" hits)"}}},$scope.reloadTwo=function(name,filters){return $scope[name+"_hits"]=[],$scope[name+"_gbt"]=[],filters.report_type=name,Stats.sdk_distributions(filters).$promise.then(function(data){if(data.data&&data.data.length>0){var hits=[],gbt=[];angular.forEach(data.data,function(item){hits.push({name:item.key,y:item.count}),gbt.push({name:item.key,y:item.received_bytes})}),$scope[name+"_hits"]=hits,$scope[name+"_gbt"]=gbt}})},$scope.reload=function(){if($scope.account||$scope.application&&$scope.application.app_id){var filters={account_id:$scope.account,app_id:$scope.application&&$scope.application.app_id||null,from_timestamp:moment().subtract($scope.span,"hours").valueOf(),to_timestamp:Date.now(),count:10};$scope._loading=!0,$q.all([$scope.reloadTwo("destination",filters),$scope.reloadTwo("transport",filters),$scope.reloadTwo("status",filters),$scope.reloadTwo("cache",filters)])["catch"](function(err){AlertService.danger("Oops! Something went wrong"),console.log(err)})["finally"](function(){$scope._loading=!1})}}}MobileDistributionsController.$inject=["$scope","$q","User","AlertService","Stats","Util"],angular.module("revapm.Portal.Mobile").controller("MobileDistributionsController",MobileDistributionsController)}(),function(){"use strict";function MobileTopObjectsController($scope,User,AlertService,Stats,Util){$scope._loading=!0,$scope.application=null;var u=User.getUser();$scope.account=u.companyId[0]||null,$scope.oses=[],$scope.devices=[],$scope.countries=[],$scope.operators=[],$scope.networks=["Cellular","WiFi"],$scope.reloadDirs=function(){($scope.account||$scope.application&&$scope.application.app_id)&&($scope._loading=!0,$scope.oses=[],$scope.devices=[],$scope.countries=[],$scope.operators=[],Stats.sdk_dirs({account_id:$scope.account,app_id:$scope.application&&$scope.application.app_id||null,from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now()}).$promise.then(function(data){data.data&&($scope.oses=data.data.oses,$scope.devices=data.data.devices,$scope.countries=data.data.countries,$scope.operators=data.data.operators)})["catch"](function(err){AlertService.danger("Oops! Something went wrong"),console.log(err)})["finally"](function(){$scope._loading=!1}))}}MobileTopObjectsController.$inject=["$scope","User","AlertService","Stats","Util"],angular.module("revapm.Portal.Mobile").controller("MobileTopObjectsController",MobileTopObjectsController)}(),function(){"use strict";function MobileAbController($scope,User,AlertService,Stats){$scope._loading=!0,$scope.application=null;var u=User.getUser();$scope.account=u.companyId[0]||null,$scope.oses=[],$scope.devices=[],$scope.countries=[],$scope.operators=[],$scope.networks=["Cellular","WiFi"],$scope.reloadDirs=function(){$scope.oses=[],$scope.devices=[],$scope.countries=[],$scope.operators=[],($scope.account||$scope.application&&$scope.application.app_id)&&($scope._loading=!0,Stats.sdk_dirs({account_id:$scope.account,app_id:$scope.application&&$scope.application.app_id||null,from_timestamp:moment().subtract(7,"days").valueOf(),to_timestamp:Date.now()}).$promise.then(function(data){data.data&&($scope.oses=data.data.oses,$scope.devices=data.data.devices,$scope.countries=data.data.countries,$scope.operators=data.data.operators)})["catch"](function(err){AlertService.danger("Oops! Something went wrong"),console.log(err)})["finally"](function(){$scope._loading=!1}))}}MobileAbController.$inject=["$scope","User","AlertService","Stats"],angular.module("revapm.Portal.Mobile").controller("MobileAbController",MobileAbController)}(),function(){"use strict";function mobileAbFbtChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/mobile-base-traffic.html",scope:{ngAccount:"=",ngApp:"=",flOses:"=",flDevices:"=",flCountries:"=",flOperators:"=",flNetworks:"="},controller:["$scope","Stats","Util",function($scope,Stats,Util){$scope.heading="First Byte Time Graph",$scope.span="1",$scope._loading=!1,$scope.chartOptions={chart:{type:"column"},yAxis:{title:{text:"FBT ms"},labels:{formatter:function(){return Util.formatNumber(this.value,1)}}},xAxis:{crosshair:{width:1,color:"#000000"}},tooltip:{formatter:function(){return"<strong>"+this.x+"</strong><br/>"+this.series.name+": <strong>"+Util.formatNumber(this.y,1)+"</strong>"}}},$scope.hits={labels:[],series:[{name:"Origin, Avg",data:[],color:"#3c65ac",marker:{radius:4,symbol:"circle"}},{name:"Origin, Min",data:[],color:"#7cb5ec",marker:{radius:2,symbol:"circle"},visible:!1},{name:"Origin, Max",data:[],color:"#7cb5ec",marker:{radius:2,symbol:"circle"},visible:!1},{name:"RevAPM, Avg",data:[],color:"#000000",marker:{radius:4,symbol:"diamond"}},{name:"RevAPM, Min",data:[],color:"#808080",marker:{radius:2,symbol:"diamond"},visible:!1},{name:"RevAPM, Max",data:[],color:"#808080",marker:{radius:2,symbol:"diamond"},visible:!1}]},$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now(),os:null,device:null,country:null,operator:null,network:null},$scope.reload=function(){return $scope._loading=!0,$scope.hits.labels=[],$scope.hits.series[0].data=[],$scope.hits.series[1].data=[],$scope.hits.series[2].data=[],$scope.hits.series[3].data=[],$scope.hits.series[4].data=[],$scope.hits.series[5].data=[],$scope.filters.account_id=$scope.ngAccount,$scope.filters.app_id=$scope.ngApp||null,Stats.sdk_ab_fbt($scope.filters).$promise.then(function(data){if(data.data&&data.data.length>0){var labels=[],hits={rev_edge:{min:[],max:[],avg:[]},origin:{min:[],max:[],avg:[]}},interval=data.metadata.interval_sec||1800,offset=1e3*interval,labels_filled=!1;angular.forEach(data.data,function(dest){angular.forEach(dest.items,function(item){labels_filled||labels.push(moment(item.key+offset).format("MMM Do YY h:mm")),hits[dest.key].max.push(item.fbt_max),hits[dest.key].min.push(item.fbt_min),hits[dest.key].avg.push(item.fbt_average)}),labels_filled=!0}),$scope.hits.labels=labels,$scope.hits.series[0].data=hits.origin.avg,$scope.hits.series[1].data=hits.origin.min,$scope.hits.series[2].data=hits.origin.max,$scope.hits.series[3].data=hits.rev_edge.avg,$scope.hits.series[4].data=hits.rev_edge.min,$scope.hits.series[5].data=hits.rev_edge.max}})["finally"](function(){$scope._loading=!1})},$scope.$watch("ngApp",function(){($scope.ngAccount||$scope.ngApp)&&$scope.reload()})}]}}angular.module("revapm.Portal.Mobile").directive("mobileAbFbtChart",mobileAbFbtChartDirective)}(),function(){"use strict";function mobileAbFbtDistributionChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/mobile-base-traffic.html",scope:{ngAccount:"=",ngApp:"=",flOses:"=",flDevices:"=",flCountries:"=",flOperators:"=",flNetworks:"=",flInterval:"@",flLimit:"@"},controller:["$scope","Stats","Util",function($scope,Stats,Util){var _interval=parseInt($scope.flInterval||100),_limit=parseInt($scope.flLimit||5e3);$scope.heading="First Byte Time Values Distribution Graph",$scope.span="1",$scope._loading=!1,$scope.chartOptions={chart:{type:"column"},yAxis:{title:{text:"Hits"},labels:{formatter:function(){return Util.formatNumber(this.value,0)}}},xAxis:{title:{text:"FBT ms",align:"low"}},legend:{margin:0},tooltip:{formatter:function(){return"<strong>"+this.x+"÷"+(this.x+_interval)+"</strong> ms<br/>"+this.series.name+": <strong>"+Util.formatNumber(this.y,0)+"</strong> hits"}}},$scope.hits={labels:[],series:[{name:"Origin",data:[],color:Highcharts.getOptions().colors[0],marker:{radius:4,symbol:"circle"}},{name:"RevAPM",data:[],color:Highcharts.getOptions().colors[1],marker:{radius:4,symbol:"diamond"}}]},$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now(),os:null,device:null,country:null,operator:null,network:null,interval_ms:_interval,limit_ms:_limit},$scope.reload=function(){return $scope._loading=!0,$scope.hits.labels=[],$scope.hits.series[0].data=[],$scope.hits.series[1].data=[],$scope.filters.account_id=$scope.ngAccount,$scope.filters.app_id=$scope.ngApp||null,Stats.sdk_ab_fbt_distribution($scope.filters).$promise.then(function(data){if(data.data&&data.data.length>0){var labels=[],hits={rev_edge:[],origin:[]},labels_filled=!1;angular.forEach(data.data,function(dest){angular.forEach(dest.items,function(item){labels_filled||labels.push(item.key),hits[dest.key].push(item.count)}),labels_filled=!0}),$scope.hits.labels=labels,$scope.hits.series[0].data=hits.origin,$scope.hits.series[1].data=hits.rev_edge}})["finally"](function(){$scope._loading=!1})},$scope.$watch("ngApp",function(){($scope.ngAccount||$scope.ngApp)&&$scope.reload()})}]}}angular.module("revapm.Portal.Mobile").directive("mobileAbFbtDistributionChart",mobileAbFbtDistributionChartDirective)}(),function(){"use strict";function mobileAbErrorsChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/mobile-base-traffic.html",scope:{ngAccount:"=",ngApp:"=",flOses:"=",flDevices:"=",flCountries:"=",flOperators:"=",flNetworks:"="},controller:["$scope","Stats","Util",function($scope,Stats,Util){$scope.heading="SDK Failed Requests Graph",$scope.span="1",
$scope._loading=!1,$scope.chartOptions={yAxis:{title:{text:"Erros Count"},labels:{formatter:function(){return Util.formatNumber(this.value,0)}}},tooltip:{formatter:function(){return"<strong>"+this.x+"</strong><br/>"+this.series.name+": <strong>"+Util.formatNumber(this.y,0)+"</strong>"}}},$scope.hits={labels:[],series:[{name:"Origin",data:[],color:Highcharts.getOptions().colors[0],marker:{radius:4,symbol:"circle"}},{name:"RevAPM",data:[],color:Highcharts.getOptions().colors[1],marker:{radius:4,symbol:"diamond"}}]},$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now(),os:null,device:null,country:null,operator:null,network:null},$scope.reload=function(){return $scope._loading=!0,$scope.hits.labels=[],$scope.hits.series[0].data=[],$scope.hits.series[1].data=[],$scope.filters.account_id=$scope.ngAccount,$scope.filters.app_id=$scope.ngApp||null,Stats.sdk_ab_errors($scope.filters).$promise.then(function(data){if(data.data&&data.data.length>0){var labels=[],hits={rev_edge:[],origin:[]},interval=data.metadata.interval_sec||1800,offset=1e3*interval,labels_filled=!1;angular.forEach(data.data,function(dest){angular.forEach(dest.items,function(item){labels_filled||labels.push(moment(item.key+offset).format("MMM Do YY h:mm")),hits[dest.key].push(item.count)}),labels_filled=!0}),$scope.hits.labels=labels,$scope.hits.series[0].data=hits.origin,$scope.hits.series[1].data=hits.rev_edge,0===hits.origin.length&&($scope.hits.series[0].visible=!1),0===hits.rev_edge.length&&($scope.hits.series[1].visible=!1)}})["finally"](function(){$scope._loading=!1})},$scope.$watch("ngApp",function(){($scope.ngAccount||$scope.ngApp)&&$scope.reload()})}]}}angular.module("revapm.Portal.Mobile").directive("mobileAbErrorsChart",mobileAbErrorsChartDirective)}(),function(){"use strict";function mobileAbSpeedChartDirective(){return{restrict:"AE",templateUrl:"parts/reports/charts/mobile-base-traffic.html",scope:{ngAccount:"=",ngApp:"=",flOses:"=",flDevices:"=",flCountries:"=",flOperators:"=",flNetworks:"="},controller:["$scope","Stats","Util",function($scope,Stats,Util){$scope.heading="Average Request Speed Graph",$scope.span="1",$scope._loading=!1,$scope.chartOptions={chart:{type:"column"},yAxis:{title:{text:"Speed Kb/s"},labels:{formatter:function(){return Util.formatNumber(this.value/1024,0)}}},xAxis:{crosshair:{width:1,color:"#000000"}},tooltip:{formatter:function(){return"<strong>"+this.x+"</strong><br/>"+this.series.name+": <strong>"+Util.convertTraffic(this.y)+"</strong>"}}},$scope.hits={labels:[],series:[{name:"Origin",data:[],color:Highcharts.getOptions().colors[0],marker:{radius:4,symbol:"circle"}},{name:"RevAPM",data:[],color:Highcharts.getOptions().colors[1],marker:{radius:4,symbol:"diamond"}}]},$scope.filters={from_timestamp:moment().subtract(1,"days").valueOf(),to_timestamp:Date.now(),os:null,device:null,country:null,operator:null,network:null},$scope.reload=function(){return $scope._loading=!0,$scope.hits.labels=[],$scope.hits.series[0].data=[],$scope.hits.series[1].data=[],$scope.filters.account_id=$scope.ngAccount,$scope.filters.app_id=$scope.ngApp||null,Stats.sdk_ab_speed($scope.filters).$promise.then(function(data){if(data.data&&data.data.length>0){var labels=[],hits={rev_edge:[],origin:[]},interval=data.metadata.interval_sec||1800,offset=1e3*interval,labels_filled=!1;angular.forEach(data.data,function(dest){angular.forEach(dest.items,function(item){labels_filled||labels.push(moment(item.key+offset).format("MMM Do YY h:mm")),hits[dest.key].push(item.count?1e3*item.received_bytes/item.time_spent_ms:null)}),labels_filled=!0}),$scope.hits.labels=labels,$scope.hits.series[0].data=hits.origin,$scope.hits.series[1].data=hits.rev_edge}})["finally"](function(){$scope._loading=!1})},$scope.$watch("ngApp",function(){($scope.ngAccount||$scope.ngApp)&&$scope.reload()})}]}}angular.module("revapm.Portal.Mobile").directive("mobileAbSpeedChart",mobileAbSpeedChartDirective)}(),function(){"use strict";angular.module("revapm.Portal.Usage",["revapm.Portal.Shared","revapm.Portal.Config","revapm.Portal.Resources","ui.router","ui.select","ui.bootstrap.datetimepicker","ng.jsoneditor","ngSanitize"])}(),function(){"use strict";function UsageRoutes($stateProvider){$stateProvider.state("index.usage.web",{url:"/usage/web",views:{main:{controller:"UsageWebController",templateUrl:"parts/reports/usage-web.html"}}})}UsageRoutes.$inject=["$stateProvider"],angular.module("revapm.Portal.Usage").config(UsageRoutes)}(),function(){"use strict";function UsageWebController($scope,User,AlertService,Stats,Util){$scope._loading=!0,$scope.accounts=[],$scope.account=null,$scope.month_year=new Date,$scope.month_year_symbol=$scope.month_year.toISOString().slice(0,7),$scope.report=null,$scope.onAccountSelect=function(acc){User.selectAccount(acc),$scope.account=acc},$scope.onTimeSet=function(newDate){newDate=new Date(newDate),$scope.month_year=newDate,$scope.month_year_symbol=newDate.toISOString().slice(0,7)},$scope.onUpdate=function(){if(0!==$scope.accounts.length&&$scope.account){$scope._loading=!0;var q={from:moment($scope.month_year).utc().startOf("month").toISOString().slice(0,10),to:moment($scope.month_year).utc().endOf("month").toISOString().slice(0,10)};$scope.account.acc_id&&(q.account_id=$scope.account.acc_id),Stats.usage_web(q).$promise.then(function(data){var d=data.data[data.data.length-1];d.count=Util.formatNumber(d.count),d.cache_hits.MISS=Util.formatNumber(d.cache_hits.MISS),d.cache_hits.HIT=Util.formatNumber(d.cache_hits.HIT);for(var port in d.port_hits)d.port_hits[port]=Util.formatNumber(d.port_hits[port]);d.received_bytes=Util.humanFileSizeInGB(d.received_bytes),d.sent_bytes=Util.humanFileSizeInGB(d.sent_bytes);for(var zone in d.traffic_per_billing_zone)d.traffic_per_billing_zone[zone].count=Util.formatNumber(d.traffic_per_billing_zone[zone].count),d.traffic_per_billing_zone[zone].received_bytes=Util.humanFileSizeInGB(d.traffic_per_billing_zone[zone].received_bytes),d.traffic_per_billing_zone[zone].sent_bytes=Util.humanFileSizeInGB(d.traffic_per_billing_zone[zone].sent_bytes);$scope.report=d})["catch"](function(err){AlertService.danger("Oops! Something went wrong"),console.log(err)})["finally"](function(){$scope._loading=!1})}},User.getSelectedAccount()&&($scope.account=User.getSelectedAccount()),User.getUserAccounts().then(function(accs){$scope.accounts=accs,1===accs.length&&($scope.account=accs[0]),$scope.onUpdate()})["catch"](function(err){AlertService.danger("Oops! Something went wrong")})["finally"](function(){$scope._loading=!1})}UsageWebController.$inject=["$scope","User","AlertService","Stats","Util"],angular.module("revapm.Portal.Usage").controller("UsageWebController",UsageWebController)}(),function(){"use strict";angular.module("revapm.Portal.Keys",["revapm.Portal.Shared","revapm.Portal.Config","revapm.Portal.Resources","ui.router","ui.select"])}(),function(){"use strict";function routesConfig($stateProvider){$stateProvider.state("index.accountSettings.keys",{url:"/keys/list",views:{main:{controller:"KeysListController",templateUrl:"parts/keys/list.html"}}})}routesConfig.$inject=["$stateProvider"],angular.module("revapm.Portal.Keys").config(routesConfig)}(),function(){"use strict";function KeysListController($scope,CRUDController,ApiKeys,$injector,$stateParams,Companies,DomainsConfig,$state,$modal){function clearUpdateData(data){var fields=["key_name","account_id","domains","allowed_ops","read_only_status","active"];return _.pick(_.clone(data),fields)}return $injector.invoke(CRUDController,this,{$scope:$scope,$stateParams:$stateParams}),$scope.auth.isUser()?void $state.go("index.accountSettings.profile"):($scope.setState("index.accountSettings.keys"),$scope.setResource(ApiKeys),Companies.query().$promise.then(function(data){$scope.companies=data})["catch"](function(err){if(403==err.status){var user=$scope.auth.getUser();$scope.companies=[{id:user.companyId[0]}]}}),$scope.domains=DomainsConfig.query(),$scope.deleteKey=function(model){$scope.confirm("confirmModal.html",model).then(function(){$scope["delete"](model)["catch"]($scope.alertService.danger)})},$scope.createKey=function(account){return account&&account.id?($scope._loading=!0,$scope.alertService.clear(),ApiKeys.create({account_id:account.id}).$promise.then(function(data){return $scope.alertService.success("API Key created.",5e3),$scope.list(),data})["catch"]($scope.alertService.danger)["finally"](function(){$scope._loading=!1})):void 0},$scope.openCreateDialog=function(){if($scope.alertService.clear(),$scope.companies&&1===$scope.companies.length)return $scope.createKey($scope.companies[0]);var modalInstance=$modal.open({animation:!0,templateUrl:"parts/keys/dialog/create.html",controller:"KeysCreateController",size:"md",resolve:{companies:function(){return $scope.companies}}});modalInstance.result.then($scope.createKey)},$scope.openUpdateDialogFor=function(keyId){$scope.alertService.clear();var modalInstance=$modal.open({animation:!0,templateUrl:"parts/keys/dialog/edit.html",controller:"KeysEditController",size:"md",resolve:{data:function(){return{companies:$scope.companies,domains:$scope.domains,keyId:keyId}}}});modalInstance.result.then(function(account){$scope.alertService.success("API Key updated.",5e3),$scope.list()})},$scope.toggleProperty=function(key,property){return key&&key.id&&!key.loading?(key[property]=!key[property],key.loading=!0,ApiKeys.update({id:key.id},clearUpdateData(key)).$promise.then(function(data){return data})["catch"]($scope.alertService.danger)["finally"](function(){key.loading=!1})):void 0},$scope.list(),void($scope.getRelativeDate=function(datetime){return moment.utc(datetime).fromNow()}))}KeysListController.$inject=["$scope","CRUDController","ApiKeys","$injector","$stateParams","Companies","DomainsConfig","$state","$modal"],angular.module("revapm.Portal.Keys").controller("KeysListController",KeysListController)}(),function(){"use strict";function KeysCreateController($scope,$modalInstance,companies){$scope.companies=companies,$scope.selected=null,$scope.onModelSelect=function(model){$scope.selected=model},$scope.ok=function(){$modalInstance.close($scope.selected)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}KeysCreateController.$inject=["$scope","$modalInstance","companies"],angular.module("revapm.Portal.Keys").controller("KeysCreateController",KeysCreateController)}(),function(){"use strict";function KeysEditController($scope,$modalInstance,ApiKeys,AlertService,data){function clearUpdateData(data){var fields=["key_name","account_id","domains","allowed_ops","read_only_status","active"];return _.pick(_.clone(data),fields)}$scope._loading=!1,$scope.companies=data.companies,$scope.domains=data.domains,$scope.selected=null,$scope.key=null,$scope.selectedDomains=[],$scope.selectDomains=function(accountId){$scope.selectedDomains=[],accountId&&angular.forEach($scope.domains,function(domain){domain.account_id===accountId&&$scope.selectedDomains.push(domain)})},$scope.loadKeyDetails=function(id){id&&($scope._loading=!0,$scope.key=null,ApiKeys.get({id:id}).$promise.then(function(key){$scope.key=key})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1}))},$scope.onModelSelect=function(model){$scope.selected=model},$scope.ok=function(){$scope.key&&$scope.key.id&&($scope._loading=!0,ApiKeys.update({id:$scope.key.id},clearUpdateData($scope.key)).$promise.then(function(data){$modalInstance.close(data)})["catch"](function(err){AlertService.danger(err)})["finally"](function(){$scope._loading=!1}))},$scope.cancel=function(){$modalInstance.dismiss("cancel")},data.keyId&&$scope.loadKeyDetails(data.keyId),$scope.$watch("key.account_id",function(account_id){$scope.selectDomains(account_id)})}KeysEditController.$inject=["$scope","$modalInstance","ApiKeys","AlertService","data"],angular.module("revapm.Portal.Keys").controller("KeysEditController",KeysEditController)}(),function(){"use strict";angular.module("revapm.Portal",["revapm.Portal.Auth","revapm.Portal.Profile","revapm.Portal.Users","revapm.Portal.Domains","revapm.Portal.Companies","revapm.Portal.Cache","revapm.Portal.Reports","revapm.Portal.Mobile","revapm.Portal.Usage","revapm.Portal.Keys","revapm.Portal.Apps","revapm.Portal.Signup","ui.router","ui.bootstrap.tpls","ui.bootstrap.tooltip","ui.bootstrap.popover","hljs"])}(),function(){"use strict";function configure(){}angular.module("revapm.Portal").config(configure)}(),function(){"use strict";function routesConfig($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/users");var menuController=function($scope,$state){$scope.$state=$state};menuController.$inject=["$scope","$state"],$stateProvider.state("index",{url:"",views:{layout:{templateUrl:"parts/layout.html",controller:["$scope","$state","User",function($scope,$state,User){$scope.userService=User,User.isAuthed()||"index.restore"==$state.current.name||"signup"==$state.current.name||"billing_plans"==$state.current.name?"index"==$state.current.name&&$state.go("index.reports.proxy"):$state.go("login")}]}},resolve:{isUserActive:["User",function(User){return User.reloadUser()}]}}).state("index.apps",{url:"/apps",views:{menu:{controller:menuController,templateUrl:"parts/cadmin-top-menu.html"},sideMenu:{templateUrl:"parts/menu/apps-side.html"},page:{templateUrl:"parts/layout/page.html"}}}).state("index.webApp",{url:"",views:{menu:{controller:menuController,templateUrl:"parts/cadmin-top-menu.html"},sideMenu:{templateUrl:"parts/menu/domains-side.html"},page:{templateUrl:"parts/layout/page.html"}}}).state("index.accountSettings",{url:"",views:{menu:{controller:menuController,templateUrl:"parts/cadmin-top-menu.html"},sideMenu:{templateUrl:"parts/menu/accounts-side.html"},page:{templateUrl:"parts/layout/page.html"}}}).state("index.reports",{url:"",views:{menu:{controller:menuController,templateUrl:"parts/cadmin-top-menu.html"},sideMenu:{templateUrl:"parts/menu/web-analitycs-side.html"},page:{templateUrl:"parts/layout/page.html"}}}).state("index.mobile",{url:"",views:{menu:{controller:menuController,templateUrl:"parts/cadmin-top-menu.html"},sideMenu:{templateUrl:"parts/menu/mobile-analitycs-side.html"},page:{templateUrl:"parts/layout/page.html"}}}).state("index.usage",{url:"",views:{menu:{controller:menuController,templateUrl:"parts/cadmin-top-menu.html"},sideMenu:{templateUrl:"parts/menu/accounts-side.html"},page:{templateUrl:"parts/layout/page.html"}}}).state("index.help",{url:"/help",views:{menu:{controller:menuController,templateUrl:"parts/cadmin-top-menu.html"},sideMenu:{templateUrl:"parts/menu/help-side.html"},page:{templateUrl:"parts/help/contactus.html"}}})}routesConfig.$inject=["$stateProvider","$urlRouterProvider"],angular.module("revapm.Portal").config(routesConfig)}(),function(){"use strict";function runApp($rootScope,AlertService){$rootScope.alertService=AlertService,$rootScope.$on("$stateChangeStart",function(event){AlertService.clear()}),$rootScope.$on("$stateChangeSuccess",function(event){setTimeout(function(){$("[autofocus]").focus()},0)}),$rootScope.$on("$stateChangeError",console.log.bind(console))}runApp.$inject=["$rootScope","AlertService"],angular.module("revapm.Portal").run(runApp)}();