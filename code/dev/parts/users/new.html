<div class="row">
    <div class="col-sm-12">
        <h2 class="page-title">
            Add New User
        </h2>
    </div>
</div>
<div class="row" ng-init="initNew()">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-md-12">
                        <div class="pull-left">
                            <a ui-sref="^" class="btn btn-info">
                                <i class="glyphicon glyphicon-arrow-left"></i>&nbsp; Back To List
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-body">
                <form class="new-user-form" name="createForm" novalidate>
                    <div class="row">
                        <div class="col-xs-12 col-sm-8 col-md-6">
                            <div class="form-group"
                                 ng-class="{'has-error': createForm.email.$invalid && createForm.email.$dirty}">
                                <label for="email" popover-append-to-body="{{true}}" class="control-label"
                                       popover-trigger="mouseenter"
                                       uib-popover="New user's email address - the address should be unique across the system">Email
                                    *</label>
                                <input type="email" autofocus class="form-control" id="email" name="email"
                                       placeholder="Email" ng-model="model.email" ng-maxlength="64"
                                       ng-disabled="_loading" required>

                                <div class="error-messages" ng-messages="createForm.email.$error" role="alert"
                                     ng-messages-multiple>
                                    <div ng-messages-include="parts/shared/error-messages.html"></div>
                                </div>
                            </div>
                            <div class="form-group"
                                 ng-class="{'has-error': createForm.firstName.$invalid && createForm.firstName.$dirty}">
                                <label for="firstname" class="control-label" popover-trigger="mouseenter"
                                       uib-popover="First name">First Name *</label>
                                <input type="text" class="form-control" id="firstname" name="firstName"
                                       placeholder="First Name" ng-model="model.firstname" ng-disabled="_loading"
                                       ng-maxlength="30" ng-pattern="NO_SPECIAL_CHARS" required>

                                <div class="error-messages" ng-messages="createForm.firstName.$error" role="alert"
                                     ng-messages-multiple>
                                    <div ng-messages-include="parts/shared/error-messages.html"></div>
                                </div>
                            </div>
                            <div class="form-group"
                                 ng-class="{'has-error': createForm.lastName.$invalid && createForm.lastName.$dirty}">
                                <label for="lastName" class="control-label" popover-trigger="mouseenter"
                                       uib-popover="Last name">Last Name *</label>
                                <input type="text" class="form-control" id="lastName" name="lastName"
                                       placeholder="Last Name" ng-model="model.lastname" ng-disabled="_loading"
                                       ng-maxlength="30" ng-pattern="NO_SPECIAL_CHARS" required>

                                <div class="error-messages" ng-messages="createForm.lastName.$error" role="alert"
                                     ng-messages-multiple>
                                    <div ng-messages-include="parts/shared/error-messages.html"></div>
                                </div>
                            </div>
                            <div class="form-group"
                                 ng-class="{'has-error': createForm.role.$invalid && createForm.role.$dirty}">
                                <label for="role" popover-append-to-body="{{true}}" class="control-label"
                                       popover-trigger="mouseenter"
                                       uib-popover="Select here the user's role in management of the account">Role
                                    *</label>
                                <select class="form-control" id="role" name="role" ng-model="model.role"
                                        ng-disabled="_loading" ng-options="role for role in roles" required>
                                    <option value="">--- Select Role ---</option>
                                </select>

                                <div class="error-messages" ng-messages="createForm.role.$error" role="alert"
                                     ng-messages-multiple>
                                    <div ng-messages-include="parts/shared/error-messages.html"></div>
                                </div>
                            </div>
                            <div class="form-group"
                                 ng-class="{'has-error': createForm.app_name.$invalid && createForm.app_name.$dirty}"
                                 ng-if="auth.isReseller() || auth.isRevadmin()">
                                <label for="company" popover-append-to-body="{{true}}" class="control-label"
                                       popover-trigger="mouseenter"
                                       uib-popover="Select here account the user should be associated with">Accounts
                                    *</label>
                                <ui-select ng-show="!_loading && companies.length>0" multiple theme="bootstrap"
                                           class="form-control" ng-disabled="_loading" ng-model="model.companyId"
                                           id="company" on-select="onAccountSelect($model)">
                                    <ui-select-match
                                            placeholder="Add account...">{{$item.companyName}}</ui-select-match>
                                    <ui-select-choices
                                            repeat="item.id as  item in companies | filter: {companyName: $select.search}">
                                        <div ng-bind-html="item.companyName|highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                            </div>
                            <div class="form-group"
                                 ng-class="{'has-error': createForm.domain.$invalid && createForm.domain.$dirty}">
                                <label for="domain" popover-append-to-body="{{true}}" class="control-label"
                                       popover-trigger="mouseenter"
                                       uib-popover="Select domain names the user should be allowed to manage">Domains</label>
                                <ui-select validate-domains-list ng-show="!_loading" multiple theme="bootstrap"
                                           class="form-control" ng-disabled="_loading" ng-model="model.domain"
                                           id="domain" name="domain">
                                    <ui-select-match
                                            placeholder="{{getDomainPlaceholder()}}">{{$item.domain_name}}</ui-select-match>
                                    <ui-select-choices
                                            repeat="item.domain_name as item  in getAccountDomainNameList()| filter: {domain_name: $select.search}">
                                        <div ng-bind-html="item.domain_name|highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                                <div class="error-messages" ng-messages="createForm.domain.$error" role="alert"
                                     ng-messages-multiple>
                                    <div ng-messages-include="parts/shared/error-messages.html"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12 col-sm-8 col-md-6">
                            <hr>

                            <div class="form-group">
                                <label for="access_control_list" popover-append-to-body="{{true}}" class="control-label"
                                       popover-trigger="mouseenter"
                                       uib-popover="Set here the new user's access control permissions">Access Control
                                    List</label>
                                <br>
                                <input type="checkbox" disabled ng-model="model.access_control_list.dashBoard">
                                Dashboard

                                <input type="checkbox" ng-model="model.access_control_list.reports"> Reports

                                <input type="checkbox" ng-model="model.access_control_list.configure"> Configure
                                <br>

                                <input type="checkbox" ng-model="model.access_control_list.test"> Test

                                <input type="checkbox" ng-model="model.access_control_list.readOnly"> Read Only
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12 col-sm-6 col-md-6">
                            <hr>

                            <div class="form-group"
                                 ng-class="{'has-error': createForm.password.$invalid && createForm.password.$dirty}">
                                <label for="password" class="control-label" popover-trigger="mouseenter">Password
                                    *</label>
                                <input type="password" class="form-control" id="password" name="password"
                                       ng-model="model.password" ng-disabled="_loading" ng-minlength="8"
                                       ng-maxlength="15" required>

                                <div class="error-messages" ng-messages="createForm.password.$error" role="alert"
                                     ng-messages-multiple>
                                    <div ng-message="minlength" class="alert-text alert-text--minlength">Password must
                                        contain at least 8 characters
                                    </div>
                                    <div ng-message="maxlength" class="alert-text alert-text--maxlength">Password must
                                        contain 15 characters max
                                    </div>
                                    <div ng-messages-include="parts/shared/error-messages.html"></div>
                                </div>
                            </div>
                            <div class="form-group"
                                 ng-class="{'has-error': createForm.passwordConfirm.$invalid && createForm.passwordConfirm.$dirty}">
                                <label for="passwordConfirm" class="control-label" popover-trigger="mouseenter">Confirm
                                    Password *</label>
                                <input type="password" class="form-control" id="passwordConfirm" name="passwordConfirm"
                                       ng-model="model.passwordConfirm" ng-disabled="_loading"
                                       validate-compare-to="model.password">

                                <div class="error-messages" ng-messages="createForm.passwordConfirm.$error" role="alert"
                                     ng-messages-multiple>
                                    <div ng-messages-include="parts/shared/error-messages.html"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12 col-sm-8 col-md-6">
                            <hr>

                            <div class="form-group"
                                 ng-class="{ 'has-error': createForm.comment.$invalid && createForm.comment.$dirty }">
                                <label for="comment" class="control-label" popover-trigger="mouseenter"
                                       uib-popover="Comment">Comment</label>

                                <textarea id="comment" placeholder="Comment (300 characters max)" ng-maxlength="300"
                                          class="form-control"
                                          name="comment" ng-model="model.comment" ng-pattern="COMMENT_NO_SPECIAL_CHARS"
                                          ng-disabled="_loading">
                                </textarea>

                                <div class="error-messages" ng-messages="createForm.comment.$error" role="alert"
                                     ng-messages-multiple>
                                    <div ng-messages-include="parts/shared/error-messages.html"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12 col-sm-8 col-md-6">
                            <hr>

                            <div class="form-group">
                                <div class="text-center">
                                    <a ui-sref="{{state}}" class="btn btn-default">
                                        <i class="glyphicon glyphicon-remove"></i>&nbsp; Cancel
                                    </a>
                                    <button class="btn btn-success" id="create_user" ng-disabled="disableSubmit(model)"
                                            ng-click="createUser(model,false)">
                                        <i class="glyphicon glyphicon-ok"></i>&nbsp; Create User
                                    </button>
                                    <button class="btn btn-success" id="create_user_and_more"
                                            ng-disabled="disableSubmit(model)"
                                            ng-click="createUser(model,true);createForm.$setPristine()">
                                        <i class="glyphicon glyphicon-ok"></i>&nbsp; Create And Add More
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
      </div>
    </div>
</div>
