<script type="text/ng-template" id="confirmUpdateModal.html">
    <div class="modal-header">
        <h3 class="modal-title">Confirm</h3>
    </div>
    <div class="modal-body">
        Are you sure you want to update
        <strong>{{model.companyName}}</strong> company profile?
    </div>
    <div class="modal-footer">
        <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>
        <button class="btn btn-danger" type="button" ng-click="ok()">OK</button>
    </div>
</script>
<script type="text/ng-template" id="confirmDeleteModal.html">
    <div class="modal-header">
        <h3 class="modal-title">Confirm</h3>
    </div>
    <div class="modal-body">
        Are you sure you want to delete company profile
        <strong>{{model.companyName}}</strong>?
    </div>
    <div class="modal-footer">
        <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>
        <button class="btn btn-danger" type="button" ng-click="ok()">OK</button>
    </div>
</script>

<div class="container-fluid" ui-view="page">
    <div class="row">
        <div class="col-sm-12">
            <h2 class="pull-left page-title">
                Account Profile
            </h2>
        </div>
    </div>

    <div class="row" ng-init="initEditCompany()">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="pull-left">
                                <a ng-disabled="_loading"
                                   ui-sref="index.accountSettings.users"
                                   class="btn btn-default">
                                    <i class="glyphicon glyphicon-arrow-left"></i>&nbsp;
                                    Back
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="alert alert-info" ng-if="_loading">
                        <i class="glyphicon glyphicon-refresh spin" ng-if="item.loading"></i>&nbsp;
                        Loading...
                    </div>

                    <form class="form-horizontal" name="Company" ng-submit="updateCompany(model)" novalidate>

                        <div class="form-group"
                             ng-class="{ 'has-error': Company.companyName.$invalid &&
                            Company.companyName.$dirty }">
                            <label for="companyName"
                                   class="col-sm-2 control-label"
                                   popover-trigger="mouseenter"
                                   popover="Will be generated from your first and last name if left empty.">
                                Company Name &nbsp;</label>

                            <div class="col-sm-10">
                                <input type="text"
                                       class="form-control"
                                       id="companyName"
                                       name="companyName"
                                       placeholder="Company Name"
                                       maxlength="250"
                                       ng-model="model.companyName"
                                       ng-disabled="_loading">
                            </div>
                        </div>
                        <hr>
                        <div class="form-group">
                            <label for="address1"
                                   class="col-sm-2 control-label"
                                   popover-trigger="mouseenter"
                                   popover="Could be used as a billing address later.">Address *</label>

                            <div class="col-sm-10">
                                <input type="text"
                                       class="form-control"
                                       required
                                       id="address1"
                                       placeholder="Address 1"
                                       ng-model="model.address1"
                                       ng-disabled="_loading">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="address2"
                                   class="col-sm-2 control-label"
                                   popover-trigger="mouseenter"
                                   popover="Could be used as a billing address later.">Address (Line 2) &nbsp;</label>

                            <div class="col-sm-10">
                                <input type="text"
                                       class="form-control"
                                       id="address2"
                                       placeholder="Address (Line 2)"
                                       ng-model="model.address2"
                                       ng-disabled="_loading">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="Country"
                                   class="col-sm-2 control-label"
                                   popover-trigger="mouseenter"
                                   popover="Could be used in a billing address later.">Country *</label>

                            <div class="col-sm-10">
                                <select type="text"
                                        class="form-control"
                                        id="Country"
                                        placeholder="Country"
                                        required
                                        ng-model="model.country"
                                        ng-options="key as value for (key , value) in countries"
                                        ng-disabled="_loading">
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="state"
                                   class="col-sm-2 control-label"
                                   popover-trigger="mouseenter"
                                   popover="Could be used in a billing address later.">State *</label>

                            <div class="col-sm-10">
                                <input type="text"
                                       class="form-control"
                                       id="state"
                                       required
                                       placeholder="State"
                                       ng-model="model.state"
                                       ng-disabled="_loading">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="City"
                                   class="col-sm-2 control-label"
                                   popover-trigger="mouseenter"
                                   popover="Could be used in a billing address later.">City *</label>

                            <div class="col-sm-10">
                                <input type="text"
                                       class="form-control"
                                       id="City"
                                       required
                                       placeholder="City"
                                       ng-model="model.city"
                                       ng-disabled="_loading">
                            </div>
                        </div>
                        <div class="form-group"
                             ng-class="{ 'has-error': Company.Zipcode.$invalid &&
                            Company.Zipcode.$dirty }">
                            <label for="Zipcode"
                                   class="col-sm-2 control-label"
                                   popover-trigger="mouseenter"
                                   popover="Could be used in a billing address later.">Zip Code *</label>

                            <div class="col-sm-10">
                                <input type="text"
                                       ng-pattern="zipRegex"
                                       class="form-control"
                                       id="Zipcode"
                                       name="Zipcode"
                                       maxlength="10"
                                       required
                                       placeholder="Zip Code"
                                       ng-model="model.zipcode"
                                       ng-disabled="_loading">
                            </div>
                        </div>

                        <div class="form-group"
                             ng-class="{ 'has-error': Company.phoneNumber.$invalid &&
                            Company.phoneNumber.$dirty }">
                            <label for="phoneNumber"
                                   class="col-sm-2 control-label"
                                   popover-trigger="mouseenter"
                                   popover="Contact phone number">Phone Number *</label>

                            <div class="col-sm-10">
                                <input type="text"
                                       ng-pattern="phoneRegex"
                                       class="form-control"
                                       required
                                       id="phoneNumber"
                                       name="phoneNumber"
                                       placeholder="Phone Number"
                                       ng-model="model.phone_number"
                                       ng-disabled="_loading">
                            </div>
                        </div>
                        <hr>
                        <div class="form-group"
                             ng-class="{ 'has-error': Company.comment.$invalid &&
                            Company.comment.$dirty }">
                            <label for="comment"
                                   class="col-sm-2 control-label"
                                   popover-trigger="mouseenter"
                                   popover="Comment">Comment</label>

                            <div class="col-sm-5">
                                <textarea id="comment"
                                          class="form-control"
                                          name="comment"
                                          ng-model="model.comment"
                                          ng-disabled="_loading">

                                </textarea>
                            </div>
                        </div>
                        <div class="form-group" ng-if="model.chargify_id">
                            <label for="comment"
                                   class="col-sm-2 control-label"
                                   popover-trigger="mouseenter"
                                   popover="Billing plan">Billing Plan</label>
                            <div class="col-sm-10">
                                <ui-select ng-model="model.billing_plan"
                                           theme="select2"
                                           ng-disabled="_loading"
                                           on-select=""
                                           style="min-width: 300px;" >
                                    <ui-select-match placeholder="Select Billing Plan">{{$select.selected.name}}</ui-select-match>
                                    <ui-select-choices repeat="item.id as item in billing_plans | filter: {name: $select.search}">
                                        <div ng-bind-html="item.name|highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                            </div>
                        </div>

                        <hr>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <a ui-sref="^"
                                   ng-disabled="_loading"
                                   class="btn btn-default">
                                    <i class="glyphicon glyphicon-remove"></i>&nbsp;
                                    Cancel
                                </a>
                                <input type="submit" class="btn btn-success"
                                       ng-disabled="_loading || _disabled"
                                       value="Update Company Profile">

                                <!-- TODO: Need to disable "Edit Billing Profile" button if the billing profile is not active
                                // TODO: in Chargify  -->
                                <a ng-if="model.chargify_id" href="{{model.billing_portal_link.url}}"
                                class="btn btn-primary"
                                target="_blank"
                                ng-disabled="_loading || _disabled">
                                    <i class="glyphicon glyphicon-lock"></i>
                                    Update Payment Profile</a>
                                <button class="btn btn-primary"
                                        ng-if="User.isRevadmin() || User.isReseller()"
                                        ng-click="createBillingProfile(model)">
                                    Create Billing Profile
                                </button>
                                <button ng-if="model.subscription_id" ng-click="deleteCompanyProfile(model.id)"
                                        class="btn btn-danger pull-right"
                                        ng-disabled="true || _loading || _disabled">
                                    <i class="glyphicon glyphicon-refresh spin" ng-if="_loading"></i>
                                    <i class="glyphicon glyphicon-remove" ng-if="!_loading"></i>&nbsp;
                                    Delete Company Profile
                                </button>
                            </div>
                        </div>

                    </form>

                </div>
            </div>
        </div>
    </div>
</div>
